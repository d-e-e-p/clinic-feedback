!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}}(self,(()=>(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})}};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),e.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var t={};e.r(t),e.d(t,{AnimateToNamedCameraRequestBody:()=>a.AnimateToNamedCameraRequestBody,ConnectOptions:()=>R.ConnectOptions,ConnectionState:()=>$n,ConnectionStateTypes:()=>W,ContentAwareness:()=>St,ContentCardFormatter:()=>Yn,Conversation:()=>Qn,ConversationResultResponseBody:()=>T.ConversationResultResponseBody,ConversationSendRequestBody:()=>r.ConversationSendRequestBody,ConversationSetVariablesRequestBody:()=>o.ConversationSetVariablesRequestBody,ConversationState:()=>Wn,ConversationStateTypes:()=>Hn,DemoModeResponseBody:()=>b.DemoModeResponseBody,GetModelChildrenRequestBody:()=>h.GetModelChildrenRequestBody,GetModelFilterSearchResultRequestBody:()=>d.GetModelFilterSearchResultRequestBody,GetModelVariableFilterSearchResultRequestBody:()=>f.GetModelVariableFilterSearchResultRequestBody,GetModelVariablesListRequestBody:()=>p.GetModelVariablesListRequestBody,GetVariablesListRequestBody:()=>l.GetVariablesListRequestBody,GetVariablesRequestBody:()=>i.GetVariablesRequestBody,LogLevel:()=>n.LogLevel,NLPIntent:()=>H,Persona:()=>A,PersonaRequestBody:()=>s.PersonaRequestBody,PlayAnimationRequestBody:()=>c.PlayAnimationRequestBody,RecognizeResultsResponseBody:()=>E.RecognizeResultsResponseBody,Scene:()=>rl,SceneOptions:()=>R.SceneOptions,SceneRequest:()=>m.SceneRequest,SceneRequestBody:()=>m.SceneRequestBody,SceneResponse:()=>w.SceneResponse,SceneResponseError:()=>Y,SetVariablesRequestBody:()=>u.SetVariablesRequestBody,SmEvent:()=>C,SpeechMarkerResponseBody:()=>S.SpeechMarkerResponseBody,StartRecognizeRequestBody:()=>_.StartRecognizeRequestBody,StartSpeakingOptionalArgs:()=>y.StartSpeakingOptionalArgs,StartSpeakingRequestBody:()=>y.StartSpeakingRequestBody,StateResponseBody:()=>O.StateResponseBody,StopBlProfilingRequestBody:()=>v.StopBlProfilingRequestBody,UpdateContentAwarenessRequestBody:()=>g.UpdateContentAwarenessRequestBody,UserMedia:()=>z,WebsocketKind:()=>Ie,smwebsdk:()=>ol});var n={};e.r(n),e.d(n,{Y:()=>F});var r={};e.r(r);var o={};e.r(o);var i={};e.r(i);var s={};e.r(s);var a={};e.r(a);var c={};e.r(c);var u={};e.r(u);var l={};e.r(l);var p={};e.r(p);var h={};e.r(h);var d={};e.r(d);var f={};e.r(f);var v={};e.r(v);var _={};e.r(_);var y={};e.r(y);var g={};e.r(g);var m={};e.r(m);var b={};e.r(b);var E={};e.r(E);var T={};e.r(T);var S={};e.r(S),e.d(S,{Z:()=>X});var O={};e.r(O),e.d(O,{T:()=>K});var w={};e.r(w);var R={};e.r(R),e.d(R,{x:()=>rl});var C=function(){function e(){this._callbacks=[]}return e.prototype.addListener=function(e){this._callbacks.push(e)},e.prototype.removeListener=function(e){var t=this._callbacks.indexOf(e);t>-1&&this._callbacks.splice(t,1)},e.prototype.call=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._callbacks.forEach((function(t){t.apply(t,e)}),this)},e}(),A=function(){function e(e,t){this._scene=e,this._personaId=t,this._scene.onConversationResultEvents[t]||(this._scene.onConversationResultEvents[t]=new C),this._onConversationResultEvent=this._scene.onConversationResultEvents[t],this._scene.onSpeechMarkerEvents[t]||(this._scene.onSpeechMarkerEvents[t]=new C),this._onSpeechMarkerEvent=this._scene.onSpeechMarkerEvents[t]}return e.prototype.startSpeaking=function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=null);var r={personaId:this._personaId,text:e};return t&&(r.context=t),n&&(r.optionalArgs=n),this._scene.sendRequest("startSpeaking",r)},e.prototype.stopSpeaking=function(){var e={personaId:this._personaId};return this._scene.sendRequest("stopSpeaking",e)},e.prototype.conversationSend=function(e,t,n){var r={personaId:this._personaId,text:e,variables:t,optionalArgs:n};return this._scene.sendRequest("conversationSend",r)},e.prototype.conversationSetVariables=function(e){var t={personaId:this._personaId,variables:e};return this._scene.sendRequest("conversationSetVariables",t)},e.prototype.conversationGetVariables=function(){var e={personaId:this._personaId};return this._scene.sendRequest("conversationGetVariables",e)},e.prototype.animateToNamedCameraWithOrbitPan=function(e,t,n,r,o,i){var s={personaId:this._personaId,cameraName:e,time:t,orbitDegX:n,orbitDegY:r,panDeg:o,tiltDeg:i};return this._scene.sendRequest("animateToNamedCamera",s)},e.prototype.playAnimation=function(e){var t={personaId:this._personaId,animation:e};return this._scene.sendRequest("playAnimation",t)},e.prototype.getVariables=function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n="");var r={personaId:this._personaId,names:e,errorTolerant:t,format:n};return this._scene.sendRequest("getVariables",r)},e.prototype.setVariables=function(e){var t={personaId:this._personaId,Variables:e};return this._scene.sendRequest("setVariables",t)},e.prototype.setVariablesOneway=function(e){var t={personaId:this._personaId,Variables:e};this._scene.sendOnewaySceneRequest("setVariables",t)},e.prototype.getVariablesList=function(){var e={personaId:this._personaId};return this._scene.sendRequest("getVariablesList",e)},e.prototype.getModelVariablesList=function(e){var t={personaId:this._personaId,Models:e};return this._scene.sendRequest("getModelVariablesList",t)},e.prototype.getModelChildren=function(e){var t={personaId:this._personaId,Models:e};return this._scene.sendRequest("getModelChildren",t)},e.prototype.getModelFilterSearchResult=function(e){var t={personaId:this._personaId,Models:e};return this._scene.sendRequest("getModelFilterSearchResult",t)},e.prototype.getModelVariableFilterSearchResult=function(e){var t={personaId:this._personaId,Models:e};return this._scene.sendRequest("getModelVariableFilterSearchResult",t)},e.prototype.getConnectorEntries=function(e){var t={personaId:this._personaId,model:e};return this._scene.sendRequest("getConnectorEntries",t)},e.prototype.startBlProfiling=function(){var e={personaId:this._personaId};return this._scene.sendRequest("startBlProfiling",e)},e.prototype.stopBlProfiling=function(e){var t={personaId:this._personaId,reverse:e};return this._scene.sendRequest("stopBlProfiling",t)},e.prototype.getModelHierarchy=function(e){var t={personaId:this._personaId,model:e};return this._scene.sendRequest("getModelHierarchy",t)},e.prototype.createMonitorSet=function(e,t){var n={personaId:this._personaId,setName:[{SetName:e}],variables:t};return this._scene.sendRequest("createMonitorSet",n)},e.prototype.removeMonitorSet=function(e){var t={personaId:this._personaId,setName:[{SetName:e}]};return this._scene.sendRequest("removeMonitorSet",t)},e.prototype.addVariableToMonitorSet=function(e,t){var n={personaId:this._personaId,setName:[{SetName:e}],variables:t};return this._scene.sendRequest("addVariableToMonitorSet",n)},e.prototype.removeVariableFromMonitorSet=function(e,t){var n={personaId:this._personaId,setName:[{SetName:e}],variables:t};return this._scene.sendRequest("removeVariableFromMonitorSet",n)},e.prototype.renderModel=function(e){var t={personaId:this._personaId,modelName:e};return this._scene.sendRequest("renderModel",t)},Object.defineProperty(e.prototype,"onConversationResultEvent",{get:function(){return this._onConversationResultEvent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onSpeechMarkerEvent",{get:function(){return this._onSpeechMarkerEvent},enumerable:!1,configurable:!0}),e}(),P=function(e,t){return P=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},P(e,t)};function L(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}P(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var M=function(){return M=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},M.apply(this,arguments)};function I(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n}function x(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))}function N(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){s.label=a[1];break}if(6===a[0]&&s.label<o[1]){s.label=o[1],o=a;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(a);break}o[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}Object.create;function k(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function U(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s}function D(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))}Object.create;"function"==typeof SuppressedError&&SuppressedError;var B=function(){function e(){var e=this;this.state="pending",this.fate="unresolved",this.promise=new Promise((function(t,n){e._resolve=t,e._reject=n})),this.promise.then((function(){return e.state="fulfilled"}),(function(){return e.state="rejected"}))}return e.prototype.resolve=function(e){"resolved"!==this.fate?(this.fate="resolved",this._resolve(e)):console.error("Deferred cannot be resolved twice")},e.prototype.reject=function(e){"resolved"!==this.fate?(this.fate="resolved",this._reject(e)):console.error("Deferred cannot be resolved twice")},e.prototype.isResolved=function(){return"resolved"===this.fate},e.prototype.isPending=function(){return"pending"===this.state},e.prototype.isFulfilled=function(){return"fulfilled"===this.state},e.prototype.isRejected=function(){return"rejected"===this.state},e}(),j=function(){function e(){this._hasMicrophone=!1,this._hasCamera=!1,this._isAndroid=!1,this._isBrowserSupported=!1,this._isEdge=!1,this._isIos=!1,this._isAndroid=this.detectAndroid(),this._isEdge=this.detectEdge(),this._isIos=this.detectIos()}return e.prototype.detectEdge=function(){return this.userAgentMatches("Edge")},e.prototype.detectAndroid=function(){return this.userAgentMatches("Android")},e.prototype.detectIos=function(){return(/iPad|iPhone|iPod/i.test(navigator.platform)||navigator&&"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1)&&!window.MSStream},e.prototype.userAgentMatches=function(e){var t=window.navigator.userAgent.match(e);return!!t&&t.length>0},e.prototype.detectWebRTCFeatures=function(){var e=this;return new Promise((function(t,n){window.SmIsUnderRuntimeHost&&(e._isBrowserSupported=!0,e._hasMicrophone=!0,e._hasCamera=!0,t(e));var r=!1;["RTCPeerConnection","webkitRTCPeerConnection","mozRTCPeerConnection","RTCIceGatherer"].forEach((function(e){r||e in window&&(r=!0)}));var o=navigator.userAgent.match(/iPhone|iPad|iPod/i)&&!window.MSStream,i=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);r&&o&&!i&&(r=!1),e._isBrowserSupported=r,e._isBrowserSupported||t(e);var s=null;navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&(s=function(e){Promise.resolve(navigator.mediaDevices.enumerateDevices()).then((function(t){void 0===t&&(t=[]),e(t)})).catch((function(){e([])}))});var a=window.MediaStreamTrack;!s&&a&&a.getSources&&(s=a.getSources.bind(a)),!s&&navigator.enumerateDevices&&(s=navigator.enumerateDevices.bind(navigator)),s?s((function(n){n.forEach((function(t){"audioinput"===t.kind&&(e._hasMicrophone=!0),"videoinput"===t.kind&&(e._hasCamera=!0)})),t(e)})):t(e)}))},Object.defineProperty(e.prototype,"hasMicrophone",{get:function(){return this._hasMicrophone},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasCamera",{get:function(){return this._hasCamera},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isAndroid",{get:function(){return this._isAndroid},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isBrowserSupported",{get:function(){return this._isBrowserSupported},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isEdge",{get:function(){return this._isEdge},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isIos",{get:function(){return this._isIos},enumerable:!1,configurable:!0}),e}(),V=["debug","log","warn","error"],F=function(){function e(e,t){void 0===e&&(e="log"),void 0===t&&(t=!0),this.isEnabled=t,this.availableLogLevels=[],this._minLogLevel="log",this.setMinLogLevel(e)}return e.prototype.log=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.isEnabled&&this.availableLogLevels.includes(e)&&console[e].apply(console,D([],U(t),!1))},e.prototype.enableLogging=function(e){this.isEnabled=e},e.prototype.getMinLogLevel=function(){return this._minLogLevel},e.prototype.setMinLogLevel=function(e){var t=V.indexOf(e);this._minLogLevel=e,this.availableLogLevels=V.slice(t)},e}();function G(e,t){var n=new Error(e);return n.name=t,n}var X,K,q=function(){function e(e,t){void 0===t&&(t=new F);var n=this;this.logger=t,this._isMicrophoneConnected=!1,this._isCameraConnected=!1,this._onConnectedStorage=function(e,t,n,r){},this._closed=!1,this._outgoingQueue=[],this._microphoneMuteDelay=-1,this._offsetX=0,this._offsetY=0,e&&(this._viewport_element=e),window.SmRuntimeHostReceiveMessage=this.receiveMessage.bind(this),"function"==typeof window.SmRuntimeHostStyleViewportElement&&window.SmRuntimeHostStyleViewportElement(this._viewport_element),this._onClose=function(e){},this._onMessage=function(e){},this._onUserText=function(e){},this.sendVideoBounds(0,0),setTimeout((function(){n.sendVideoBounds(0,0)}),3e3),this._features=new j,this.log("Local session created!")}return e.prototype.setVideoElement=function(e){this._viewport_element=e,"function"==typeof window.SmRuntimeHostStyleViewportElement&&window.SmRuntimeHostStyleViewportElement(this._viewport_element),this.log("Updating bounds after videoElement is updated: 0, 0"),this.sendVideoBounds(0,0)},e.prototype.receiveMessage=function(e){var t,n,r=JSON.parse(e);this.log("message received: ".concat(e)),this._onMessage(r),"state"===r.name&&"scene"===r.category&&"idle"===(null===(n=null===(t=r.body)||void 0===t?void 0:t.session)||void 0===n?void 0:n.state)&&(this.log("Local session ending - conversationEnded"),this.close(!0,"conversationEnded"))},Object.defineProperty(e.prototype,"onConnected",{set:function(e){this._onConnectedStorage=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onClose",{set:function(e){this._onClose=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onMessage",{set:function(e){this._onMessage=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onUserText",{set:function(e){this._onUserText=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"loggingEnabled",{get:function(){return this.logger.isEnabled},set:function(e){this.logger.log("warn","loggingEnabled is deprecated and will be removed in a future version. Please use setLogging(boolean)"),this.logger.enableLogging(e)},enumerable:!1,configurable:!0}),e.prototype.setMinLogLevel=function(e){this.logger.setMinLogLevel(e)},e.prototype.setLogging=function(e){this.logger.enableLogging(e)},e.prototype.log=function(e){this.logger.log("log",e)},e.prototype.sendVideoBounds=function(e,t){var n=this;setTimeout((function(){var e=n._viewport_element;if(e){var t=document.defaultView||window,r=parseInt(t.getComputedStyle(e).width,10),o=parseInt(t.getComputedStyle(e).height,10);if(0===r||0===o)return;var i=e.getBoundingClientRect();n._offsetX=i.x,n._offsetY=i.y,n.log("Updating bounds: x =  ".concat(n._offsetX," , y = ").concat(n._offsetY,"', w = ").concat(r,", h = ").concat(o));var s={name:"videoBounds",body:{top:n._offsetY,left:n._offsetX,bottom:n._offsetY+o,right:n._offsetX+r},category:"local",kind:"event"};n.sendMessage(s)}}),0)},e.prototype.hideVideo=function(){var e={name:"videoBounds",body:{top:0,left:0,bottom:0,right:0},category:"local",kind:"event"};this.sendMessage(e)},e.prototype.sendRtcEvent=function(e,t){},e.prototype.connect=function(){return x(this,void 0,Promise,(function(){var e,t,n,r=this;return N(this,(function(o){switch(o.label){case 0:return e=new B,this.log("Local session connecting!"),this._closed=!1,[4,this._features.detectWebRTCFeatures()];case 1:return t=o.sent(),this._closed=!1,this._sessionId=void 0,this._isMicrophoneConnected=t.hasMicrophone,this._isCameraConnected=t.hasCamera,"number"==typeof window.local_websocket_port?(this._serverConnection=new WebSocket("ws://localhost:"+window.local_websocket_port),this.log("websocket open"),this._serverConnection.onmessage=function(e){r.gotMessageFromServer(e)},this._serverConnection.onerror=function(t){e.isPending()&&e.reject(G("websocket failed","serverConnectionFailed"))},this._serverConnection.onopen=function(t){window.SmRuntimeHostReceiveMessage=function(){},r.log("Local session connected!");for(var n=0;n<r._outgoingQueue.length;n++)r._serverConnection.send(JSON.stringify(r._outgoingQueue[n])),r.logger.log("log","SmLocalSession.prototype.sendMessage, forwarding message to Web Socket: "+r._outgoingQueue[n]);r._outgoingQueue=[],e.isPending()&&e.resolve()},this._serverConnection.onclose=function(t){r.logger.log("log","websocket closed: code(".concat(t.code,"), reason(").concat(t.reason,"), clean(").concat(t.wasClean,")")),e.isRejected||r.close(!1,"normal")}):(this.log("local_websocket_port not found! Failed to create WebSocket"),e.isPending()&&e.reject(G("websocket failed","local_websocket_port not found"))),n={name:"startSession",body:{},category:"scene",kind:"request"},this.sendMessage(n),[2,e.promise]}}))}))},e.prototype.gotMessageFromServer=function(e){var t=e.data,n=JSON.parse(t),r=n.category,o=n.name,i=n.body;"webrtc"!==r?this._onMessage(n):"close"===o&&this.close(!1,i.reason),"state"===o&&"scene"===r&&null!==i.session&&void 0!==i.session&&"idle"===i.session.state&&(this.log("Local session ending due to server idle message"),this.close(!0,"conversationEnded"))},e.prototype.sendMessage=function(e){var t=JSON.stringify(e);this._serverConnection&&this._serverConnection.readyState===WebSocket.OPEN?(this._serverConnection.send(t),this.log("SmLocalSession.prototype.sendMessage, forwarding message to Web Socket: ".concat(t))):this._outgoingQueue.push(e)},e.prototype.sendUserText=function(e){this.logger.log("log","SmLocalSession.prototype.sendUserText, discarding text: "+e)},e.prototype.close=function(e,t){if(void 0===e&&(e=!0),void 0===t&&(t="normal"),!this._closed&&(this._closed=!0,this._onClose(t),this._isMicrophoneConnected=!1,this._isCameraConnected=!1,this.hideVideo(),this._serverConnection)){this.log("closing server connection");this._serverConnection.close(1e3,t)}},Object.defineProperty(e.prototype,"peerConnection",{get:function(){return null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"userMediaStream",{get:function(){return null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"serverConnection",{get:function(){return this._serverConnection},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sessionId",{get:function(){return this._sessionId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isMicrophoneConnected",{get:function(){return this._isMicrophoneConnected},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isCameraConnected",{get:function(){return this._isCameraConnected},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"features",{get:function(){return this._features},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"microphoneMuteDelay",{get:function(){return this._microphoneMuteDelay},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"microphoneMuted",{get:function(){return"function"==typeof window.SmRuntimeHostIsMicrophoneMuted&&window.SmRuntimeHostIsMicrophoneMuted()},set:function(e){"function"==typeof window.SmRuntimeHostMuteMicrophone&&window.SmRuntimeHostMuteMicrophone(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"offsetX",{get:function(){return this._offsetX},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"offsetY",{get:function(){return this._offsetY},enumerable:!1,configurable:!0}),e.prototype.isMicrophoneActive=function(){return this.isMicrophoneConnected&&!this.microphoneMuted},e.prototype.isCameraActive=function(){return this.isCameraConnected},e.prototype.setMediaDeviceActive=function(e){e.microphone,e.camera;return x(this,void 0,Promise,(function(){return N(this,(function(e){throw G("setMediaDeviceActive not supported on LocalSession","notSupported")}))}))},e}();!function(e){e.Showcards="showcards",e.Hidecards="hidecards",e.Feature="feature",e.Marker="marker"}(X||(X={})),function(e){e.UI_CONTENT_AWARENESS="UI_CONTENT_AWARENESS",e.UI_SDK_CAMERA_CONTROL="UI_SDK_CAMERA_CONTROL"}(K||(K={}));var z,H,W,Y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.requestName="",t.status=0,t}return L(t,e),Object.defineProperty(t.prototype,"message",{get:function(){return"Scene response failed, status: ".concat(this.status)},enumerable:!1,configurable:!0}),t}(Error);!function(e){e[e.None=0]="None",e[e.Microphone=1]="Microphone",e[e.MicrophoneAndCamera=2]="MicrophoneAndCamera",e[e.Camera=3]="Camera"}(z||(z={})),function(e){e.PAGE_METADATA="PAGE_METADATA"}(H||(H={})),function(e){e.Disconnected="Disconnected",e.SearchingForDigitalPerson="SearchingForDigitalPerson",e.DownloadingAssets="DownloadingAssets",e.ConnectingToDigitalPerson="ConnectingToDigitalPerson",e.Connected="Connected"}(W||(W={}));var Q,J,Z,$,ee,te,ne,re,oe,ie={r:4/255,g:244/255,b:4/255},se=.4,ae=.08,ce=.1;function ue(e){ie=e.keyColor||ie,se=e.similarity||se,ae=e.smoothness||ae,ce=e.spill||ce}var le={timestamp:0,codedWidth:0,codedHeight:0,format:"RGBA"},pe="\nuniform vec3 keyColor;\nuniform float similarity;\nuniform float smoothness;\nuniform float spill;\n",he="\nvec2 RGBtoUV(vec3 rgb) {\n  return vec2(\n    rgb.r * -0.169 + rgb.g * -0.331 + rgb.b *  0.5    + 0.5,\n    rgb.r *  0.5   + rgb.g * -0.419 + rgb.b * -0.081  + 0.5\n  );\n}\n",de="\nvec4 ProcessChromaKey(vec2 texCoord, vec4 rgba) {\n    float chromaDist = distance(RGBtoUV(rgba.rgb), RGBtoUV(keyColor));\n    float baseMask = chromaDist - similarity;\n    float fullMask = pow(clamp(baseMask / smoothness, 0., 1.), 1.5);\n    rgba.a = fullMask;\n    float spillVal = pow(clamp(baseMask / spill, 0., 1.), 1.5);\n    float desat = clamp(rgba.r * 0.2126 + rgba.g * 0.7152 + rgba.b * 0.0722, 0., 1.);\n    rgba.rgb = mix(vec3(desat, desat, desat), rgba.rgb, spillVal);\n    return rgba;\n}\n",fe="\nprecision highp float;\n\nuniform sampler2D tex_y;\nvarying vec2 v_texCoord;\n\n".concat(pe,"\n\n").concat(he,"\n\n").concat(de,"\n\nvoid main() {\n    vec4 video_pixels_rgba = texture2D(tex_y, v_texCoord);\n    gl_FragColor = ProcessChromaKey(v_texCoord, video_pixels_rgba);\n}\n"),ve="\nattribute vec4 a_vertexPosition;\nattribute vec2 a_texturePosition;\nvarying vec2 v_texCoord;\nvoid main(void)\n{\n  gl_Position = a_vertexPosition;\n  v_texCoord = a_texturePosition;\n}\n",_e="\nprecision highp float;\n\nuniform sampler2D u_image_frame;\nuniform vec2 u_resolution;\nvarying vec2 v_texCoord;\n\n".concat(pe,"\n\n").concat(he,"\n\n").concat(de,"\n\nvoid main() {\n  float x_offset = mod( gl_FragCoord.y ,2.0  ) < 1.0 ? 0.5 : 0.0 ;\n  vec4 y4 =  texture2D(u_image_frame, vec2 ( v_texCoord.x / 1.0  , v_texCoord.y / 1.5  )   )  ;\n  vec4 u4 = (texture2D(u_image_frame, vec2 ( x_offset + v_texCoord.x  / 2.0  ,2.0/3.0 +  v_texCoord.y / 6.0  )   ) -0.50 ) * 2.0 ;\n  vec4 v4 = (texture2D(u_image_frame, vec2 ( x_offset + v_texCoord.x / 2.0  , 5.0/6.0 + v_texCoord.y / 6.0  )   ) -0.50 ) * 2.0 ;   \n  \n  float y = y4[0] ;\n  float u = u4[0] ;\n  float v = v4[0] ;   \n\n  float R = clamp(y + 1.13 * v, 0.0, 1.0) ;\n  float G = clamp(y - 0.39 * u - 0.58 * v, 0.0, 1.0) ;\n  float B = clamp(y + 2.03 * u, 0.0, 1.0) ;\n\n  vec4 video_pixels_rgba = vec4( vec3(R,G,B), 1.0) ;\n\n  gl_FragColor = ProcessChromaKey(vec2 ( v_texCoord.x / 1.0  , v_texCoord.y / 1.5  ), video_pixels_rgba);\n}\n"),ye="\nattribute vec2 a_position;\nattribute vec2 a_texCoord;\nuniform vec2 u_resolution; \nvarying vec2 v_texCoord;\n  \nvoid main() {  \n  gl_Position =  vec4(( (a_position / u_resolution * 2.0) - 1.0)  * vec2(1, -1), 0, 1);  \n  v_texCoord = a_texCoord;  \n}\n",ge="\nprecision highp float;\nvarying vec2 v_texCoord;\nuniform sampler2D tex_y;\nuniform sampler2D tex_uv;\n\n".concat(pe,"\n\n").concat(he,"\n\n").concat(de,"\n\nvoid main() \n{\n    vec3 yuv, rgb;\n    vec3 yuv2r = vec3(1.164, 0.0, 1.596);\n    vec3 yuv2g = vec3(1.164, -0.391, -0.813);\n    vec3 yuv2b = vec3(1.164, 2.018, 0.0);\n\n    yuv.x = texture2D(tex_y, v_texCoord).r - 0.0625;\n    yuv.y = texture2D(tex_uv, v_texCoord).r - 0.5;\n    yuv.z = texture2D(tex_uv, v_texCoord).a - 0.5;\n\n    rgb.x = dot(yuv, yuv2r);\n    rgb.y = dot(yuv, yuv2g);\n    rgb.z = dot(yuv, yuv2b);\n\n    vec4 video_pixels_rgba  = vec4(rgb, 1.0);\n\n    gl_FragColor = ProcessChromaKey(v_texCoord, video_pixels_rgba);\n}\n"),me="\nattribute vec4 a_vertexPosition;\nattribute vec2 a_texturePosition;\nvarying vec2 v_texCoord;\nvoid main(void)\n{\n  gl_Position = a_vertexPosition;\n  v_texCoord = a_texturePosition;\n}\n";function be(e,t){return Q=new OffscreenCanvas(e,t),!!(J=Q.getContext("webgl",{premultipliedAlpha:!1}))}function Ee(e,t){var n=J.createShader(e);return J.shaderSource(n,t),J.compileShader(n),J.getShaderParameter(n,J.COMPILE_STATUS)||console.error(J.getShaderInfoLog(n)),n}function Te(e,t){var n=J.createProgram();return J.attachShader(n,e),J.attachShader(n,t),J.linkProgram(n),J.useProgram(n),J.getProgramParameter(n,J.LINK_STATUS)||console.error(J.getShaderInfoLog(n)),n}function Se(e){void 0===e&&(e=J.LINEAR);var t=J.createTexture();return J.bindTexture(J.TEXTURE_2D,t),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_WRAP_S,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_WRAP_T,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_MIN_FILTER,e),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_MAG_FILTER,e),t}function Oe(e){(function(e){return!!(J=e.getContext("webgl",{premultipliedAlpha:!1}))})(e)&&we()}function we(){J.pixelStorei(J.UNPACK_ALIGNMENT,1);var e=Te(Ee(J.VERTEX_SHADER,ve),Ee(J.FRAGMENT_SHADER,fe));Re(e),J.activeTexture(J.TEXTURE0),J.y=Se(),J.uniform1i(J.getUniformLocation(e,"tex_y"),0),te=J.getUniformLocation(e,"keyColor"),ne=J.getUniformLocation(e,"similarity"),re=J.getUniformLocation(e,"smoothness"),oe=J.getUniformLocation(e,"spill")}function Re(e){var t=J.createBuffer(),n=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0]);J.bindBuffer(J.ARRAY_BUFFER,t),J.bufferData(J.ARRAY_BUFFER,n,J.STATIC_DRAW);var r=J.getAttribLocation(e,"a_vertexPosition");J.vertexAttribPointer(r,3,J.FLOAT,!1,0,0),J.enableVertexAttribArray(r);var o=new Float32Array([1,0,0,0,1,1,0,1]),i=J.createBuffer();J.bindBuffer(J.ARRAY_BUFFER,i),J.bufferData(J.ARRAY_BUFFER,o,J.STATIC_DRAW);var s=J.getAttribLocation(e,"a_texturePosition");J.vertexAttribPointer(s,2,J.FLOAT,!1,0,0),J.enableVertexAttribArray(s)}var Ce=Object.getPrototypeOf(Object.getPrototypeOf(new Uint8Array)).constructor;function Ae(e,t,n){J.viewport(0,0,e,t),J.bindTexture(J.TEXTURE_2D,J.y),n instanceof Ce?J.texImage2D(J.TEXTURE_2D,0,J.RGBA,e,t,0,J.RGBA,J.UNSIGNED_BYTE,n):J.texImage2D(J.TEXTURE_2D,0,J.RGBA,J.RGBA,J.UNSIGNED_BYTE,n),J.uniform3f(te,ie.r,ie.g,ie.b),J.uniform1f(ne,se),J.uniform1f(re,ae),J.uniform1f(oe,ce),J.drawArrays(J.TRIANGLE_STRIP,0,4),J.flush(),J.finish()}function Pe(e,t){return x(this,void 0,void 0,(function(){var n,r,o,i;return N(this,(function(s){switch(s.label){case 0:if(J&&ee===e.format&&Q.width===e.codedWidth&&Q.height===e.codedHeight||("NV12"===e.format?function(e,t){x(this,void 0,void 0,(function(){var n,r,o;return N(this,(function(i){return be(e,t)?(J.pixelStorei(J.UNPACK_ALIGNMENT,1),n=Ee(J.VERTEX_SHADER,me),r=Ee(J.FRAGMENT_SHADER,ge),Re(o=Te(n,r)),J.activeTexture(J.TEXTURE0),J.y=Se(),J.uniform1i(J.getUniformLocation(o,"tex_y"),0),J.activeTexture(J.TEXTURE1),J.uv=Se(),J.uniform1i(J.getUniformLocation(o,"tex_uv"),1),te=J.getUniformLocation(o,"keyColor"),ne=J.getUniformLocation(o,"similarity"),re=J.getUniformLocation(o,"smoothness"),oe=J.getUniformLocation(o,"spill"),[2]):[2]}))}))}(e.codedWidth,e.codedHeight):"I420"===e.format&&function(e,t){x(this,void 0,void 0,(function(){var n,r,o,i,s,a,c,u,l,p,h,d,f,v,_,y,g,m,b;return N(this,(function(E){return be(e,t)?(n=Ee(J.VERTEX_SHADER,ye),r=Ee(J.FRAGMENT_SHADER,_e),o=Te(n,r),i=J.getAttribLocation(o,"a_position"),s=J.getAttribLocation(o,"a_texCoord"),a=J.createBuffer(),J.bindBuffer(J.ARRAY_BUFFER,a),c=0+e,u=0+t,J.bufferData(J.ARRAY_BUFFER,new Float32Array([0,0,c,0,0,u,0,u,c,0,c,u]),J.STATIC_DRAW),l=J.createBuffer(),J.bindBuffer(J.ARRAY_BUFFER,l),J.bufferData(J.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),J.STATIC_DRAW),p=[],h=J.createTexture(),J.bindTexture(J.TEXTURE_2D,h),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_WRAP_S,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_WRAP_T,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_MIN_FILTER,J.NEAREST),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_MAG_FILTER,J.NEAREST),d=new Uint8Array(1.5*e*t),J.texImage2D(J.TEXTURE_2D,0,J.LUMINANCE,e,1.5*t,0,J.LUMINANCE,J.UNSIGNED_BYTE,d),p[0]=h,f=J.getUniformLocation(o,"u_image_frame"),J.uniform1i(f,0),J.activeTexture(J.TEXTURE0),J.bindTexture(J.TEXTURE_2D,p[0]),J.viewport(0,0,J.canvas.width,J.canvas.height),J.clearColor(0,0,0,0),J.clear(J.COLOR_BUFFER_BIT),J.enableVertexAttribArray(i),J.bindBuffer(J.ARRAY_BUFFER,a),v=2,_=J.FLOAT,y=!1,g=0,m=0,J.vertexAttribPointer(i,v,_,y,g,m),J.enableVertexAttribArray(s),J.bindBuffer(J.ARRAY_BUFFER,l),v=2,_=J.FLOAT,y=!1,g=0,m=0,J.vertexAttribPointer(s,v,_,y,g,m),b=J.getUniformLocation(o,"u_resolution"),J.uniform2f(b,J.canvas.width,J.canvas.height),te=J.getUniformLocation(o,"keyColor"),ne=J.getUniformLocation(o,"similarity"),re=J.getUniformLocation(o,"smoothness"),oe=J.getUniformLocation(o,"spill"),J.drawArrays(J.TRIANGLES,0,6),[2]):[2]}))}))}(e.codedWidth,e.codedHeight),ee=e.format,n=0,e.visibleRect&&(n=e.visibleRect.height),(r=n-n%2)!==n&&e.visibleRect?(o={x:e.visibleRect.x,y:e.visibleRect.y,width:e.visibleRect.width,height:r},$=o,Z=new ArrayBuffer(e.allocationSize({rect:o}))):($=e.visibleRect,Z=new ArrayBuffer(e.allocationSize({rect:$}))),le.codedWidth=e.codedWidth,le.codedHeight=e.codedHeight),!$)return[3,5];s.label=1;case 1:return s.trys.push([1,3,,4]),[4,e.copyTo(Z,{rect:$})];case 2:return s.sent(),[3,4];case 3:return s.sent(),[2];case 4:"NV12"===e.format?function(e,t,n){var r=e*t,o=new Uint8Array(n);J.bindTexture(J.TEXTURE_2D,J.y),J.texImage2D(J.TEXTURE_2D,0,J.LUMINANCE,e,t,0,J.LUMINANCE,J.UNSIGNED_BYTE,o.subarray(0,r)),J.bindTexture(J.TEXTURE_2D,J.uv),J.texImage2D(J.TEXTURE_2D,0,J.LUMINANCE_ALPHA,e/2,t/2,0,J.LUMINANCE_ALPHA,J.UNSIGNED_BYTE,o.subarray(r)),J.uniform3f(te,ie.r,ie.g,ie.b),J.uniform1f(ne,se),J.uniform1f(re,ae),J.uniform1f(oe,ce),J.drawArrays(J.TRIANGLE_STRIP,0,4),J.flush(),J.finish()}($.width,$.height,Z):"I420"===e.format&&function(e,t,n){var r=new Uint8Array(n);J.activeTexture(J.TEXTURE0),J.texImage2D(J.TEXTURE_2D,0,J.LUMINANCE,e,1.5*t,0,J.LUMINANCE,J.UNSIGNED_BYTE,r,0),J.uniform3f(te,ie.r,ie.g,ie.b),J.uniform1f(ne,se),J.uniform1f(re,ae),J.uniform1f(oe,ce),J.drawArrays(J.TRIANGLES,0,6),J.flush(),J.finish()}($.width,$.height,Z),s.label=5;case 5:return le.timestamp=e.timestamp,i=new VideoFrame(J.canvas,le),e.close(),t.enqueue(i),[2]}}))}))}function Le(e,t){e.pipeThrough(new TransformStream({transform:Pe})).pipeTo(t)}"undefined"!=typeof process&&void 0!=="MISSING_ENV_VAR".JEST_WORKER_ID||"undefined"==typeof onmessage||(onmessage=function(e){return x(void 0,void 0,void 0,(function(){return N(this,(function(t){return e.data?e.data.readable&&e.data.writable?[2,Le(e.data.readable,e.data.writable)]:(e.data.chromaKeyOptions&&ue(e.data.chromaKeyOptions),[2]):[2]}))}))}),"undefined"!=typeof self&&self.RTCTransformEvent&&(self.onrtctransform=function(e){var t=e.transformer;Le(t.readable,t.writable)});var Me,Ie,xe,Ne=function(){function e(e,t,n,r,o,i,s,a,c,u,l){var p=this;this._chromaKeyedCanvas=null,this._videoElementStyleObserver=null,this._connectPendingRemoteStream=null,this._resumeRequested=!1,this._isResumedSession=!1,this._outgoingQueue=[],this._controlOpen=!1,this._controlQueue=[],this._chromaKeyOptions=void 0,this._requestedUserMedia=z.None,this._requiredUserMedia=z.None,this._onConnected=function(e,t,n,r){},this._pendingLog=[],this._closed=!1,this._shouldLogToServer=!1,this._microphoneMuteDelay=-1,this._changeUserMediaQueue=new Array,this._removeListeners=new Array,this._videoOptions={frameRate:10,width:640,height:480,facingMode:"user"},this._audioOptions={noiseSuppression:!1,autoGainControl:!1,channelCount:1,sampleRate:16e3,sampleSize:16,echoCancellation:!0},this._videoElement=e,this._serverUri=t,this._connectUserText=n||"",this._accessToken=r,this._audioOnly=o,this._audioOptions.echoCancellation=a,this._requiredUserMedia=s,this._requestedUserMedia=i,this._logger=c,this._chromaKeyOptions=l,this._onClose=function(e){},this._onMessage=function(e){},this._onUserText=function(e){},this._sessionError=function(e){p.log("session error: ".concat(e),"error")},this._features=new j,this._connectionState=u}return e.prototype.setVideoElement=function(e){var t,n,r=this;e!==this._videoElement&&(this._videoElement&&(this._videoElement.removeEventListener("loadeddata",this.onVideoLoaded.bind(this)),this._removeListeners=this._removeListeners.filter((function(e){return e.target!==r._videoElement})),e&&(e.srcObject=this._videoElement.srcObject)),null===(t=this._videoElementStyleObserver)||void 0===t||t.disconnect(),this._videoElement=e,this.setupVideoElement(),(null===(n=this._chromaKeyOptions)||void 0===n?void 0:n.enabled)&&this.restoreChromaKeySettings())},e.prototype.restoreChromaKeySettings=function(){var e,t;this._videoElement&&(this._videoElement.srcObject?this.supportsInsertableStreams&&this.supportsTransferableStreams||!this._chromaKeyedCanvas||(null===(e=this._chromaKeyedCanvas.parentElement)||void 0===e||e.removeChild(this._chromaKeyedCanvas),null===(t=this._videoElement.parentElement)||void 0===t||t.appendChild(this._chromaKeyedCanvas),this.copyStyleFromVideoElementToCanvas(),this.hideVideoElement(this._videoElement),this.observeAndCopyStyleChangesFromVideoElementToCanvas(),"requestVideoFrameCallback"in HTMLVideoElement.prototype&&this._videoElement.requestVideoFrameCallback(this.processFrameForChromaKey.bind(this))):this._remoteStream&&this.setupChromaKeyedVideo())},Object.defineProperty(e.prototype,"chromaKeyedCanvas",{get:function(){return this._chromaKeyedCanvas},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onConnected",{set:function(e){this._onConnected=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onClose",{set:function(e){this._onClose=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onMessage",{set:function(e){this._onMessage=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onUserText",{set:function(e){this._onUserText=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"loggingEnabled",{get:function(){return this._logger.isEnabled},set:function(e){this.log("loggingEnabled is deprecated and will be removed in a future version. Please use setLogging(boolean)","warn"),this._logger.enableLogging(e)},enumerable:!1,configurable:!0}),e.prototype.setMinLogLevel=function(e){this._logger.setMinLogLevel(e)},e.prototype.setLogging=function(e){this._logger.enableLogging(e)},e.prototype.log=function(e,t){if(void 0===t&&(t="debug"),this._logger.isEnabled){var n=new Date,r="smsdk: ".concat(n.toISOString(),": ").concat(e);this._shouldLogToServer&&this.logToServer(r),this._logger.log(t,r)}},e.prototype.logToServer=function(e){this.sessionId?this.sendlogMessage([e]):this._pendingLog.push(e)},e.prototype.sendlogMessage=function(e){if(this._sessionId&&e&&e.length>0){var t={category:"diagnostics",kind:"event",name:"log",body:{name:"browser",text:e}};this.sendMessage(t)}},e.prototype.connect=function(e){return x(this,void 0,Promise,(function(){var t,n,r=this;return N(this,(function(o){return t=new B,this._closed=!1,e&&(this._connectUserText=e),this._serverUri&&(this._serverUri.startsWith("ws:")||this._serverUri.startsWith("wss:"))?(this.selectUserMedia(this._requestedUserMedia,this._requiredUserMedia,t,this.getUserMediaSuccess.bind(this)),[2,t.promise]):((n=new XMLHttpRequest).open("GET","/api/jwt"+window.location.search),n.onreadystatechange=function(e){return x(r,void 0,void 0,(function(){var e;return N(this,(function(r){return n.readyState===XMLHttpRequest.DONE&&(200===n.status?(this.log("JWT request returned: ".concat(n.responseText)),e=JSON.parse(n.responseText),this._serverUri=e.url,this._accessToken=e.jwt,this.selectUserMedia(this._requestedUserMedia,this._requiredUserMedia,t,this.getUserMediaSuccess.bind(this))):(this.log("JWT Request failed, status: ".concat(n.statusText),"error"),t.reject(G("Failed to acquire jwt at /api/jwt","noServer")))),[2]}))}))},n.send(),[2,t.promise])}))}))},e.prototype.webcamRequested=function(e,t){return!this._audioOnly&&[z.MicrophoneAndCamera,z.Camera].some((function(n){return[e,t].includes(n)}))},e.prototype.micRequested=function(e,t){return[z.Microphone,z.MicrophoneAndCamera].some((function(n){return[e,t].includes(n)}))},e.prototype.getMediaConstraints=function(e,t){var n=navigator.mediaDevices.getSupportedConstraints();return this.log("Browser supports media constraints: ".concat(n)),{audio:!!this.micRequested(e,t)&&this.buildAudioOptions(),video:!!this.webcamRequested(e,t)&&this._videoOptions}},e.prototype.buildAudioOptions=function(){var e=navigator.mediaDevices.getSupportedConstraints(),t=M({},this._audioOptions);return Object.keys(t).forEach((function(n){e[n]||delete t[n]})),t},e.prototype.selectUserMedia=function(e,t,n,r){var o=this;if(e!==z.None||t!==z.None)if(navigator.mediaDevices.getUserMedia){var i=this.getMediaConstraints(e,t);this.log("Best video constraints: ".concat(i)),navigator.mediaDevices.getUserMedia(i).then((function(e){r(e,n)})).catch((function(i){t===e?(o.log("getUserMedia could not get required media, error given: ".concat(i),"error"),n.reject(o.MakeErrorForUserMedia(i))):t!==z.None?o.getUserMediaRequiredOnlyFallback(t,n,r):e===z.MicrophoneAndCamera?o.getUserMediaAudioOnlyFallback(n,r):r(null,n)}))}else n.reject(G("Your browser does not support getUserMedia API","notSupported"));else r(null,n)},e.prototype.getUserMediaRequiredOnlyFallback=function(e,t,n){var r=this;this.log("Retrying with required media only");var o=this.getMediaConstraints(z.None,e);return this.log("Attempt constraints: ".concat(o)),navigator.mediaDevices.getUserMedia(o).then((function(e){n(e,t)})).catch((function(e){r.log("getUserMedia could not get required media, error given: ".concat(e),"error"),t.reject(r.MakeErrorForUserMedia(e))}))},e.prototype.getUserMediaAudioOnlyFallback=function(e,t){var n=this;this.log("Retrying with microphone only");var r={video:!1,audio:this.buildAudioOptions()};return this.log("Attempt constraints: ".concat(r)),navigator.mediaDevices.getUserMedia(r).then((function(n){t(n,e)})).catch((function(r){n.log("getUserMedia could not get microphone audio, error given: ".concat(r),"error"),t(null,e)}))},e.prototype.MakeErrorForUserMedia=function(e){return G(e.message,"noUserMedia")},e.prototype.getUserMediaSuccess=function(e,t){var n=this;this.log("Got user media"),this._localStream=e,this.microphoneMuted=!0,this.log("connecting to: ".concat(this._serverUri)),this._accessToken?this._serverConnection=new WebSocket(this._serverUri+"?access_token="+this._accessToken):this._serverConnection=new WebSocket(this._serverUri),this._serverConnection.onmessage=function(e){try{n.gotMessageFromServer(e,t)}catch(e){n.log("unexpected exception processing received message: ".concat(e),"error")}},this._serverConnection.onerror=function(e){t.isPending()&&t.reject(G("websocket failed","serverConnectionFailed"))},this._serverConnection.onopen=function(e){n.log("Websocket open"),n._connectionState.setConnectionState(W.SearchingForDigitalPerson)},this._serverConnection.onclose=function(e){n.log("websocket closed: code(".concat(e.code,"), reason(").concat(e.reason,"), clean(").concat(e.wasClean,")")),t.isRejected||n.close(!1,"normal",t)}},e.prototype.hasTurnServer=function(e){var t,n,r,o;if(!e)return!1;try{for(var i=k(e),s=i.next();!s.done;s=i.next()){var a=s.value;if(a&&a.urls)try{for(var c=(r=void 0,k(a.urls)),u=c.next();!u.done;u=c.next()){if(0===u.value.indexOf("turn:"))return!0}}catch(e){r={error:e}}finally{try{u&&!u.done&&(o=c.return)&&o.call(c)}finally{if(r)throw r.error}}}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return!1},e.prototype.gotMessageFromServer=function(e,t){var n,r,o=this,i=e.data;this.log("message received: ".concat(i));var s=JSON.parse(i),a=s.category,c=s.name,u=s.body;if("webrtc"!==a)return null!==this._controlConnection&&"scene"===a&&(this._controlOpen&&this._serverConnection.readyState===WebSocket.OPEN?this._controlConnection.send(i):this._controlQueue.push(i)),void this._onMessage(s);if("event"===s.kind)if("established"===c){this._connectionState.setConnectionState(W.DownloadingAssets);var l={iceServers:[]};if(u.iceServers&&(l.iceServers=u.iceServers,this.hasTurnServer(u.iceServers)&&(this.log("Detected turn server, forcing relay mode"),l.iceTransportPolicy="relay")),this.log("selected ice servers: ".concat(l.iceServers)),u.settings&&"number"==typeof u.settings.microphoneMuteDelay&&(this._microphoneMuteDelay=u.settings.microphoneMuteDelay),this.log("microphone mute delay after persona speech: ".concat(this._microphoneMuteDelay)),this._shouldLogToServer=null!==(r=null===(n=u.settings)||void 0===n?void 0:n.logToServer)&&void 0!==r&&r,this._peerConnection=new RTCPeerConnection(l),this._peerConnection.onicecandidate=this.gotIceCandidate.bind(this),"ontrack"in this._peerConnection&&!this._features.isEdge?(this._peerConnection.ontrack=function(e){"video"!==e.track.kind&&"audio"!==e.track.kind||o._remoteStream&&(o._audioOnly||"video"!==e.track.kind)||o.onRemoteStream(e.streams[0])},this.setupVideoElement()):this._peerConnection.onaddstream=function(e){o.onRemoteStream(e.stream)},this._peerConnection.oniceconnectionstatechange=function(e){o.log("ICE connection state: ".concat(o._peerConnection.iceConnectionState)),"failed"===o._peerConnection.iceConnectionState&&(G("ice connection failed","mediaStreamFailed"),t&&t.isPending()&&(o._serverConnection.close(),!o._controlConnection||o._controlConnection.readyState!==WebSocket.OPEN&&o._controlConnection.readyState!==WebSocket.CONNECTING||o._controlConnection.close(),t.reject(G("ice connection failed","mediaStreamFailed"))))},this.log("adding local media stream if any"),this._localStream)if(this._peerConnection.addTrack)try{this.log("adding local media stream by track"),this._localStream.getTracks().forEach((function(e){o._peerConnection.addTrack(e,o._localStream)}))}catch(e){this.log("error: ".concat(e),"error")}else this._peerConnection.addStream(this._localStream),this.log("adding local media stream by stream");if(this._peerConnection.addTransceiver("audio",{direction:"sendrecv"}),this._peerConnection.addTransceiver("video",{direction:"sendrecv"}),u.resumeSessionId){var p={voiceActivityDetection:!1,iceRestart:!0};this._sessionId=u.resumeSessionId,this._isResumedSession=!0,this.log("established, trying to resume session with session_id = ".concat(u.resumeSessionId)),this.createOffer(this._peerConnection,p).then((function(e){o.createdDescription.bind(o),o.createdDescription(e,"updateOffer")})).catch(this._sessionError.bind(this))}else{p={voiceActivityDetection:!1,iceRestart:!1};this._isResumedSession=!1,this.createOffer(this._peerConnection,p).then(this.createdDescription.bind(this)).catch(this._sessionError.bind(this))}}else if("accepted"===c){this._connectionState.setConnectionState(W.ConnectingToDigitalPerson),this.log("accepted, session_id = ".concat(u.sessionId)),this._sessionId=u.sessionId,this._resumeRequested=u.resumeRequested,this._server=u.server,this._sceneId=u.sceneId;for(var h=0;h<this._outgoingQueue.length;h++)this._outgoingQueue[h].body.sessionId=this._sessionId,this.sendMessage(this._outgoingQueue[h]);this._outgoingQueue=[];var d=function(){o&&o.sendCameraRotation()};window.addEventListener("orientationchange",d),this._removeListeners.push({target:window,name:"orientationchange",callback:d}),this.sendCameraRotation();var f=(document.defaultView||window).getComputedStyle(this._videoElement),v=parseInt("".concat(f.width),10),_=parseInt("".concat(f.height),10);this.log("accepted, sending video width/height: ".concat(v," / ").concat(_)),this.sendVideoBounds(v,_),this.sendlogMessage(this._pendingLog),this._pendingLog=[],u.controlUrl&&(this._controlUrl=u.controlUrl,this._controlQueue=[],this._controlOpen=!1,this._controlConnection=new WebSocket(u.controlUrl+"?access_token="+this._accessToken),this._controlConnection.onmessage=function(e){var t=e.data;t&&o._serverConnection.readyState===WebSocket.OPEN&&o._serverConnection.send(t)},this._controlConnection.onerror=function(){o.close(!0,"controlFailed",t)},this._controlConnection.onopen=function(e){if(o.log("control websocket open"),!o._controlOpen){o._controlOpen=!0;for(var t=0;t<o._controlQueue.length;t++)o.log("control websocket now open, forwarding queued message: ".concat(o._controlQueue[t])),o._controlConnection.send(o._controlQueue[t]);o._controlQueue=[]}},this._controlConnection.onclose=function(e){o.log("control closed: code(".concat(e.code,"), reason(").concat(e.reason,"), clean(").concat(e.wasClean,")")),o.close(!0,"controlDisconnected",t)})}else if("answer"===c){this.log("set remote description"),this.log(JSON.stringify(u));var y={sdp:u.sdp,type:"answer"};this.setRemoteDescription(this._peerConnection,y).then((function(){})).catch(this._sessionError.bind(this))}else if("connected"===c)this._remoteStream?(this._connectionState.setConnectionState(W.Connected),this.onConnectedSuccess(),t&&t.resolve(u.sessionId)):(this.log("Connected but no remote media stream available"),this._connectPendingRemoteStream=function(){o.onConnectedSuccess(),t&&t.resolve(u.sessionId)});else if("ice"===c){this.log("add ice candidate");var g=void 0;if(u.complete)this._features.isEdge&&(g=this._peerConnection.addIceCandidate(new RTCIceCandidate({candidate:"",sdpMid:"",sdpMLineIndex:0})));else{var m=new RTCIceCandidate({candidate:u.candidate,sdpMid:u.sdpMid,sdpMLineIndex:u.sdpMLineIndex});g=this._peerConnection.addIceCandidate(m)}g&&g.catch(this._sessionError.bind(this))}else if("offer"===c){this._sessionId=u.sessionId;y={sdp:u.sdp,type:"offer"};this.setRemoteDescription(this._peerConnection,y).then((function(){return o.createAnswer(o._peerConnection)})).then(this.createdDescription.bind(this)).catch(this._sessionError.bind(this))}else"userText"===c?(this.log("rtc - user text message received: ".concat(u.userText)),this._onUserText(u.userText)):"close"===c&&this.close(!1,u.reason,t)},e.prototype.setupVideoElement=function(){this._videoElement&&(this._videoElement.addEventListener("loadeddata",this.onVideoLoaded.bind(this)),this._removeListeners.push({target:this._videoElement,name:"loadeddata",callback:this.onVideoLoaded}))},e.prototype.gotIceCandidate=function(e){e.candidate?(this.log("got local ice candidate"),this.sendRtcEvent("ice",{complete:!1,candidate:e.candidate.candidate,sdpMid:e.candidate.sdpMid,sdpMLineIndex:e.candidate.sdpMLineIndex})):(this.log("end ice candidate"),this.sendRtcEvent("ice",{complete:!0,candidate:"",sdpMid:"",sdpMLineIndex:0}))},e.prototype.createdDescription=function(e,t){var n=this;void 0===t&&(t="offer"),this.log("got description");var r={sdp:e.sdp,type:e.type};this.log(JSON.stringify({sdp:r})),this.setLocalDescription(this._peerConnection,e).then((function(){n.log("send sdp offer to server"),n.sendRtcEvent(t,{sdp:n._peerConnection.localDescription?n._peerConnection.localDescription.sdp:null,type:n._peerConnection.localDescription?n._peerConnection.localDescription.type:null,user_text:n._connectUserText,features:{videoStartedEvent:!0}})})).catch(this._sessionError.bind(this))},e.prototype.onRemoteStream=function(e){this.log("got remote stream"),this._remoteStream=e,this.log("ICE connection state: ".concat(this._peerConnection.iceConnectionState)),this._connectPendingRemoteStream&&(this._connectPendingRemoteStream(),this._connectPendingRemoteStream=null)},e.prototype.copyStyleFromVideoElementToCanvas=function(){if(this._chromaKeyedCanvas&&this._videoElement){var e=getComputedStyle(this._videoElement),t=e.cssText;t||(t=Array.from(e).reduce((function(t,n){var r;return r="display"===n?e.getPropertyValue(n).replace("none",""):e.getPropertyValue(n),"".concat(t).concat(n,":").concat(r,";")}),""),this._chromaKeyedCanvas.style.cssText=t)}},e.prototype.observeAndCopyStyleChangesFromVideoElementToCanvas=function(){var e=this;this._videoElementStyleObserver||(this._videoElementStyleObserver=new MutationObserver((function(t,n){e.copyStyleFromVideoElementToCanvas()}))),this._videoElementStyleObserver.observe(this._videoElement,{attributes:!0}),this._videoElement.addEventListener("resize",this.copyStyleFromVideoElementToCanvas.bind(this))},e.prototype.processFrameForChromaKey=function(e,t){this._chromaKeyedCanvas&&(this._chromaKeyedCanvas.width=t.width,this._chromaKeyedCanvas.height=t.height,Ae(this._chromaKeyedCanvas.width,this._chromaKeyedCanvas.height,this._videoElement),this._videoElement.requestVideoFrameCallback(this.processFrameForChromaKey.bind(this)))},e.prototype.onConnectedSuccess=function(){var e,t,n,r=this;this._onConnected(this._resumeRequested,this._isResumedSession,this._server,this.sessionId),(null===(e=this._chromaKeyOptions)||void 0===e?void 0:e.enabled)&&this._videoElement?this.setupChromaKeyedVideo():this._videoElement&&(this._videoElement.srcObject=this._remoteStream,this._videoElement.hidden=!1);var o=function(e){return x(r,void 0,void 0,(function(){return N(this,(function(t){return this._remoteStream&&this._remoteStream.addTrack(e.track),[2]}))}))};this._peerConnection.addEventListener("track",o),this._removeListeners.push({target:this._peerConnection,name:"track",callback:o}),this.log("video enabled"),this.sendUserCamera(),null===(t=this._onMicrophoneActive)||void 0===t||t.call(this.isMicrophoneActive()),null===(n=this._onCameraActive)||void 0===n||n.call(this.isCameraActive())},e.prototype.hideVideoElement=function(e){e.hidden=!0,e.style.display="none"},e.prototype.setupChromaKeyedVideo=function(){var e;this._videoElement&&(null===(e=this._chromaKeyOptions)||void 0===e?void 0:e.enabled)&&(this.supportsInsertableStreams&&this.supportsTransferableStreams?this.setupTransferableStreamChromaKeyedVideo():(this.setupChromaKeyedCanvas(this._chromaKeyOptions),this._videoElement.srcObject=this._remoteStream,"requestVideoFrameCallback"in HTMLVideoElement.prototype?this.setupRequestVideoFrameCallbackChromaKeyedVideo():this.setupRequestAnimationFrameChromaKeyedVideo()))},e.prototype.setupChromaKeyedCanvas=function(e){var t;this._chromaKeyedCanvas=document.createElement("canvas"),this.copyStyleFromVideoElementToCanvas(),null===(t=this._videoElement.parentElement)||void 0===t||t.appendChild(this._chromaKeyedCanvas),this.hideVideoElement(this._videoElement),this.observeAndCopyStyleChangesFromVideoElementToCanvas(),ue(e),Oe(this._chromaKeyedCanvas)},e.prototype.setupTransferableStreamChromaKeyedVideo=function(){var e=new Worker("/dedicated-workers/chroma-key.worker.js",{type:"module"});if(e.postMessage({chromaKeyOptions:this._chromaKeyOptions}),window.RTCRtpScriptTransform){this._peerConnection.getTransceivers()[0].receiver.transform=new window.RTCRtpScriptTransform(e,{name:"receiverTransform"})}else{var t=this.getTrackByKind(this._remoteStream,"video"),n=this.getTrackByKind(this._remoteStream,"audio"),r=new MediaStreamTrackProcessor({track:t}).readable,o=new MediaStreamTrackGenerator({kind:"video"}),i=o.writable,s=new MediaStream([o]);s.addTrack(n),this._videoElement?(this._videoElement.srcObject=s,this._videoElement.hidden=!1):(this.videoMediaStream=s,this.sendRtcEvent("videoStarted",{})),e.postMessage({readable:r,writable:i},[r,i])}},e.prototype.setupRequestVideoFrameCallbackChromaKeyedVideo=function(){this._videoElement.requestVideoFrameCallback(this.processFrameForChromaKey.bind(this))},e.prototype.setupRequestAnimationFrameChromaKeyedVideo=function(){var e=this,t=function(){e._chromaKeyedCanvas&&(e._chromaKeyedCanvas.width=e._videoElement.videoWidth,e._chromaKeyedCanvas.height=e._videoElement.videoHeight,Ae(e._chromaKeyedCanvas.width,e._chromaKeyedCanvas.height,e._videoElement),setTimeout((function(){requestAnimationFrame(t)}),1e3/30))};requestAnimationFrame(t)},e.prototype.onVideoLoaded=function(e){var t=this;this.log("video has loaded");var n=function(){t.log("video has started playing"),t.sendRtcEvent("videoStarted",{}),t.microphoneMuted=!1};if(this._videoElement.muted){var r=function(){n(),t._videoElement.removeEventListener("volumechange",r)};this._videoElement.addEventListener("volumechange",r,!1)}else n()},e.prototype.sendRtcEvent=function(e,t){if(null!==this._serverConnection){this._sessionId&&(t.sessionId=this._sessionId);var n={category:"webrtc",kind:"event",name:e,body:t};this._sessionId||"offer"===e?this.sendMessage(n):this._outgoingQueue.push(n)}},e.prototype.sendVideoBounds=function(e,t){this.sendRtcEvent("videoBounds",{width:e,height:t})},e.prototype.sendUserCamera=function(e){var t={active:this.isCameraActive()};void 0!==e&&(t.rotation=e),this.sendRtcEvent("userCamera",t)},e.prototype.sendCameraRotation=function(){if(this._features.isIos){var e=window.orientation;this.log("send updated camera rotation, device orientation: ".concat(e));var t=0;0===e?t=90:90===e?t=180:180===e?t=270:-90===e&&(t=0),this.sendUserCamera(t)}},e.prototype.sendMessage=function(e){this._serverConnection&&(this._serverConnection.readyState===WebSocket.OPEN?this._serverConnection.send(JSON.stringify(e)):this.log("server connection not ready, discarding message: ".concat(e)))},e.prototype.sendUserText=function(e){this.sendRtcEvent("userText",{userText:e})},e.prototype.hasCamera=function(e){return e===z.Camera||e===z.MicrophoneAndCamera},e.prototype.hasMicrophone=function(e){return e===z.Microphone||e===z.MicrophoneAndCamera},e.prototype.makeUserMedia=function(e,t){return e&&t?z.MicrophoneAndCamera:e?z.Microphone:t?z.Camera:z.None},e.prototype.findSenderTrackByKind=function(e){var t,n,r;if(!this._peerConnection)return null;var o=this._peerConnection.getSenders();try{for(var i=k(o),s=i.next();!s.done;s=i.next()){var a=s.value;if(a.track&&(null===(r=a.track)||void 0===r?void 0:r.kind)===e)return a.track}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return null},e.prototype.findSenderByKind=function(e){var t,n,r,o,i,s;if(!this._peerConnection)return null;try{for(var a=k(this._peerConnection.getTransceivers()),c=a.next();!c.done;c=a.next()){var u=c.value;if("sendrecv"===u.direction&&(null===(s=null===(i=u.receiver)||void 0===i?void 0:i.track)||void 0===s?void 0:s.kind)===e)return u.sender}}catch(e){t={error:e}}finally{try{c&&!c.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}try{for(var l=k(this._peerConnection.getSenders()),p=l.next();!p.done;p=l.next()){var h=p.value;if(null===h.track||h.track.kind===e)return h}}catch(e){r={error:e}}finally{try{p&&!p.done&&(o=l.return)&&o.call(l)}finally{if(r)throw r.error}}return null},e.prototype.processChangeUserMediaQueue=function(){var e,t,n,r;return x(this,void 0,void 0,(function(){var o,i,s,a;return N(this,(function(c){switch(c.label){case 0:if(!(o=this._changeUserMediaQueue.length>0?this._changeUserMediaQueue[0]:void 0))return[3,5];c.label=1;case 1:return c.trys.push([1,3,,4]),i=this.isMicrophoneActive(),s=this.isCameraActive(),[4,this.changeUserMediaInternal(this.makeUserMedia(null!==(e=o.microphone)&&void 0!==e?e:i,null!==(t=o.camera)&&void 0!==t?t:s))];case 2:return c.sent(),void 0!==o.microphone&&o.microphone!==i&&(null===(n=this._onMicrophoneActive)||void 0===n||n.call(this.isMicrophoneActive())),void 0!==o.camera&&o.camera!==s&&(null===(r=this._onCameraActive)||void 0===r||r.call(this.isCameraActive())),o.deferred.resolve(),[3,4];case 3:return a=c.sent(),o.deferred.reject(a),[3,4];case 4:this._changeUserMediaQueue.shift(),c.label=5;case 5:if(o)return[3,0];c.label=6;case 6:return[2]}}))}))},e.prototype.changeUserMediaInternal=function(e){return x(this,void 0,Promise,(function(){var t,n,r,o,i,s,a,c=this;return N(this,(function(u){switch(u.label){case 0:return t=this.findSenderTrackByKind("audio"),n=this.findSenderTrackByKind("video"),r=this.hasMicrophone(e)&&(!t||"ended"===t.readyState),o=this.hasCamera(e)&&(!n||"ended"===n.readyState),i=null,r||o?(s=this.makeUserMedia(r,o),a=new B,this.selectUserMedia(s,s,a,(function(e,t){return x(c,void 0,void 0,(function(){return N(this,(function(n){return i=e,t.resolve(),[2]}))}))})),[4,a.promise]):[3,2];case 1:u.sent(),this._localStream||(this._localStream=new MediaStream),u.label=2;case 2:return[4,this.updateSenderTrack("audio",this.hasMicrophone(e),i)];case 3:return u.sent(),[4,this.updateSenderTrack("video",this.hasCamera(e),i)];case 4:return u.sent(),this.sendUserCamera(),[2]}}))}))},e.prototype.updateSenderTrack=function(e,t,n){var r,o;return x(this,void 0,Promise,(function(){var i,s,a,c;return N(this,(function(u){switch(u.label){case 0:if(i=this.findSenderByKind(e),s=null==i?void 0:i.track,!i||s&&t===s.enabled)return[3,7];if(this.log("new user "+e+" active state = "+t),!t)return[3,6];u.label=1;case 1:return u.trys.push([1,4,,5]),s&&(null===(r=this._localStream)||void 0===r||r.removeTrack(s)),n?(a=this.getTrackByKind(n,e))?(null===(o=this._localStream)||void 0===o||o.addTrack(a),i.track===a?[3,3]:(this.log("replacing user "+e+" track"),[4,i.replaceTrack(a)])):[3,3]:[3,3];case 2:u.sent(),u.label=3;case 3:return[3,5];case 4:throw c=u.sent(),this.log("failed to get user ".concat(e," track, error: ").concat(c),"error"),G("failed to get user "+e+": "+c,"failedUpgrade");case 5:return[3,7];case 6:s&&(s.enabled=!1,s.stop()),u.label=7;case 7:return[2]}}))}))},e.prototype.getTrackByKind=function(e,t){var n,r;if(e)try{for(var o=k(e.getTracks()),i=o.next();!i.done;i=o.next()){var s=i.value;if(s.kind===t)return s}}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}},e.prototype.isSenderTrackEnabled=function(e){var t=this.findSenderTrackByKind(e);return Boolean(null==t?void 0:t.enabled)},e.prototype.isMicrophoneActive=function(){return this.isSenderTrackEnabled("audio")},e.prototype.isCameraActive=function(){return this.isSenderTrackEnabled("video")},e.prototype.setMediaDeviceActive=function(e){var t=e.microphone,n=e.camera;return x(this,void 0,Promise,(function(){var e;return N(this,(function(r){return e=new B,this._changeUserMediaQueue.push({microphone:t,camera:n,deferred:e}),1===this._changeUserMediaQueue.length&&this.processChangeUserMediaQueue(),[2,e.promise]}))}))},e.prototype.close=function(e,t,n){var r,o;if(void 0===e&&(e=!0),void 0===t&&(t="normal"),!this._closed){if(this._closed=!0,this._peerConnection)try{this._peerConnection.close()}catch(e){this.log("error: ".concat(e),"error")}if(this._localStream)try{var i=this._localStream.getTracks();for(var s in i)i[s].stop()}catch(e){this.log("error: ".concat(e),"error")}e&&this.sendRtcEvent("close",{reason:"normal"}),n&&(n.isResolved()?this._onClose(t):n.reject(G("websocket closed: "+t,t))),this._serverConnection&&(this.log("closing server connection"),this._serverConnection.close()),this._controlConnection&&this._controlConnection.close();try{for(var a=k(this._removeListeners),c=a.next();!c.done;c=a.next()){var u=c.value;u.target.removeEventListener(u.name,u.callback)}}catch(e){r={error:e}}finally{try{c&&!c.done&&(o=a.return)&&o.call(a)}finally{if(r)throw r.error}}}},e.prototype.createOffer=function(e,t){return e.createOffer(t)},e.prototype.setRemoteDescription=function(e,t){return e.setRemoteDescription(t)},e.prototype.setLocalDescription=function(e,t){return e.setLocalDescription(t)},e.prototype.createAnswer=function(e){return e.createAnswer()},Object.defineProperty(e.prototype,"peerConnection",{get:function(){return this._peerConnection},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"serverConnection",{get:function(){return this._serverConnection},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sessionId",{get:function(){return this._sessionId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"server",{get:function(){return this._server},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sceneId",{get:function(){return this._sceneId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isMicrophoneConnected",{get:function(){return!!this.findSenderTrackByKind("audio")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isCameraConnected",{get:function(){return!!this.findSenderTrackByKind("video")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"features",{get:function(){return this._features},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"microphoneMuteDelay",{get:function(){return this._microphoneMuteDelay},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"userMediaStream",{get:function(){return this._localStream},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"microphoneMuted",{get:function(){if(!this._localStream)return!0;var e=this._localStream.getAudioTracks();return!e||e.length<1||!e[0].enabled},set:function(e){var t,n;if(this._localStream){var r=this._localStream.getAudioTracks();if(r&&!(r.length<1)){var o=this.findSenderByKind("audio");if("live"===(null===(t=null==o?void 0:o.track)||void 0===t?void 0:t.readyState)&&o.track===r[0]){var i=!e;r[0].enabled=i,this.log("microphone muted active notification: ".concat(i)),null===(n=this._onMicrophoneActive)||void 0===n||n.call(i)}}}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"webcamMuted",{get:function(){if(!this._localStream)return!0;var e=this._localStream.getVideoTracks();return!e||e.length<1||!e[0].enabled},set:function(e){var t,n;if(this._localStream){var r=this._localStream.getVideoTracks();if(r&&!(r.length<1)){var o=this.findSenderByKind("video");if("live"===(null===(t=null==o?void 0:o.track)||void 0===t?void 0:t.readyState)&&o.track===r[0]){var i=!e;r[0].enabled=i,null===(n=this._onCameraActive)||void 0===n||n.call(i)}}}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"offsetX",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"offsetY",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"microphoneActiveCallbacks",{set:function(e){this._onMicrophoneActive=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cameraActiveCallbacks",{set:function(e){this._onCameraActive=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"supportsEncodedTransform",{get:function(){return Boolean(window.RTCRtpScriptTransform)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"supportsInsertableStreams",{get:function(){return!(void 0===window.RTCRtpSender||!window.RTCRtpSender.prototype.createEncodedStreams)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"supportsTransferableStreams",{get:function(){var e=new ReadableStream;try{return window.postMessage(e,"*",[e]),!0}catch(e){return!1}},enumerable:!1,configurable:!0}),e}(),ke=function(){function e(e,t,n){void 0===n&&(n=new F);var r=this;this.logger=n,this._outgoingQueue=[],this._onConnectedStorage=function(e,t,n,r){},this._pendingLog=[],this._closed=!1,this._shouldLogToServer=!1,this._serverUri=e,this._accessToken=t,this._onClose=function(e){},this._onMessage=function(e){},this._sessionError=function(e){r.logger.log("error","session error: ".concat(e))},this._features=new j}return e.prototype.setVideoElement=function(e){},Object.defineProperty(e.prototype,"onConnected",{set:function(e){this._onConnectedStorage=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onClose",{set:function(e){this._onClose=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onMessage",{set:function(e){this._onMessage=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"loggingEnabled",{get:function(){return this.logger.isEnabled},set:function(e){this.logger.log("warn","loggingEnabled is deprecated and will be removed in a future version. Please use setLogging(boolean)"),this.logger.enableLogging(e)},enumerable:!1,configurable:!0}),e.prototype.setMinLogLevel=function(e){this.logger.setMinLogLevel(e)},e.prototype.setLogging=function(e){this.logger.enableLogging(e)},e.prototype.log=function(e){this.loggingEnabled&&(this._shouldLogToServer?this.logToServer(e):this.logger.log("log",e))},e.prototype.logToServer=function(e){this.sessionId?this.sendlogMessage([e]):this._pendingLog.push(e)},e.prototype.sendlogMessage=function(e){if(this._sessionId&&e&&e.length>0){var t={category:"diagnostics",kind:"event",name:"log",body:{name:"browser",text:e}};this.sendMessage(t)}},e.prototype.connect=function(){return x(this,void 0,Promise,(function(){var e;return N(this,(function(t){return e=new B,this._closed=!1,this._serverUri&&(this._serverUri.startsWith("ws:")||this._serverUri.startsWith("wss:"))&&this.connectByWebSocket(e),[2,e.promise]}))}))},e.prototype.connectByWebSocket=function(e){var t=this;this.log("connecting to: ".concat(this._serverUri)),this._accessToken?this._serverConnection=new WebSocket(this._serverUri+"?access_token="+this._accessToken):this._serverConnection=new WebSocket(this._serverUri),this._serverConnection.onmessage=function(n){t.gotMessageFromServer(n,e)},this._serverConnection.onerror=function(t){e.isPending()&&e.reject(G("websocket failed","serverConnectionFailed"))},this._serverConnection.onopen=function(n){t.log("websocket open"),e.resolve()},this._serverConnection.onclose=function(n){t.log("websocket closed: code(".concat(n.code,"), reason(").concat(n.reason,"), clean(").concat(n.wasClean,")")),e.isRejected||t.close(!1,"normal",e)}},e.prototype.gotMessageFromServer=function(e,t){var n=e.data;this.log("message received: ".concat(n));var r=JSON.parse(n),o=r.category,i=r.name,s=r.body;if("webrtc"===o){if("event"===r.kind)if("accepted"===i){this.log("accepted, session_id = ".concat(s.sessionId)),this._sessionId=s.sessionId;for(var a=0;a<this._outgoingQueue.length;a++)this._outgoingQueue[a].body.sessionId=this._sessionId,this.sendMessage(this._outgoingQueue[a]);this._outgoingQueue=[],this.sendlogMessage(this._pendingLog),this._pendingLog=[]}else"close"===i&&this.close(!1,s.reason,t)}else this._onMessage(r)},e.prototype.sendMessage=function(e){this._serverConnection&&(this._serverConnection.readyState===WebSocket.OPEN?this._serverConnection.send(JSON.stringify(e)):this.log("not ready, discarding message: ".concat(e)))},e.prototype.close=function(e,t,n){void 0===e&&(e=!0),void 0===t&&(t="normal"),this._closed||(this._closed=!0,n&&(n.isResolved()?this._onClose(t):n.reject(G("websocket closed: "+t,t))),this._serverConnection&&(this.log("closing server connection"),this._serverConnection.close()))},Object.defineProperty(e.prototype,"serverConnection",{get:function(){return this._serverConnection},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sessionId",{get:function(){return this._sessionId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"peerConnection",{get:function(){return null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"features",{get:function(){return this._features},enumerable:!1,configurable:!0}),e.prototype.sendRtcEvent=function(e,t){},e.prototype.sendVideoBounds=function(e,t){},e.prototype.sendUserText=function(e){this.logger.log("error","WebSocketSession discarding text: "+e)},Object.defineProperty(e.prototype,"microphoneMuteDelay",{get:function(){},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"microphoneMuted",{get:function(){return null},set:function(e){},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onUserText",{set:function(e){},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isMicrophoneConnected",{get:function(){return null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isCameraConnected",{get:function(){return null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"offsetX",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"offsetY",{get:function(){return 0},enumerable:!1,configurable:!0}),e.prototype.isMicrophoneActive=function(){return!1},e.prototype.isCameraActive=function(){return!1},e.prototype.setMediaDeviceActive=function(e){e.microphone,e.camera;return x(this,void 0,Promise,(function(){return N(this,(function(e){throw G("setMediaDeviceActive not supported on WebSocketSession","notSupported")}))}))},e}();!function(e){e.Scene="scene"}(Me||(Me={})),function(e){e.Response="response",e.Request="request"}(Ie||(Ie={})),function(e){e.Idle="idle",e.Animating="animating",e.Speaking="speaking"}(xe||(xe={}));var Ue,De=[],Be="ResizeObserver loop completed with undelivered notifications.";!function(e){e.BORDER_BOX="border-box",e.CONTENT_BOX="content-box",e.DEVICE_PIXEL_CONTENT_BOX="device-pixel-content-box"}(Ue||(Ue={}));var je,Ve=function(e){return Object.freeze(e)},Fe=function(e,t){this.inlineSize=e,this.blockSize=t,Ve(this)},Ge=function(){function e(e,t,n,r){return this.x=e,this.y=t,this.width=n,this.height=r,this.top=this.y,this.left=this.x,this.bottom=this.top+this.height,this.right=this.left+this.width,Ve(this)}return e.prototype.toJSON=function(){var e=this;return{x:e.x,y:e.y,top:e.top,right:e.right,bottom:e.bottom,left:e.left,width:e.width,height:e.height}},e.fromRect=function(t){return new e(t.x,t.y,t.width,t.height)},e}(),Xe=function(e){return e instanceof SVGElement&&"getBBox"in e},Ke=function(e){if(Xe(e)){var t=e.getBBox(),n=t.width,r=t.height;return!n&&!r}var o=e,i=o.offsetWidth,s=o.offsetHeight;return!(i||s||e.getClientRects().length)},qe=function(e){var t;if(e instanceof Element)return!0;var n=null===(t=null==e?void 0:e.ownerDocument)||void 0===t?void 0:t.defaultView;return!!(n&&e instanceof n.Element)},ze="undefined"!=typeof window?window:{},He=new WeakMap,We=/auto|scroll/,Ye=/^tb|vertical/,Qe=/msie|trident/i.test(ze.navigator&&ze.navigator.userAgent),Je=function(e){return parseFloat(e||"0")},Ze=function(e,t,n){return void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=!1),new Fe((n?t:e)||0,(n?e:t)||0)},$e=Ve({devicePixelContentBoxSize:Ze(),borderBoxSize:Ze(),contentBoxSize:Ze(),contentRect:new Ge(0,0,0,0)}),et=function(e,t){if(void 0===t&&(t=!1),He.has(e)&&!t)return He.get(e);if(Ke(e))return He.set(e,$e),$e;var n=getComputedStyle(e),r=Xe(e)&&e.ownerSVGElement&&e.getBBox(),o=!Qe&&"border-box"===n.boxSizing,i=Ye.test(n.writingMode||""),s=!r&&We.test(n.overflowY||""),a=!r&&We.test(n.overflowX||""),c=r?0:Je(n.paddingTop),u=r?0:Je(n.paddingRight),l=r?0:Je(n.paddingBottom),p=r?0:Je(n.paddingLeft),h=r?0:Je(n.borderTopWidth),d=r?0:Je(n.borderRightWidth),f=r?0:Je(n.borderBottomWidth),v=p+u,_=c+l,y=(r?0:Je(n.borderLeftWidth))+d,g=h+f,m=a?e.offsetHeight-g-e.clientHeight:0,b=s?e.offsetWidth-y-e.clientWidth:0,E=o?v+y:0,T=o?_+g:0,S=r?r.width:Je(n.width)-E-b,O=r?r.height:Je(n.height)-T-m,w=S+v+b+y,R=O+_+m+g,C=Ve({devicePixelContentBoxSize:Ze(Math.round(S*devicePixelRatio),Math.round(O*devicePixelRatio),i),borderBoxSize:Ze(w,R,i),contentBoxSize:Ze(S,O,i),contentRect:new Ge(p,c,S,O)});return He.set(e,C),C},tt=function(e,t,n){var r=et(e,n),o=r.borderBoxSize,i=r.contentBoxSize,s=r.devicePixelContentBoxSize;switch(t){case Ue.DEVICE_PIXEL_CONTENT_BOX:return s;case Ue.BORDER_BOX:return o;default:return i}},nt=function(e){var t=et(e);this.target=e,this.contentRect=t.contentRect,this.borderBoxSize=Ve([t.borderBoxSize]),this.contentBoxSize=Ve([t.contentBoxSize]),this.devicePixelContentBoxSize=Ve([t.devicePixelContentBoxSize])},rt=function(e){if(Ke(e))return 1/0;for(var t=0,n=e.parentNode;n;)t+=1,n=n.parentNode;return t},ot=function(){var e=1/0,t=[];De.forEach((function(n){if(0!==n.activeTargets.length){var r=[];n.activeTargets.forEach((function(t){var n=new nt(t.target),o=rt(t.target);r.push(n),t.lastReportedSize=tt(t.target,t.observedBox),o<e&&(e=o)})),t.push((function(){n.callback.call(n.observer,r,n.observer)})),n.activeTargets.splice(0,n.activeTargets.length)}}));for(var n=0,r=t;n<r.length;n++){(0,r[n])()}return e},it=function(e){De.forEach((function(t){t.activeTargets.splice(0,t.activeTargets.length),t.skippedTargets.splice(0,t.skippedTargets.length),t.observationTargets.forEach((function(n){n.isActive()&&(rt(n.target)>e?t.activeTargets.push(n):t.skippedTargets.push(n))}))}))},st=function(){var e,t=0;for(it(t);De.some((function(e){return e.activeTargets.length>0}));)t=ot(),it(t);return De.some((function(e){return e.skippedTargets.length>0}))&&("function"==typeof ErrorEvent?e=new ErrorEvent("error",{message:Be}):((e=document.createEvent("Event")).initEvent("error",!1,!1),e.message=Be),window.dispatchEvent(e)),t>0},at=[],ct=function(e){if(!je){var t=0,n=document.createTextNode("");new MutationObserver((function(){return at.splice(0).forEach((function(e){return e()}))})).observe(n,{characterData:!0}),je=function(){n.textContent="".concat(t?t--:t++)}}at.push(e),je()},ut=0,lt={attributes:!0,characterData:!0,childList:!0,subtree:!0},pt=["resize","load","transitionend","animationend","animationstart","animationiteration","keyup","keydown","mouseup","mousedown","mouseover","mouseout","blur","focus"],ht=function(e){return void 0===e&&(e=0),Date.now()+e},dt=!1,ft=new(function(){function e(){var e=this;this.stopped=!0,this.listener=function(){return e.schedule()}}return e.prototype.run=function(e){var t=this;if(void 0===e&&(e=250),!dt){dt=!0;var n,r=ht(e);n=function(){var n=!1;try{n=st()}finally{if(dt=!1,e=r-ht(),!ut)return;n?t.run(1e3):e>0?t.run(e):t.start()}},ct((function(){requestAnimationFrame(n)}))}},e.prototype.schedule=function(){this.stop(),this.run()},e.prototype.observe=function(){var e=this,t=function(){return e.observer&&e.observer.observe(document.body,lt)};document.body?t():ze.addEventListener("DOMContentLoaded",t)},e.prototype.start=function(){var e=this;this.stopped&&(this.stopped=!1,this.observer=new MutationObserver(this.listener),this.observe(),pt.forEach((function(t){return ze.addEventListener(t,e.listener,!0)})))},e.prototype.stop=function(){var e=this;this.stopped||(this.observer&&this.observer.disconnect(),pt.forEach((function(t){return ze.removeEventListener(t,e.listener,!0)})),this.stopped=!0)},e}()),vt=function(e){!ut&&e>0&&ft.start(),!(ut+=e)&&ft.stop()},_t=function(){function e(e,t){this.target=e,this.observedBox=t||Ue.CONTENT_BOX,this.lastReportedSize={inlineSize:0,blockSize:0}}return e.prototype.isActive=function(){var e,t=tt(this.target,this.observedBox,!0);return e=this.target,Xe(e)||function(e){switch(e.tagName){case"INPUT":if("image"!==e.type)break;case"VIDEO":case"AUDIO":case"EMBED":case"OBJECT":case"CANVAS":case"IFRAME":case"IMG":return!0}return!1}(e)||"inline"!==getComputedStyle(e).display||(this.lastReportedSize=t),this.lastReportedSize.inlineSize!==t.inlineSize||this.lastReportedSize.blockSize!==t.blockSize},e}(),yt=function(e,t){this.activeTargets=[],this.skippedTargets=[],this.observationTargets=[],this.observer=e,this.callback=t},gt=new WeakMap,mt=function(e,t){for(var n=0;n<e.length;n+=1)if(e[n].target===t)return n;return-1},bt=function(){function e(){}return e.connect=function(e,t){var n=new yt(e,t);gt.set(e,n)},e.observe=function(e,t,n){var r=gt.get(e),o=0===r.observationTargets.length;mt(r.observationTargets,t)<0&&(o&&De.push(r),r.observationTargets.push(new _t(t,n&&n.box)),vt(1),ft.schedule())},e.unobserve=function(e,t){var n=gt.get(e),r=mt(n.observationTargets,t),o=1===n.observationTargets.length;r>=0&&(o&&De.splice(De.indexOf(n),1),n.observationTargets.splice(r,1),vt(-1))},e.disconnect=function(e){var t=this,n=gt.get(e);n.observationTargets.slice().forEach((function(n){return t.unobserve(e,n.target)})),n.activeTargets.splice(0,n.activeTargets.length)},e}(),Et=function(){function e(e){if(0===arguments.length)throw new TypeError("Failed to construct 'ResizeObserver': 1 argument required, but only 0 present.");if("function"!=typeof e)throw new TypeError("Failed to construct 'ResizeObserver': The callback provided as parameter 1 is not a function.");bt.connect(this,e)}return e.prototype.observe=function(e,t){if(0===arguments.length)throw new TypeError("Failed to execute 'observe' on 'ResizeObserver': 1 argument required, but only 0 present.");if(!qe(e))throw new TypeError("Failed to execute 'observe' on 'ResizeObserver': parameter 1 is not of type 'Element");bt.observe(this,e,t)},e.prototype.unobserve=function(e){if(0===arguments.length)throw new TypeError("Failed to execute 'unobserve' on 'ResizeObserver': 1 argument required, but only 0 present.");if(!qe(e))throw new TypeError("Failed to execute 'unobserve' on 'ResizeObserver': parameter 1 is not of type 'Element");bt.unobserve(this,e)},e.prototype.disconnect=function(){bt.disconnect(this)},e.toString=function(){return"function ResizeObserver () { [polyfill code] }"},e}();const Tt=function(){return Promise.all(Array.from(document.images).filter((function(e){return!e.complete})).map((function(e){return new Promise((function(t){e.onload=t,e.onerror=t}))})))};var St=function(){function e(e,t,n){void 0===t&&(t=300),void 0===n&&(n=new F);var r=this;this.scene=e,this.debounceTime=t,this.logger=n,this.VIDEO_FRAME_STR="data-sm-video",this.VIDEO_FRAME_STR_BRACKETED="[".concat(this.VIDEO_FRAME_STR,"]"),this.CONTENT_STR="data-sm-content",this.CONTENT_STR_BRACKETED="[".concat(this.CONTENT_STR,"]"),this.CUE_ATTRIBUTES=[this.VIDEO_FRAME_STR,this.CONTENT_STR],this.CUE_ATTRIBUTES_BRACKETED=[this.VIDEO_FRAME_STR_BRACKETED,this.CONTENT_STR_BRACKETED].join(),this.RESIZE_OBSERVER_BOX_OPTIONS="border-box",this.callMeasure=!1,this.contentCollection={},this.videoFrame=null,this.debouncedMeasure=function(e,t){void 0===t&&(t=500);var n=-1;return function(){n&&clearTimeout(n),n=setTimeout((function(){return e()}),t)}}((function(){return r.measureInternal()}),t),this.resizeObserver=new Et((function(){return r.measureDebounced()})),this.getInitialElements(),this.mutationObserver=new MutationObserver((function(e){return r.mutationCallback(e)})),this.setupEventListeners(),this.observeMutations(),this.measureInternal()}return e.prototype.isLoggingEnabled=function(){return this.logger.isEnabled},e.prototype.setLogging=function(e){this.logger.enableLogging(e)},e.prototype.getMinLogLevel=function(){return this.logger.getMinLogLevel()},e.prototype.setMinLogLevel=function(e){this.logger.setMinLogLevel(e)},e.prototype.setupEventListeners=function(){var e=this;window.addEventListener("resize",(function(){return e.measureDebounced()}))},e.prototype.getInitialElements=function(){var e=this,t=document.querySelector(this.VIDEO_FRAME_STR_BRACKETED),n=document.querySelectorAll(this.CONTENT_STR_BRACKETED);this.trackVideoElement(t),Array.from(n).map((function(t){return e.trackContentElement(t)}))},e.prototype.observeMutations=function(){var e=document.documentElement||document.body;this.mutationObserver.observe(e,{attributeFilter:this.CUE_ATTRIBUTES,attributeOldValue:!0,childList:!0,subtree:!0})},e.prototype.disconnect=function(){var e=this;this.mutationObserver.disconnect(),this.resizeObserver.disconnect(),window.removeEventListener("resize",(function(){return e.measureDebounced()})),this.scene.contentAwareness=void 0},e.prototype.reconnect=function(){this.scene.contentAwareness=this,this.observeMutations(),this.setupEventListeners(),this.measure()},e.prototype.measure=function(){this.measureInternal()},e.prototype.measureDebounced=function(){this.debouncedMeasure()},e.prototype.measureInternal=function(){if(this.scene.isConnected()){var e=this.measureWindow(),t=this.measureVideoFrame(),n=this.measureContent();if(e&&t&&n){var r=this.buildUpdateContentAwarenessRequest(e.innerWidth,e.innerHeight,t,n);this.scene.sendRequest("updateContentAwareness",r)}}else this.logger.log("error","ContentAwareness: Scene does not exist or is not connected yet")},e.prototype.measureVideoFrame=function(){if(!this.videoFrame)return this.logger.log("warn","ContentAwareness: Unable to find a video element"),null;var e=this.videoFrame.getBoundingClientRect();return this.invalidDimensions(e)?(this.logger.log("warn","ContentAwareness: Video has a zero width and height"),null):{x1:Math.round(e.left),x2:Math.round(e.right),y1:Math.round(e.top),y2:Math.round(e.bottom)}},e.prototype.measureContent=function(){var e=this,t=[];return Object.keys(this.contentCollection).map((function(n){var r=e.contentCollection[n].getBoundingClientRect();if(e.invalidDimensions(r)&&e.logger.log("warn","ContentAwareness: Element '".concat(n,"' has a zero width and height")),e.invalidContent(r))return e.logger.log("warn","ContentAwareness: Element '".concat(n,"' is not being tracked")),void delete e.contentCollection[n];t.push({id:n,x1:Math.round(r.left),x2:Math.round(r.right),y1:Math.round(r.top),y2:Math.round(r.bottom)})})),t},e.prototype.invalidDimensions=function(e){return 0===e.width&&0===e.height},e.prototype.invalidContent=function(e){return 0===e.top&&0===e.bottom&&0===e.right&&0===e.left},e.prototype.measureWindow=function(){return{innerHeight:Math.round(window.innerHeight),innerWidth:Math.round(window.innerWidth)}},e.prototype.buildUpdateContentAwarenessRequest=function(e,t,n,r){return{viewWidth:e,viewHeight:t,videoFrame:n,content:r}},e.prototype.trackVideoElement=function(e){e&&(this.videoFrame&&(this.logger.log("warn","ContentAwareness: Already observing a video element, switching to new video element"),this.untrackVideoElement(this.videoFrame)),this.videoFrame=e,this.resizeObserver.observe(this.videoFrame,{box:this.RESIZE_OBSERVER_BOX_OPTIONS}))},e.prototype.trackContentElement=function(e){var t=e.getAttribute(this.CONTENT_STR);return!!t&&(this.contentCollection[t]=e,this.resizeObserver.observe(e,{box:this.RESIZE_OBSERVER_BOX_OPTIONS}),!0)},e.prototype.untrackContentElement=function(e){var t=e.getAttribute(this.CONTENT_STR);e===this.contentCollection[t]&&(delete this.contentCollection[t],this.resizeObserver.unobserve(e))},e.prototype.untrackVideoElement=function(e){e===this.videoFrame&&(this.videoFrame=null),this.resizeObserver.unobserve(e)},e.prototype.mutationCallback=function(e){var t=this,n=!1;this.callMeasure=!1;for(var r=0;r<e.length;++r)switch(e[r].type){case"childList":if(e[r].target.nodeType!==Node.ELEMENT_NODE)break;this.untrackRemovedNodeWithCUE(e[r].removedNodes),this.trackAddedNodeWithCUE(e[r].addedNodes);for(var o=0;o<e[r].addedNodes.length;o++)try{if(!(a=e[r].addedNodes[o]).hasAttribute)continue;var i="IMG"===a.tagName,s=!!a.querySelector("img");if(n=i||s)break}catch(t){this.logger.log("warn","ContentAwareness: Failed to track non-element node",e[r].addedNodes[o])}break;case"attributes":if(e[r].target.nodeType!==Node.ELEMENT_NODE)break;try{var a=e[r].target,c=e[r].attributeName;if(c===this.VIDEO_FRAME_STR)a.hasAttribute(c)?(this.trackVideoElement(a),this.callMeasure=!0):this.videoFrame&&this.untrackVideoElement(a);else if(c===this.CONTENT_STR){var u=a.getAttribute(c),l=e[r].oldValue;l&&(this.resizeObserver.unobserve(this.contentCollection[l]),delete this.contentCollection[l]),u&&(this.contentCollection[u]=a,this.resizeObserver.observe(a,{box:this.RESIZE_OBSERVER_BOX_OPTIONS})),this.callMeasure=!0}break}catch(t){this.logger.log("warn","ContentAwareness: Failed to track non-element node",e[r].target)}}this.callMeasure&&(n?Tt().then((function(){t.measureDebounced()})):this.measureDebounced())},e.prototype.trackAddedNodeWithCUE=function(e){var t=this;e.forEach((function(e){try{var n=e;if(!n.hasAttribute)return;n.hasAttribute(t.VIDEO_FRAME_STR)?(t.trackVideoElement(n),t.callMeasure=!0):n.hasAttribute(t.CONTENT_STR)&&(t.callMeasure=t.trackContentElement(n)),null!==n.querySelector(t.CUE_ATTRIBUTES_BRACKETED)&&n.querySelectorAll(t.CUE_ATTRIBUTES_BRACKETED).forEach((function(e){e.hasAttribute(t.VIDEO_FRAME_STR)?(t.trackVideoElement(e),t.callMeasure=!0):e.hasAttribute(t.CONTENT_STR)&&(t.callMeasure=t.trackContentElement(e))}))}catch(n){t.logger.log("warn","ContentAwareness: Failed to track non-element node",e)}}))},e.prototype.untrackRemovedNodeWithCUE=function(e){var t=this;e.forEach((function(e){try{var n=e;if(!n.hasAttribute)return;n.hasAttribute(t.VIDEO_FRAME_STR)?t.untrackVideoElement(n):n.hasAttribute(t.CONTENT_STR)&&(t.untrackContentElement(n),t.callMeasure=!0),null!==n.querySelector(t.CUE_ATTRIBUTES_BRACKETED)&&n.querySelectorAll(t.CUE_ATTRIBUTES_BRACKETED).forEach((function(e){e.hasAttribute(t.VIDEO_FRAME_STR)?t.untrackVideoElement(e):e.hasAttribute(t.CONTENT_STR)&&(t.untrackContentElement(e),t.callMeasure=!0)}))}catch(n){t.logger.log("warn","ContentAwareness: Failed to track non-element node",e)}}))},e}(),Ot="object"==typeof globalThis?globalThis:"object"==typeof self?self:"object"==typeof window?window:"object"==typeof e.g?e.g:{},wt="1.2.0",Rt=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;var Ct=function(e){var t=new Set([e]),n=new Set,r=e.match(Rt);if(!r)return function(){return!1};var o=+r[1],i=+r[2],s=+r[3];if(null!=r[4])return function(t){return t===e};function a(e){return n.add(e),!1}function c(e){return t.add(e),!0}return function(e){if(t.has(e))return!0;if(n.has(e))return!1;var r=e.match(Rt);if(!r)return a(e);var u=+r[1],l=+r[2],p=+r[3];return null!=r[4]||o!==u?a(e):0===o?i===l&&s<=p?c(e):a(e):i<=l?c(e):a(e)}}(wt),At=wt.split(".")[0],Pt=Symbol.for("opentelemetry.js.api."+At),Lt=Ot;function Mt(e,t,n,r){var o;void 0===r&&(r=!1);var i=Lt[Pt]=null!==(o=Lt[Pt])&&void 0!==o?o:{version:wt};if(!r&&i[e]){var s=new Error("@opentelemetry/api: Attempted duplicate registration of API: "+e);return n.error(s.stack||s.message),!1}if(i.version!==wt){s=new Error("@opentelemetry/api: All API registration versions must match");return n.error(s.stack||s.message),!1}return i[e]=t,n.debug("@opentelemetry/api: Registered a global for "+e+" v"+wt+"."),!0}function It(e){var t,n,r=null===(t=Lt[Pt])||void 0===t?void 0:t.version;if(r&&Ct(r))return null===(n=Lt[Pt])||void 0===n?void 0:n[e]}function xt(e,t){t.debug("@opentelemetry/api: Unregistering a global for "+e+" v"+wt+".");var n=Lt[Pt];n&&delete n[e]}var Nt,kt=function(){function e(e){this._namespace=e.namespace||"DiagComponentLogger"}return e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Ut("debug",this._namespace,e)},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Ut("error",this._namespace,e)},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Ut("info",this._namespace,e)},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Ut("warn",this._namespace,e)},e.prototype.verbose=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Ut("verbose",this._namespace,e)},e}();function Ut(e,t,n){var r=It("diag");if(r)return n.unshift(t),r[e].apply(r,n)}!function(e){e[e.NONE=0]="NONE",e[e.ERROR=30]="ERROR",e[e.WARN=50]="WARN",e[e.INFO=60]="INFO",e[e.DEBUG=70]="DEBUG",e[e.VERBOSE=80]="VERBOSE",e[e.ALL=9999]="ALL"}(Nt||(Nt={}));var Dt=function(){function e(){function e(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=It("diag");if(r)return r[e].apply(r,t)}}var t=this;t.setLogger=function(e,n){var r,o;if(void 0===n&&(n=Nt.INFO),e===t){var i=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return t.error(null!==(r=i.stack)&&void 0!==r?r:i.message),!1}var s=It("diag"),a=function(e,t){function n(n,r){var o=t[n];return"function"==typeof o&&e>=r?o.bind(t):function(){}}return e<Nt.NONE?e=Nt.NONE:e>Nt.ALL&&(e=Nt.ALL),t=t||{},{error:n("error",Nt.ERROR),warn:n("warn",Nt.WARN),info:n("info",Nt.INFO),debug:n("debug",Nt.DEBUG),verbose:n("verbose",Nt.VERBOSE)}}(n,e);if(s){var c=null!==(o=(new Error).stack)&&void 0!==o?o:"<failed to generate stacktrace>";s.warn("Current logger will be overwritten from "+c),a.warn("Current logger will overwrite one already registered from "+c)}return Mt("diag",a,t,!0)},t.disable=function(){xt("diag",t)},t.createComponentLogger=function(e){return new kt(e)},t.verbose=e("verbose"),t.debug=e("debug"),t.info=e("info"),t.warn=e("warn"),t.error=e("error")}return e.instance=function(){return this._instance||(this._instance=new e),this._instance},e}(),Bt=function(){function e(e){this._entries=e?new Map(e):new Map}return e.prototype.getEntry=function(e){var t=this._entries.get(e);if(t)return Object.assign({},t)},e.prototype.getAllEntries=function(){return Array.from(this._entries.entries()).map((function(e){return[e[0],e[1]]}))},e.prototype.setEntry=function(t,n){var r=new e(this._entries);return r._entries.set(t,n),r},e.prototype.removeEntry=function(t){var n=new e(this._entries);return n._entries.delete(t),n},e.prototype.removeEntries=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=new e(this._entries),o=0,i=t;o<i.length;o++){var s=i[o];r._entries.delete(s)}return r},e.prototype.clear=function(){return new e},e}(),jt=Symbol("BaggageEntryMetadata"),Vt=Dt.instance();function Ft(e){return void 0===e&&(e={}),new Bt(new Map(Object.entries(e)))}function Gt(e){return"string"!=typeof e&&(Vt.error("Cannot create baggage metadata from unknown type: "+typeof e),e=""),{__TYPE__:jt,toString:function(){return e}}}var Xt={get:function(e,t){if(null!=e)return e[t]},keys:function(e){return null==e?[]:Object.keys(e)}},Kt={set:function(e,t,n){null!=e&&(e[t]=n)}};function qt(e){return Symbol.for(e)}var zt,Ht=function e(t){var n=this;n._currentContext=t?new Map(t):new Map,n.getValue=function(e){return n._currentContext.get(e)},n.setValue=function(t,r){var o=new e(n._currentContext);return o._currentContext.set(t,r),o},n.deleteValue=function(t){var r=new e(n._currentContext);return r._currentContext.delete(t),r}},Wt=new Ht,Yt=function(e,t){for(var n=0,r=t.length,o=e.length;n<r;n++,o++)e[o]=t[n];return e},Qt=function(){function e(){}return e.prototype.active=function(){return Wt},e.prototype.with=function(e,t,n){for(var r=[],o=3;o<arguments.length;o++)r[o-3]=arguments[o];return t.call.apply(t,Yt([n],r))},e.prototype.bind=function(e,t){return t},e.prototype.enable=function(){return this},e.prototype.disable=function(){return this},e}(),Jt=function(e,t){for(var n=0,r=t.length,o=e.length;n<r;n++,o++)e[o]=t[n];return e},Zt="context",$t=new Qt,en=function(){function e(){}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalContextManager=function(e){return Mt(Zt,e,Dt.instance())},e.prototype.active=function(){return this._getContextManager().active()},e.prototype.with=function(e,t,n){for(var r,o=[],i=3;i<arguments.length;i++)o[i-3]=arguments[i];return(r=this._getContextManager()).with.apply(r,Jt([e,t,n],o))},e.prototype.bind=function(e,t){return this._getContextManager().bind(e,t)},e.prototype._getContextManager=function(){return It(Zt)||$t},e.prototype.disable=function(){this._getContextManager().disable(),xt(Zt,Dt.instance())},e}();!function(e){e[e.NONE=0]="NONE",e[e.SAMPLED=1]="SAMPLED"}(zt||(zt={}));var tn="0000000000000000",nn="00000000000000000000000000000000",rn={traceId:nn,spanId:tn,traceFlags:zt.NONE},on=function(){function e(e){void 0===e&&(e=rn),this._spanContext=e}return e.prototype.spanContext=function(){return this._spanContext},e.prototype.setAttribute=function(e,t){return this},e.prototype.setAttributes=function(e){return this},e.prototype.addEvent=function(e,t){return this},e.prototype.setStatus=function(e){return this},e.prototype.updateName=function(e){return this},e.prototype.end=function(e){},e.prototype.isRecording=function(){return!1},e.prototype.recordException=function(e,t){},e}(),sn=qt("OpenTelemetry Context Key SPAN");function an(e){return e.getValue(sn)||void 0}function cn(){return an(en.getInstance().active())}function un(e,t){return e.setValue(sn,t)}function ln(e){return e.deleteValue(sn)}function pn(e,t){return un(e,new on(t))}function hn(e){var t;return null===(t=an(e))||void 0===t?void 0:t.spanContext()}var dn=/^([0-9a-f]{32})$/i,fn=/^[0-9a-f]{16}$/i;function vn(e){return dn.test(e)&&e!==nn}function _n(e){return vn(e.traceId)&&(t=e.spanId,fn.test(t)&&t!==tn);var t}function yn(e){return new on(e)}var gn=en.getInstance(),mn=function(){function e(){}return e.prototype.startSpan=function(e,t,n){if(Boolean(null==t?void 0:t.root))return new on;var r,o=n&&hn(n);return"object"==typeof(r=o)&&"string"==typeof r.spanId&&"string"==typeof r.traceId&&"number"==typeof r.traceFlags&&_n(o)?new on(o):new on},e.prototype.startActiveSpan=function(e,t,n,r){var o,i,s;if(!(arguments.length<2)){2===arguments.length?s=t:3===arguments.length?(o=t,s=n):(o=t,i=n,s=r);var a=null!=i?i:gn.active(),c=this.startSpan(e,o,a),u=un(a,c);return gn.with(u,s,void 0,c)}},e}();var bn,En,Tn,Sn=new mn,On=function(){function e(e,t,n,r){this._provider=e,this.name=t,this.version=n,this.options=r}return e.prototype.startSpan=function(e,t,n){return this._getTracer().startSpan(e,t,n)},e.prototype.startActiveSpan=function(e,t,n,r){var o=this._getTracer();return Reflect.apply(o.startActiveSpan,o,arguments)},e.prototype._getTracer=function(){if(this._delegate)return this._delegate;var e=this._provider.getDelegateTracer(this.name,this.version,this.options);return e?(this._delegate=e,this._delegate):Sn},e}(),wn=new(function(){function e(){}return e.prototype.getTracer=function(e,t,n){return new mn},e}()),Rn=function(){function e(){}return e.prototype.getTracer=function(e,t,n){var r;return null!==(r=this.getDelegateTracer(e,t,n))&&void 0!==r?r:new On(this,e,t,n)},e.prototype.getDelegate=function(){var e;return null!==(e=this._delegate)&&void 0!==e?e:wn},e.prototype.setDelegate=function(e){this._delegate=e},e.prototype.getDelegateTracer=function(e,t,n){var r;return null===(r=this._delegate)||void 0===r?void 0:r.getTracer(e,t,n)},e}();!function(e){e[e.NOT_RECORD=0]="NOT_RECORD",e[e.RECORD=1]="RECORD",e[e.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"}(bn||(bn={})),function(e){e[e.INTERNAL=0]="INTERNAL",e[e.SERVER=1]="SERVER",e[e.CLIENT=2]="CLIENT",e[e.PRODUCER=3]="PRODUCER",e[e.CONSUMER=4]="CONSUMER"}(En||(En={})),function(e){e[e.UNSET=0]="UNSET",e[e.OK=1]="OK",e[e.ERROR=2]="ERROR"}(Tn||(Tn={}));var Cn="[_0-9a-z-*/]",An=new RegExp("^(?:"+("[a-z]"+Cn+"{0,255}")+"|"+("[a-z0-9]"+Cn+"{0,240}@[a-z]"+Cn+"{0,13}")+")$"),Pn=/^[ -~]{0,255}[!-~]$/,Ln=/,|=/;!function(){function e(e){this._internalState=new Map,e&&this._parse(e)}e.prototype.set=function(e,t){var n=this._clone();return n._internalState.has(e)&&n._internalState.delete(e),n._internalState.set(e,t),n},e.prototype.unset=function(e){var t=this._clone();return t._internalState.delete(e),t},e.prototype.get=function(e){return this._internalState.get(e)},e.prototype.serialize=function(){var e=this;return this._keys().reduce((function(t,n){return t.push(n+"="+e.get(n)),t}),[]).join(",")},e.prototype._parse=function(e){e.length>512||(this._internalState=e.split(",").reverse().reduce((function(e,t){var n=t.trim(),r=n.indexOf("=");if(-1!==r){var o=n.slice(0,r),i=n.slice(r+1,t.length);(function(e){return An.test(e)})(o)&&function(e){return Pn.test(e)&&!Ln.test(e)}(i)&&e.set(o,i)}return e}),new Map),this._internalState.size>32&&(this._internalState=new Map(Array.from(this._internalState.entries()).reverse().slice(0,32))))},e.prototype._keys=function(){return Array.from(this._internalState.keys()).reverse()},e.prototype._clone=function(){var t=new e;return t._internalState=new Map(this._internalState),t}}();var Mn="trace",In=function(){function e(){this._proxyTracerProvider=new Rn,this.wrapSpanContext=yn,this.isSpanContextValid=_n,this.deleteSpan=ln,this.getSpan=an,this.getActiveSpan=cn,this.getSpanContext=hn,this.setSpan=un,this.setSpanContext=pn}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalTracerProvider=function(e){var t=Mt(Mn,this._proxyTracerProvider,Dt.instance());return t&&this._proxyTracerProvider.setDelegate(e),t},e.prototype.getTracerProvider=function(){return It(Mn)||this._proxyTracerProvider},e.prototype.getTracer=function(e,t){return this.getTracerProvider().getTracer(e,t)},e.prototype.disable=function(){xt(Mn,Dt.instance()),this._proxyTracerProvider=new Rn},e}(),xn=function(){function e(){}return e.prototype.inject=function(e,t){},e.prototype.extract=function(e,t){return e},e.prototype.fields=function(){return[]},e}(),Nn=qt("OpenTelemetry Baggage Key");function kn(e){return e.getValue(Nn)||void 0}function Un(e,t){return e.setValue(Nn,t)}function Dn(e){return e.deleteValue(Nn)}var Bn="propagation",jn=new xn,Vn=function(){function e(){this.createBaggage=Ft,this.getBaggage=kn,this.setBaggage=Un,this.deleteBaggage=Dn}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalPropagator=function(e){return Mt(Bn,e,Dt.instance())},e.prototype.inject=function(e,t,n){return void 0===n&&(n=Kt),this._getGlobalPropagator().inject(e,t,n)},e.prototype.extract=function(e,t,n){return void 0===n&&(n=Xt),this._getGlobalPropagator().extract(e,t,n)},e.prototype.fields=function(){return this._getGlobalPropagator().fields()},e.prototype.disable=function(){xt(Bn,Dt.instance())},e.prototype._getGlobalPropagator=function(){return It(Bn)||jn},e}(),Fn=en.getInstance(),Gn=In.getInstance(),Xn=Vn.getInstance(),Kn=Dt.instance();const qn=function(e,t){return void 0===t&&(t=z.None),e?e.camera&&e.microphone?z.MicrophoneAndCamera:e.camera?z.Camera:e.microphone?z.Microphone:z.None:t};function zn(e){try{if(!e)return;var t=new URL(e);return t.pathname="",t.search="",t.toString()}catch(e){return}}var Hn;!function(e){e.dpSpeaking="dpSpeaking",e.userSpeaking="userSpeaking",e.dpProcessing="dpProcessing",e.idle="idle"}(Hn||(Hn={}));var Wn=function(){function e(e){void 0===e&&(e=new F),this.logger=e,this._conversationState=Hn.idle,this._userActive=!1,this._onConversationStateUpdated=new C}return e.prototype.processStateMessage=function(e){if(e&&e.persona&&Object.keys(e.persona).length>0){var t=Object.keys(e.persona)[0];if(!this._userActive&&e.persona[t].speechState){var n=e.persona[t].speechState;n===xe.Idle?this.setSpeechState(Hn.idle):n===xe.Speaking&&this.setSpeechState(Hn.dpSpeaking)}}},e.prototype.processRecognizeResultsMessage=function(e){this._userActive=!0;var t=0!==e.status,n=e.results&&e.results.some((function(e){return e.final}));if(t){var r=void 0!==e.errorMessage?e.errorMessage:"recognizeResults sent back a message with non-zero status but no error message.";this.logger.log("error",r)}else n?this.setSpeechState(Hn.dpProcessing):this.setSpeechState(Hn.userSpeaking);this._userActive=!1},e.prototype.setSpeechState=function(e){this._conversationState!==e&&(this._conversationState=e,this._onConversationStateUpdated.call(this._conversationState))},e.prototype.getSpeechState=function(){return this._conversationState},Object.defineProperty(e.prototype,"onConversationStateUpdated",{get:function(){return this._onConversationStateUpdated},enumerable:!1,configurable:!0}),e.prototype.reset=function(){this._userActive=!1,this._conversationState=Hn.idle,this._onConversationStateUpdated.call(this._conversationState)},e}(),Yn=function(){function e(){}return e.prototype.format=function(e){var t,n=null===(t=e.provider.meta.dialogflow)||void 0===t?void 0:t.queryResult.fulfillmentMessages,r=null==n?void 0:n.find((function(e){return Boolean(null==e?void 0:e.payload)}));return r?this.formatLegacyDialogflow(r):this.formatContextData(e.output.context)},e.prototype.formatLegacyDialogflow=function(e){var t=this,n=e.payload.soulmachines;return Object.keys(n).map((function(e){return{id:e,data:M({id:e},t.formatCardData(n[e]))}}))},e.prototype.formatContextData=function(e){var t=this;return this.allowedIds(e).map((function(n){var r=n.replace("public-","");return{id:r,data:M({id:r},t.formatCardData(e[n]))}}))},e.prototype.allowedIds=function(e){return Object.keys(e).filter((function(e){return!0===/public-/.test(e)})).filter((function(e){return!1===/\.original/gm.test(e)}))},e.prototype.formatCardData=function(e){var t="string"==typeof e?JSON.parse(e):e,n=t.component,r=t.type,o=I(t,["component","type"]);return M({type:r||n},o)},e}(),Qn=function(){function e(e,t,n){void 0===e&&(e=new F),void 0===t&&(t=new Wn),void 0===n&&(n=new Yn),this.logger=e,this.conversationState=t,this.contentCardFormatter=n,this._onCardChanged=new C,this._autoClearCards=!1,this.cardData=new Map,this.activeCardIds=new Set}return e.prototype.processStateMessage=function(e){this.conversationState.processStateMessage(e)},e.prototype.processRecognizeResultsMessage=function(e){this.conversationState.processRecognizeResultsMessage(e)},Object.defineProperty(e.prototype,"onConversationStateUpdated",{get:function(){return this.conversationState.onConversationStateUpdated},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"autoClearCards",{set:function(e){this._autoClearCards=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onCardChanged",{get:function(){return this._onCardChanged},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"activeCards",{get:function(){var e=this,t=[];return this.activeCardIds.forEach((function(n){var r=e.cardData.get(n);r?t.push(r):e.logger.log("error","card data for ".concat(n," does not exist"))})),t},enumerable:!1,configurable:!0}),e.prototype.onSpeechMarker=function(e){var t=e.arguments;e.name===X.Showcards?this.addActiveCardIds(t):e.name===X.Hidecards&&this.removeActiveCards(t),0===t.length&&e.name===X.Hidecards&&this.clearActiveCards()},e.prototype.onConversationResult=function(e){var t=this,n=this.contentCardFormatter.format(e);this._autoClearCards&&this.clearActiveCards(),n.map((function(e){var n=e.id,r=e.data;t.cardData.set(n,r)}))},e.prototype.reset=function(){this.clearActiveCards(),this.cardData.clear(),this.conversationState.reset()},e.prototype.clearActiveCards=function(){this.activeCardIds.clear(),this.onCardChanged.call(this.activeCards)},e.prototype.addActiveCardIds=function(e){this.activeCardIds=new Set(D(D([],U(this.activeCardIds),!1),U(e),!1)),this.onCardChanged.call(this.activeCards)},e.prototype.removeActiveCards=function(e){var t=this;e.forEach((function(e){return t.activeCardIds.delete(e)})),this.onCardChanged.call(this.activeCards)},e}(),Jn=function(){function e(e){var t=this;this.scene=e,this._previousUrl=window.location.href,this._observer=new MutationObserver((function(){return t.observeDocumentChanges()}))}return e.prototype.observeUrlChanges=function(){this._observer.observe(document,{subtree:!0,childList:!0})},e.prototype.disconnect=function(){this._observer.disconnect()},e.prototype.send=function(){var e={personaId:this.scene.currentPersonaId,text:H.PAGE_METADATA,variables:{pageUrl:window.location.href.split("?")[0]},optionalArgs:{}};this.scene.sendRequest("conversationSend",e)},e.prototype.observeDocumentChanges=function(){window.location.href!==this._previousUrl&&(this._previousUrl=window.location.href,this.send())},e}(),Zn=Object.keys(W).length,$n=function(){function e(){this._connectionState={name:W.Disconnected,totalSteps:Zn,currentStep:0,percentageLoaded:0},this._onConnectionStateUpdated=new C}return e.prototype.setConnectionState=function(e){if(this._connectionState.name!==e){var t=Object.keys(W).indexOf(e),n={name:e,currentStep:t,totalSteps:Zn,percentageLoaded:100/(Zn-1)*t};this._connectionState=n,this._onConnectionStateUpdated.call(n)}},e.prototype.getConnectionState=function(){return this._connectionState},Object.defineProperty(e.prototype,"onConnectionStateUpdated",{get:function(){return this._onConnectionStateUpdated},enumerable:!1,configurable:!0}),e.prototype.reset=function(){this.setConnectionState(W.Disconnected)},e}(),er="process.pid",tr="process.executable.name",nr="process.executable.path",rr="process.command",or="process.command_line",ir="process.runtime.name",sr="process.runtime.version",ar="process.runtime.description",cr="service.name",ur="telemetry.sdk.name",lr="telemetry.sdk.language",pr="telemetry.sdk.version",hr=qt("OpenTelemetry SDK Context Key SUPPRESS_TRACING");function dr(e){return!0===e.getValue(hr)}var fr="=",vr=";",_r=",",yr="baggage",gr=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s};function mr(e){var t=e.split(vr);if(!(t.length<=0)){var n=t.shift();if(n){var r=n.split(fr);if(2===r.length){var o,i=decodeURIComponent(r[0].trim()),s=decodeURIComponent(r[1].trim());return t.length>0&&(o=Gt(t.join(vr))),{key:i,value:s,metadata:o}}}}}function br(e){return"string"!=typeof e||0===e.length?{}:e.split(_r).map((function(e){return mr(e)})).filter((function(e){return void 0!==e&&e.value.length>0})).reduce((function(e,t){return e[t.key]=t.value,e}),{})}(function(){function e(){}e.prototype.inject=function(e,t,n){var r=Xn.getBaggage(e);if(r&&!dr(e)){var o=function(e){return e.getAllEntries().map((function(e){var t=gr(e,2),n=t[0],r=t[1],o=encodeURIComponent(n)+"="+encodeURIComponent(r.value);return void 0!==r.metadata&&(o+=vr+r.metadata.toString()),o}))}(r).filter((function(e){return e.length<=4096})).slice(0,180),i=function(e){return e.reduce((function(e,t){var n=""+e+(""!==e?_r:"")+t;return n.length>8192?e:n}),"")}(o);i.length>0&&n.set(t,yr,i)}},e.prototype.extract=function(e,t,n){var r=n.get(t,yr),o=Array.isArray(r)?r.join(_r):r;if(!o)return e;var i={};return 0===o.length?e:(o.split(_r).forEach((function(e){var t=mr(e);if(t){var n={value:t.value};t.metadata&&(n.metadata=t.metadata),i[t.key]=n}})),0===Object.entries(i).length?e:Xn.setBaggage(e,Xn.createBaggage(i)))},e.prototype.fields=function(){return[yr]}})(),function(){function e(e,t){this._monotonicClock=t,this._epochMillis=e.now(),this._performanceMillis=t.now()}e.prototype.now=function(){var e=this._monotonicClock.now()-this._performanceMillis;return this._epochMillis+e}}();var Er,Tr=function(e){Kn.error(function(e){return"string"==typeof e?e:JSON.stringify(function(e){for(var t={},n=e;null!==n;)Object.getOwnPropertyNames(n).forEach((function(e){if(!t[e]){var r=n[e];r&&(t[e]=String(r))}})),n=Object.getPrototypeOf(n);return t}(e))}(e))};function Sr(e){try{Tr(e)}catch(e){}}!function(e){e.AlwaysOff="always_off",e.AlwaysOn="always_on",e.ParentBasedAlwaysOff="parentbased_always_off",e.ParentBasedAlwaysOn="parentbased_always_on",e.ParentBasedTraceIdRatio="parentbased_traceidratio",e.TraceIdRatio="traceidratio"}(Er||(Er={}));var Or="object"==typeof globalThis?globalThis:"object"==typeof self?self:"object"==typeof window?window:"object"==typeof e.g?e.g:{},wr=",",Rr=["OTEL_BSP_EXPORT_TIMEOUT","OTEL_BSP_MAX_EXPORT_BATCH_SIZE","OTEL_BSP_MAX_QUEUE_SIZE","OTEL_BSP_SCHEDULE_DELAY","OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_ATTRIBUTE_COUNT_LIMIT","OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT","OTEL_SPAN_EVENT_COUNT_LIMIT","OTEL_SPAN_LINK_COUNT_LIMIT","OTEL_EXPORTER_OTLP_TIMEOUT","OTEL_EXPORTER_OTLP_TRACES_TIMEOUT","OTEL_EXPORTER_OTLP_METRICS_TIMEOUT","OTEL_EXPORTER_JAEGER_AGENT_PORT"];function Cr(e){return Rr.indexOf(e)>-1}var Ar=["OTEL_NO_PATCH_MODULES","OTEL_PROPAGATORS"];function Pr(e){return Ar.indexOf(e)>-1}var Lr=1/0,Mr={CONTAINER_NAME:"",ECS_CONTAINER_METADATA_URI_V4:"",ECS_CONTAINER_METADATA_URI:"",HOSTNAME:"",KUBERNETES_SERVICE_HOST:"",NAMESPACE:"",OTEL_BSP_EXPORT_TIMEOUT:3e4,OTEL_BSP_MAX_EXPORT_BATCH_SIZE:512,OTEL_BSP_MAX_QUEUE_SIZE:2048,OTEL_BSP_SCHEDULE_DELAY:5e3,OTEL_EXPORTER_JAEGER_AGENT_HOST:"",OTEL_EXPORTER_JAEGER_AGENT_PORT:6832,OTEL_EXPORTER_JAEGER_ENDPOINT:"",OTEL_EXPORTER_JAEGER_PASSWORD:"",OTEL_EXPORTER_JAEGER_USER:"",OTEL_EXPORTER_OTLP_ENDPOINT:"",OTEL_EXPORTER_OTLP_TRACES_ENDPOINT:"",OTEL_EXPORTER_OTLP_METRICS_ENDPOINT:"",OTEL_EXPORTER_OTLP_HEADERS:"",OTEL_EXPORTER_OTLP_TRACES_HEADERS:"",OTEL_EXPORTER_OTLP_METRICS_HEADERS:"",OTEL_EXPORTER_OTLP_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_TRACES_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_METRICS_TIMEOUT:1e4,OTEL_EXPORTER_ZIPKIN_ENDPOINT:"http://localhost:9411/api/v2/spans",OTEL_LOG_LEVEL:Nt.INFO,OTEL_NO_PATCH_MODULES:[],OTEL_PROPAGATORS:["tracecontext","baggage"],OTEL_RESOURCE_ATTRIBUTES:"",OTEL_SERVICE_NAME:"",OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT:Lr,OTEL_ATTRIBUTE_COUNT_LIMIT:128,OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT:Lr,OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT:128,OTEL_SPAN_EVENT_COUNT_LIMIT:128,OTEL_SPAN_LINK_COUNT_LIMIT:128,OTEL_TRACES_EXPORTER:"none",OTEL_TRACES_SAMPLER:Er.ParentBasedAlwaysOn,OTEL_TRACES_SAMPLER_ARG:"",OTEL_EXPORTER_OTLP_INSECURE:"",OTEL_EXPORTER_OTLP_TRACES_INSECURE:"",OTEL_EXPORTER_OTLP_METRICS_INSECURE:"",OTEL_EXPORTER_OTLP_CERTIFICATE:"",OTEL_EXPORTER_OTLP_TRACES_CERTIFICATE:"",OTEL_EXPORTER_OTLP_METRICS_CERTIFICATE:"",OTEL_EXPORTER_OTLP_COMPRESSION:"",OTEL_EXPORTER_OTLP_TRACES_COMPRESSION:"",OTEL_EXPORTER_OTLP_METRICS_COMPRESSION:"",OTEL_EXPORTER_OTLP_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_TRACES_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_METRICS_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_TRACES_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_METRICS_CLIENT_CERTIFICATE:""};function Ir(e,t,n,r,o){if(void 0===r&&(r=-1/0),void 0===o&&(o=1/0),void 0!==n[e]){var i=Number(n[e]);isNaN(i)||(t[e]=i<r?r:i>o?o:i)}}function xr(e,t,n,r){void 0===r&&(r=wr);var o=n[e];"string"==typeof o&&(t[e]=o.split(r).map((function(e){return e.trim()})))}var Nr={ALL:Nt.ALL,VERBOSE:Nt.VERBOSE,DEBUG:Nt.DEBUG,INFO:Nt.INFO,WARN:Nt.WARN,ERROR:Nt.ERROR,NONE:Nt.NONE};function kr(e,t,n){var r=n[e];if("string"==typeof r){var o=Nr[r.toUpperCase()];null!=o&&(t[e]=o)}}function Ur(e){var t={};for(var n in Mr){var r=n;if("OTEL_LOG_LEVEL"===r)kr(r,t,e);else if(Cr(r))Ir(r,t,e);else if(Pr(r))xr(r,t,e);else{var o=e[r];null!=o&&(t[r]=String(o))}}return t}function Dr(){var e=Ur(Or);return Object.assign({},Mr,e)}function Br(e){for(var t=e.length,n="",r=0;r<t;r+=2){var o=e.substring(r,r+2),i=parseInt(o,16);n+=String.fromCharCode(i)}return btoa(n)}Array(32);var jr,Vr=performance,Fr="process.runtime.name",Gr="telemetry.sdk.language",Xr="telemetry.sdk.version",Kr=((jr={})["telemetry.sdk.name"]="opentelemetry",jr[Fr]="browser",jr[Gr]="webjs",jr[Xr]="1.7.0",jr);var qr,zr=9,Hr=Math.pow(10,zr);function Wr(e){var t=e/1e3,n=Math.trunc(t);return[n,Number((t-n).toFixed(zr))*Hr]}function Yr(){var e=Vr.timeOrigin;if("number"!=typeof e){var t=Vr;e=t.timing&&t.timing.fetchStart}return e}function Qr(e){var t=Wr(Yr()),n=Wr("number"==typeof e?e:Vr.now()),r=t[0]+n[0],o=t[1]+n[1];return o>Hr&&(o-=Hr,r+=1),[r,o]}function Jr(e){return e[0]*Hr+e[1]}function Zr(e){return Math.round(1e6*e[0]+e[1]/1e3)}!function(e){e[e.SUCCESS=0]="SUCCESS",e[e.FAILED=1]="FAILED"}(qr||(qr={}));var $r=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},eo=(function(){function e(e){var t;void 0===e&&(e={}),this._propagators=null!==(t=e.propagators)&&void 0!==t?t:[],this._fields=Array.from(new Set(this._propagators.map((function(e){return"function"==typeof e.fields?e.fields():[]})).reduce((function(e,t){return e.concat(t)}),[])))}e.prototype.inject=function(e,t,n){var r,o;try{for(var i=$r(this._propagators),s=i.next();!s.done;s=i.next()){var a=s.value;try{a.inject(e,t,n)}catch(e){Kn.warn("Failed to inject with "+a.constructor.name+". Err: "+e.message)}}}catch(e){r={error:e}}finally{try{s&&!s.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}},e.prototype.extract=function(e,t,n){return this._propagators.reduce((function(e,r){try{return r.extract(e,t,n)}catch(e){Kn.warn("Failed to inject with "+r.constructor.name+". Err: "+e.message)}return e}),e)},e.prototype.fields=function(){return this._fields.slice()}}(),"[_0-9a-z-*/]"),to=new RegExp("^(?:"+("[a-z]"+eo+"{0,255}")+"|"+("[a-z0-9]"+eo+"{0,240}@[a-z]"+eo+"{0,13}")+")$"),no=/^[ -~]{0,255}[!-~]$/,ro=/,|=/;var oo=function(){function e(e){this._internalState=new Map,e&&this._parse(e)}return e.prototype.set=function(e,t){var n=this._clone();return n._internalState.has(e)&&n._internalState.delete(e),n._internalState.set(e,t),n},e.prototype.unset=function(e){var t=this._clone();return t._internalState.delete(e),t},e.prototype.get=function(e){return this._internalState.get(e)},e.prototype.serialize=function(){var e=this;return this._keys().reduce((function(t,n){return t.push(n+"="+e.get(n)),t}),[]).join(",")},e.prototype._parse=function(e){e.length>512||(this._internalState=e.split(",").reverse().reduce((function(e,t){var n=t.trim(),r=n.indexOf("=");if(-1!==r){var o=n.slice(0,r),i=n.slice(r+1,t.length);(function(e){return to.test(e)})(o)&&function(e){return no.test(e)&&!ro.test(e)}(i)&&e.set(o,i)}return e}),new Map),this._internalState.size>32&&(this._internalState=new Map(Array.from(this._internalState.entries()).reverse().slice(0,32))))},e.prototype._keys=function(){return Array.from(this._internalState.keys()).reverse()},e.prototype._clone=function(){var t=new e;return t._internalState=new Map(this._internalState),t},e}(),io="traceparent",so="tracestate",ao=new RegExp("^\\s?((?!ff)[\\da-f]{2})-((?![0]{32})[\\da-f]{32})-((?![0]{16})[\\da-f]{16})-([\\da-f]{2})(-.*)?\\s?$");var co;(function(){function e(){}e.prototype.inject=function(e,t,n){var r=Gn.getSpanContext(e);if(r&&!dr(e)&&_n(r)){var o="00-"+r.traceId+"-"+r.spanId+"-0"+Number(r.traceFlags||zt.NONE).toString(16);n.set(t,io,o),r.traceState&&n.set(t,so,r.traceState.serialize())}},e.prototype.extract=function(e,t,n){var r=n.get(t,io);if(!r)return e;var o=Array.isArray(r)?r[0]:r;if("string"!=typeof o)return e;var i=function(e){var t=ao.exec(e);return t?"00"===t[1]&&t[5]?null:{traceId:t[2],spanId:t[3],traceFlags:parseInt(t[4],16)}:null}(o);if(!i)return e;i.isRemote=!0;var s=n.get(t,so);if(s){var a=Array.isArray(s)?s.join(","):s;i.traceState=new oo("string"==typeof a?a:void 0)}return Gn.setSpanContext(e,i)},e.prototype.fields=function(){return[io,so]}})(),qt("OpenTelemetry SDK Context Key RPC_METADATA");!function(e){e.HTTP="http"}(co||(co={}));var uo=function(){function e(){}return e.prototype.shouldSample=function(){return{decision:bn.NOT_RECORD}},e.prototype.toString=function(){return"AlwaysOffSampler"},e}(),lo=function(){function e(){}return e.prototype.shouldSample=function(){return{decision:bn.RECORD_AND_SAMPLED}},e.prototype.toString=function(){return"AlwaysOnSampler"},e}(),po=(function(){function e(e){var t,n,r,o;this._root=e.root,this._root||(Sr(new Error("ParentBasedSampler must have a root sampler configured")),this._root=new lo),this._remoteParentSampled=null!==(t=e.remoteParentSampled)&&void 0!==t?t:new lo,this._remoteParentNotSampled=null!==(n=e.remoteParentNotSampled)&&void 0!==n?n:new uo,this._localParentSampled=null!==(r=e.localParentSampled)&&void 0!==r?r:new lo,this._localParentNotSampled=null!==(o=e.localParentNotSampled)&&void 0!==o?o:new uo}e.prototype.shouldSample=function(e,t,n,r,o,i){var s=Gn.getSpanContext(e);return s&&_n(s)?s.isRemote?s.traceFlags&zt.SAMPLED?this._remoteParentSampled.shouldSample(e,t,n,r,o,i):this._remoteParentNotSampled.shouldSample(e,t,n,r,o,i):s.traceFlags&zt.SAMPLED?this._localParentSampled.shouldSample(e,t,n,r,o,i):this._localParentNotSampled.shouldSample(e,t,n,r,o,i):this._root.shouldSample(e,t,n,r,o,i)},e.prototype.toString=function(){return"ParentBased{root="+this._root.toString()+", remoteParentSampled="+this._remoteParentSampled.toString()+", remoteParentNotSampled="+this._remoteParentNotSampled.toString()+", localParentSampled="+this._localParentSampled.toString()+", localParentNotSampled="+this._localParentNotSampled.toString()+"}"}}(),function(){function e(e){void 0===e&&(e=0),this._ratio=e,this._ratio=this._normalize(e),this._upperBound=Math.floor(4294967295*this._ratio)}e.prototype.shouldSample=function(e,t){return{decision:vn(t)&&this._accumulate(t)<this._upperBound?bn.RECORD_AND_SAMPLED:bn.NOT_RECORD}},e.prototype.toString=function(){return"TraceIdRatioBased{"+this._ratio+"}"},e.prototype._normalize=function(e){return"number"!=typeof e||isNaN(e)?0:e>=1?1:e<=0?0:e},e.prototype._accumulate=function(e){for(var t=0,n=0;n<e.length/8;n++){var r=8*n;t=(t^parseInt(e.slice(r,r+8),16))>>>0}return t}}(),Function.prototype.toString),ho=(po.call(Object),function(e,t){}(Object.getPrototypeOf,Object),Object.prototype);ho.hasOwnProperty,Symbol&&Symbol.toStringTag,ho.toString;var fo=function(){function e(){var e=this;this._promise=new Promise((function(t,n){e._resolve=t,e._reject=n}))}return Object.defineProperty(e.prototype,"promise",{get:function(){return this._promise},enumerable:!1,configurable:!0}),e.prototype.resolve=function(e){this._resolve(e)},e.prototype.reject=function(e){this._reject(e)},e}(),vo=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s},_o=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},yo=function(){function e(e,t){this._callback=e,this._that=t,this._isCalled=!1,this._deferred=new fo}return Object.defineProperty(e.prototype,"isCalled",{get:function(){return this._isCalled},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"promise",{get:function(){return this._deferred.promise},enumerable:!1,configurable:!0}),e.prototype.call=function(){for(var e,t=this,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];if(!this._isCalled){this._isCalled=!0;try{Promise.resolve((e=this._callback).call.apply(e,_o([this._that],vo(n),!1))).then((function(e){return t._deferred.resolve(e)}),(function(e){return t._deferred.reject(e)}))}catch(e){this._deferred.reject(e)}}return this._deferred.promise},e}();var go,mo=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))},bo=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},Eo=(new(function(){function e(){}return e.prototype.detect=function(){return mo(this,void 0,void 0,(function(){return bo(this,(function(e){return[2,new Eo({})]}))}))},e}()),function(){function e(e){this.attributes=e}return e.empty=function(){return e.EMPTY},e.default=function(){var t;return new e(((t={})[cr]="unknown_service",t[lr]=Kr[lr],t[ur]=Kr[ur],t[pr]=Kr[pr],t))},e.prototype.merge=function(t){return t&&Object.keys(t.attributes).length?new e(Object.assign({},this.attributes,t.attributes)):this},e.EMPTY=new e({}),e}()),To=function(){return To=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},To.apply(this,arguments)},So=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))},Oo=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},wo=function(){function e(){}return e.prototype.detect=function(e){return So(this,void 0,void 0,(function(){var t,n;return Oo(this,(function(r){return"undefined"!=typeof navigator?((n={})[ir]="browser",n[ar]="Web Browser",n[sr]=navigator.userAgent,t=n,[2,this._getResourceAttributes(t,e)]):[2,Eo.empty()]}))}))},e.prototype._getResourceAttributes=function(e,t){return""===e[sr]?(Kn.debug("BrowserDetector failed: Unable to find required browser resources. "),Eo.empty()):new Eo(To({},e))},e}(),Ro=(new wo,function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))}),Co=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},Ao=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Po=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s},Lo=function(){function e(){this._MAX_LENGTH=255,this._COMMA_SEPARATOR=",",this._LABEL_KEY_VALUE_SPLITTER="=",this._ERROR_MESSAGE_INVALID_CHARS="should be a ASCII string with a length greater than 0 and not exceed "+this._MAX_LENGTH+" characters.",this._ERROR_MESSAGE_INVALID_VALUE="should be a ASCII string with a length not exceed "+this._MAX_LENGTH+" characters."}return e.prototype.detect=function(e){return Ro(this,void 0,void 0,(function(){var e,t,n,r,o;return Co(this,(function(i){if(e={},t=Dr(),n=t.OTEL_RESOURCE_ATTRIBUTES,r=t.OTEL_SERVICE_NAME,n)try{o=this._parseResourceAttributes(n),Object.assign(e,o)}catch(e){Kn.debug("EnvDetector failed: "+e.message)}return r&&(e[cr]=r),[2,new Eo(e)]}))}))},e.prototype._parseResourceAttributes=function(e){var t,n;if(!e)return{};var r={},o=e.split(this._COMMA_SEPARATOR,-1);try{for(var i=Ao(o),s=i.next();!s.done;s=i.next()){var a=s.value.split(this._LABEL_KEY_VALUE_SPLITTER,-1);if(2===a.length){var c=Po(a,2),u=c[0],l=c[1];if(u=u.trim(),l=l.trim().split('^"|"$').join(""),!this._isValidAndNotEmpty(u))throw new Error("Attribute key "+this._ERROR_MESSAGE_INVALID_CHARS);if(!this._isValid(l))throw new Error("Attribute value "+this._ERROR_MESSAGE_INVALID_VALUE);r[u]=l}}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return r},e.prototype._isValid=function(e){return e.length<=this._MAX_LENGTH&&this._isPrintableString(e)},e.prototype._isPrintableString=function(e){for(var t=0;t<e.length;t++){var n=e.charAt(t);if(n<=" "||n>="~")return!1}return!0},e.prototype._isValidAndNotEmpty=function(e){return e.length>0&&this._isValid(e)},e}(),Mo=(new Lo,function(){return Mo=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Mo.apply(this,arguments)}),Io=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))},xo=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},No=function(){function e(){}return e.prototype.detect=function(e){return Io(this,void 0,void 0,(function(){var t,n;return xo(this,(function(r){return"object"!=typeof process?[2,Eo.empty()]:((n={})[er]=process.pid,n[tr]=process.title||"",n[rr]=process.argv[1]||"",n[or]=process.argv.join(" ")||"",n[sr]=process.versions.node,n[ir]="nodejs",n[ar]="Node.js",t=n,[2,this._getResourceAttributes(t,e)])}))}))},e.prototype._getResourceAttributes=function(e,t){return""===e[tr]||""===e[nr]||""===e[rr]||""===e[or]||""===e[sr]?(Kn.debug("ProcessDetector failed: Unable to find required process resources. "),Eo.empty()):new Eo(Mo({},e))},e}(),ko=(new No,"process.runtime.name"),Uo="service.name",Do="service.version",Bo="telemetry.sdk.name",jo="telemetry.sdk.language",Vo="telemetry.sdk.version";!function(e){e.AlwaysOff="always_off",e.AlwaysOn="always_on",e.ParentBasedAlwaysOff="parentbased_always_off",e.ParentBasedAlwaysOn="parentbased_always_on",e.ParentBasedTraceIdRatio="parentbased_traceidratio",e.TraceIdRatio="traceidratio"}(go||(go={}));var Fo="object"==typeof globalThis?globalThis:"object"==typeof self?self:"object"==typeof window?window:"object"==typeof e.g?e.g:{},Go=",",Xo=["OTEL_SDK_DISABLED"];function Ko(e){return Xo.indexOf(e)>-1}var qo=["OTEL_BSP_EXPORT_TIMEOUT","OTEL_BSP_MAX_EXPORT_BATCH_SIZE","OTEL_BSP_MAX_QUEUE_SIZE","OTEL_BSP_SCHEDULE_DELAY","OTEL_BLRP_EXPORT_TIMEOUT","OTEL_BLRP_MAX_EXPORT_BATCH_SIZE","OTEL_BLRP_MAX_QUEUE_SIZE","OTEL_BLRP_SCHEDULE_DELAY","OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_ATTRIBUTE_COUNT_LIMIT","OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT","OTEL_LOGRECORD_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_LOGRECORD_ATTRIBUTE_COUNT_LIMIT","OTEL_SPAN_EVENT_COUNT_LIMIT","OTEL_SPAN_LINK_COUNT_LIMIT","OTEL_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT","OTEL_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT","OTEL_EXPORTER_OTLP_TIMEOUT","OTEL_EXPORTER_OTLP_TRACES_TIMEOUT","OTEL_EXPORTER_OTLP_METRICS_TIMEOUT","OTEL_EXPORTER_OTLP_LOGS_TIMEOUT","OTEL_EXPORTER_JAEGER_AGENT_PORT"];function zo(e){return qo.indexOf(e)>-1}var Ho=["OTEL_NO_PATCH_MODULES","OTEL_PROPAGATORS"];function Wo(e){return Ho.indexOf(e)>-1}var Yo=1/0,Qo=128,Jo={OTEL_SDK_DISABLED:!1,CONTAINER_NAME:"",ECS_CONTAINER_METADATA_URI_V4:"",ECS_CONTAINER_METADATA_URI:"",HOSTNAME:"",KUBERNETES_SERVICE_HOST:"",NAMESPACE:"",OTEL_BSP_EXPORT_TIMEOUT:3e4,OTEL_BSP_MAX_EXPORT_BATCH_SIZE:512,OTEL_BSP_MAX_QUEUE_SIZE:2048,OTEL_BSP_SCHEDULE_DELAY:5e3,OTEL_BLRP_EXPORT_TIMEOUT:3e4,OTEL_BLRP_MAX_EXPORT_BATCH_SIZE:512,OTEL_BLRP_MAX_QUEUE_SIZE:2048,OTEL_BLRP_SCHEDULE_DELAY:5e3,OTEL_EXPORTER_JAEGER_AGENT_HOST:"",OTEL_EXPORTER_JAEGER_AGENT_PORT:6832,OTEL_EXPORTER_JAEGER_ENDPOINT:"",OTEL_EXPORTER_JAEGER_PASSWORD:"",OTEL_EXPORTER_JAEGER_USER:"",OTEL_EXPORTER_OTLP_ENDPOINT:"",OTEL_EXPORTER_OTLP_TRACES_ENDPOINT:"",OTEL_EXPORTER_OTLP_METRICS_ENDPOINT:"",OTEL_EXPORTER_OTLP_LOGS_ENDPOINT:"",OTEL_EXPORTER_OTLP_HEADERS:"",OTEL_EXPORTER_OTLP_TRACES_HEADERS:"",OTEL_EXPORTER_OTLP_METRICS_HEADERS:"",OTEL_EXPORTER_OTLP_LOGS_HEADERS:"",OTEL_EXPORTER_OTLP_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_TRACES_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_METRICS_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_LOGS_TIMEOUT:1e4,OTEL_EXPORTER_ZIPKIN_ENDPOINT:"http://localhost:9411/api/v2/spans",OTEL_LOG_LEVEL:Nt.INFO,OTEL_NO_PATCH_MODULES:[],OTEL_PROPAGATORS:["tracecontext","baggage"],OTEL_RESOURCE_ATTRIBUTES:"",OTEL_SERVICE_NAME:"",OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT:Yo,OTEL_ATTRIBUTE_COUNT_LIMIT:Qo,OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT:Yo,OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT:Qo,OTEL_LOGRECORD_ATTRIBUTE_VALUE_LENGTH_LIMIT:Yo,OTEL_LOGRECORD_ATTRIBUTE_COUNT_LIMIT:Qo,OTEL_SPAN_EVENT_COUNT_LIMIT:128,OTEL_SPAN_LINK_COUNT_LIMIT:128,OTEL_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT:128,OTEL_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT:128,OTEL_TRACES_EXPORTER:"",OTEL_TRACES_SAMPLER:go.ParentBasedAlwaysOn,OTEL_TRACES_SAMPLER_ARG:"",OTEL_LOGS_EXPORTER:"",OTEL_EXPORTER_OTLP_INSECURE:"",OTEL_EXPORTER_OTLP_TRACES_INSECURE:"",OTEL_EXPORTER_OTLP_METRICS_INSECURE:"",OTEL_EXPORTER_OTLP_LOGS_INSECURE:"",OTEL_EXPORTER_OTLP_CERTIFICATE:"",OTEL_EXPORTER_OTLP_TRACES_CERTIFICATE:"",OTEL_EXPORTER_OTLP_METRICS_CERTIFICATE:"",OTEL_EXPORTER_OTLP_LOGS_CERTIFICATE:"",OTEL_EXPORTER_OTLP_COMPRESSION:"",OTEL_EXPORTER_OTLP_TRACES_COMPRESSION:"",OTEL_EXPORTER_OTLP_METRICS_COMPRESSION:"",OTEL_EXPORTER_OTLP_LOGS_COMPRESSION:"",OTEL_EXPORTER_OTLP_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_TRACES_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_METRICS_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_LOGS_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_TRACES_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_METRICS_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_LOGS_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_TRACES_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_METRICS_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_LOGS_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_METRICS_TEMPORALITY_PREFERENCE:"cumulative"};function Zo(e,t,n){if(void 0!==n[e]){var r=String(n[e]);t[e]="true"===r.toLowerCase()}}function $o(e,t,n,r,o){if(void 0===r&&(r=-1/0),void 0===o&&(o=1/0),void 0!==n[e]){var i=Number(n[e]);isNaN(i)||(t[e]=i<r?r:i>o?o:i)}}function ei(e,t,n,r){void 0===r&&(r=Go);var o=n[e];"string"==typeof o&&(t[e]=o.split(r).map((function(e){return e.trim()})))}var ti={ALL:Nt.ALL,VERBOSE:Nt.VERBOSE,DEBUG:Nt.DEBUG,INFO:Nt.INFO,WARN:Nt.WARN,ERROR:Nt.ERROR,NONE:Nt.NONE};function ni(e,t,n){var r=n[e];if("string"==typeof r){var o=ti[r.toUpperCase()];null!=o&&(t[e]=o)}}function ri(e){var t={};for(var n in Jo){var r=n;if("OTEL_LOG_LEVEL"===r)ni(r,t,e);else if(Ko(r))Zo(r,t,e);else if(zo(r))$o(r,t,e);else if(Wo(r))ei(r,t,e);else{var o=e[r];null!=o&&(t[r]=String(o))}}return t}function oi(){var e=ri(Fo);return Object.assign({},Jo,e)}var ii,si=function(){function e(){var e=this;this._promise=new Promise((function(t,n){e._resolve=t,e._reject=n}))}return Object.defineProperty(e.prototype,"promise",{get:function(){return this._promise},enumerable:!1,configurable:!0}),e.prototype.resolve=function(e){this._resolve(e)},e.prototype.reject=function(e){this._reject(e)},e}(),ai=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s},ci=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},ui=function(){function e(e,t){this._callback=e,this._that=t,this._isCalled=!1,this._deferred=new si}return Object.defineProperty(e.prototype,"isCalled",{get:function(){return this._isCalled},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"promise",{get:function(){return this._deferred.promise},enumerable:!1,configurable:!0}),e.prototype.call=function(){for(var e,t=this,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];if(!this._isCalled){this._isCalled=!0;try{Promise.resolve((e=this._callback).call.apply(e,ci([this._that],ai(n),!1))).then((function(e){return t._deferred.resolve(e)}),(function(e){return t._deferred.reject(e)}))}catch(e){this._deferred.reject(e)}}return this._deferred.promise},e}(),li=qt("OpenTelemetry SDK Context Key SUPPRESS_TRACING");function pi(e){return!0===e.getValue(li)}!function(e){e[e.SUCCESS=0]="SUCCESS",e[e.FAILED=1]="FAILED"}(ii||(ii={}));var hi=function(e){Kn.error(function(e){return"string"==typeof e?e:JSON.stringify(function(e){for(var t={},n=e;null!==n;)Object.getOwnPropertyNames(n).forEach((function(e){if(!t[e]){var r=n[e];r&&(t[e]=String(r))}})),n=Object.getPrototypeOf(n);return t}(e))}(e))};function di(e){try{hi(e)}catch(e){}}var fi=function(){function e(e,t){this._exporter=e,this._finishedSpans=[],this._droppedSpansCount=0;var n=oi();this._maxExportBatchSize="number"==typeof(null==t?void 0:t.maxExportBatchSize)?t.maxExportBatchSize:n.OTEL_BSP_MAX_EXPORT_BATCH_SIZE,this._maxQueueSize="number"==typeof(null==t?void 0:t.maxQueueSize)?t.maxQueueSize:n.OTEL_BSP_MAX_QUEUE_SIZE,this._scheduledDelayMillis="number"==typeof(null==t?void 0:t.scheduledDelayMillis)?t.scheduledDelayMillis:n.OTEL_BSP_SCHEDULE_DELAY,this._exportTimeoutMillis="number"==typeof(null==t?void 0:t.exportTimeoutMillis)?t.exportTimeoutMillis:n.OTEL_BSP_EXPORT_TIMEOUT,this._shutdownOnce=new ui(this._shutdown,this),this._maxExportBatchSize>this._maxQueueSize&&(Kn.warn("BatchSpanProcessor: maxExportBatchSize must be smaller or equal to maxQueueSize, setting maxExportBatchSize to match maxQueueSize"),this._maxExportBatchSize=this._maxQueueSize)}return e.prototype.forceFlush=function(){return this._shutdownOnce.isCalled?this._shutdownOnce.promise:this._flushAll()},e.prototype.onStart=function(e,t){},e.prototype.onEnd=function(e){this._shutdownOnce.isCalled||0!=(e.spanContext().traceFlags&zt.SAMPLED)&&this._addToBuffer(e)},e.prototype.shutdown=function(){return this._shutdownOnce.call()},e.prototype._shutdown=function(){var e=this;return Promise.resolve().then((function(){return e.onShutdown()})).then((function(){return e._flushAll()})).then((function(){return e._exporter.shutdown()}))},e.prototype._addToBuffer=function(e){if(this._finishedSpans.length>=this._maxQueueSize)return 0===this._droppedSpansCount&&Kn.debug("maxQueueSize reached, dropping spans"),void this._droppedSpansCount++;this._droppedSpansCount>0&&(Kn.warn("Dropped "+this._droppedSpansCount+" spans because maxQueueSize reached"),this._droppedSpansCount=0),this._finishedSpans.push(e),this._maybeStartTimer()},e.prototype._flushAll=function(){var e=this;return new Promise((function(t,n){for(var r=[],o=0,i=Math.ceil(e._finishedSpans.length/e._maxExportBatchSize);o<i;o++)r.push(e._flushOneBatch());Promise.all(r).then((function(){t()})).catch(n)}))},e.prototype._flushOneBatch=function(){var e=this;return this._clearTimer(),0===this._finishedSpans.length?Promise.resolve():new Promise((function(t,n){var r=setTimeout((function(){n(new Error("Timeout"))}),e._exportTimeoutMillis);Fn.with(function(e){return e.setValue(li,!0)}(Fn.active()),(function(){var o=e._finishedSpans.splice(0,e._maxExportBatchSize),i=function(){return e._exporter.export(o,(function(e){var o;clearTimeout(r),e.code===ii.SUCCESS?t():n(null!==(o=e.error)&&void 0!==o?o:new Error("BatchSpanProcessor: span export failed"))}))},s=o.map((function(e){return e.resource})).filter((function(e){return e.asyncAttributesPending}));0===s.length?i():Promise.all(s.map((function(e){var t;return null===(t=e.waitForAsyncAttributes)||void 0===t?void 0:t.call(e)}))).then(i,(function(e){di(e),n(e)}))}))}))},e.prototype._maybeStartTimer=function(){var e=this;void 0===this._timer&&(this._timer=setTimeout((function(){e._flushOneBatch().then((function(){e._finishedSpans.length>0&&(e._clearTimer(),e._maybeStartTimer())})).catch((function(e){di(e)}))}),this._scheduledDelayMillis),this._timer)},e.prototype._clearTimer=function(){void 0!==this._timer&&(clearTimeout(this._timer),this._timer=void 0)},e}(),vi=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),_i=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.onInit(n),r}return vi(t,e),t.prototype.onInit=function(e){var t=this;!0!==(null==e?void 0:e.disableAutoFlushOnDocumentHide)&&"undefined"!=typeof document&&(this._visibilityChangeListener=function(){"hidden"===document.visibilityState&&t.forceFlush()},this._pageHideListener=function(){t.forceFlush()},document.addEventListener("visibilitychange",this._visibilityChangeListener),document.addEventListener("pagehide",this._pageHideListener))},t.prototype.onShutdown=function(){"undefined"!=typeof document&&(this._visibilityChangeListener&&document.removeEventListener("visibilitychange",this._visibilityChangeListener),this._pageHideListener&&document.removeEventListener("pagehide",this._pageHideListener))},t}(fi),yi="[object Object]",gi="[object Null]",mi="[object Undefined]",bi=Function.prototype.toString,Ei=bi.call(Object),Ti=function(e,t){return function(n){return e(t(n))}}(Object.getPrototypeOf,Object),Si=Object.prototype,Oi=Si.hasOwnProperty,wi=Symbol?Symbol.toStringTag:void 0,Ri=Si.toString;function Ci(e){if(!function(e){return null!=e&&"object"==typeof e}(e)||function(e){if(null==e)return void 0===e?mi:gi;return wi&&wi in Object(e)?function(e){var t=Oi.call(e,wi),n=e[wi],r=!1;try{e[wi]=void 0,r=!0}catch(e){}var o=Ri.call(e);r&&(t?e[wi]=n:delete e[wi]);return o}(e):function(e){return Ri.call(e)}(e)}(e)!==yi)return!1;var t=Ti(e);if(null===t)return!0;var n=Oi.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&bi.call(n)===Ei}var Ai=20;function Pi(e){return Ii(e)?e.slice():e}function Li(e,t,n,r){var o;if(void 0===n&&(n=0),!(n>Ai)){if(n++,ki(e)||ki(t)||xi(t))o=Pi(t);else if(Ii(e)){if(o=e.slice(),Ii(t))for(var i=0,s=t.length;i<s;i++)o.push(Pi(t[i]));else if(Ni(t))for(i=0,s=(a=Object.keys(t)).length;i<s;i++){o[c=a[i]]=Pi(t[c])}}else if(Ni(e))if(Ni(t)){if(!function(e,t){if(!Ci(e)||!Ci(t))return!1;return!0}(e,t))return t;o=Object.assign({},e);var a;for(i=0,s=(a=Object.keys(t)).length;i<s;i++){var c,u=t[c=a[i]];if(ki(u))void 0===u?delete o[c]:o[c]=u;else{var l=o[c],p=u;if(Mi(e,c,r)||Mi(t,c,r))delete o[c];else{if(Ni(l)&&Ni(p)){var h=r.get(l)||[],d=r.get(p)||[];h.push({obj:e,key:c}),d.push({obj:t,key:c}),r.set(l,h),r.set(p,d)}o[c]=Li(o[c],u,n,r)}}}}else o=t;return o}}function Mi(e,t,n){for(var r=n.get(e[t])||[],o=0,i=r.length;o<i;o++){var s=r[o];if(s.key===t&&s.obj===e)return!0}return!1}function Ii(e){return Array.isArray(e)}function xi(e){return"function"==typeof e}function Ni(e){return!ki(e)&&!Ii(e)&&!xi(e)&&"object"==typeof e}function ki(e){return"string"==typeof e||"number"==typeof e||"boolean"==typeof e||void 0===e||e instanceof Date||e instanceof RegExp||null===e}var Ui=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Di=function(){function e(e){var t;void 0===e&&(e={}),this._propagators=null!==(t=e.propagators)&&void 0!==t?t:[],this._fields=Array.from(new Set(this._propagators.map((function(e){return"function"==typeof e.fields?e.fields():[]})).reduce((function(e,t){return e.concat(t)}),[])))}return e.prototype.inject=function(e,t,n){var r,o;try{for(var i=Ui(this._propagators),s=i.next();!s.done;s=i.next()){var a=s.value;try{a.inject(e,t,n)}catch(e){Kn.warn("Failed to inject with "+a.constructor.name+". Err: "+e.message)}}}catch(e){r={error:e}}finally{try{s&&!s.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}},e.prototype.extract=function(e,t,n){return this._propagators.reduce((function(e,r){try{return r.extract(e,t,n)}catch(e){Kn.warn("Failed to inject with "+r.constructor.name+". Err: "+e.message)}return e}),e)},e.prototype.fields=function(){return this._fields.slice()},e}(),Bi="[_0-9a-z-*/]",ji=new RegExp("^(?:"+("[a-z]"+Bi+"{0,255}")+"|"+("[a-z0-9]"+Bi+"{0,240}@[a-z]"+Bi+"{0,13}")+")$"),Vi=/^[ -~]{0,255}[!-~]$/,Fi=/,|=/;var Gi=function(){function e(e){this._internalState=new Map,e&&this._parse(e)}return e.prototype.set=function(e,t){var n=this._clone();return n._internalState.has(e)&&n._internalState.delete(e),n._internalState.set(e,t),n},e.prototype.unset=function(e){var t=this._clone();return t._internalState.delete(e),t},e.prototype.get=function(e){return this._internalState.get(e)},e.prototype.serialize=function(){var e=this;return this._keys().reduce((function(t,n){return t.push(n+"="+e.get(n)),t}),[]).join(",")},e.prototype._parse=function(e){e.length>512||(this._internalState=e.split(",").reverse().reduce((function(e,t){var n=t.trim(),r=n.indexOf("=");if(-1!==r){var o=n.slice(0,r),i=n.slice(r+1,t.length);(function(e){return ji.test(e)})(o)&&function(e){return Vi.test(e)&&!Fi.test(e)}(i)&&e.set(o,i)}return e}),new Map),this._internalState.size>32&&(this._internalState=new Map(Array.from(this._internalState.entries()).reverse().slice(0,32))))},e.prototype._keys=function(){return Array.from(this._internalState.keys()).reverse()},e.prototype._clone=function(){var t=new e;return t._internalState=new Map(this._internalState),t},e}(),Xi="traceparent",Ki="tracestate",qi=new RegExp("^\\s?((?!ff)[\\da-f]{2})-((?![0]{32})[\\da-f]{32})-((?![0]{16})[\\da-f]{16})-([\\da-f]{2})(-.*)?\\s?$");var zi=function(){function e(){}return e.prototype.inject=function(e,t,n){var r=Gn.getSpanContext(e);if(r&&!pi(e)&&_n(r)){var o="00-"+r.traceId+"-"+r.spanId+"-0"+Number(r.traceFlags||zt.NONE).toString(16);n.set(t,Xi,o),r.traceState&&n.set(t,Ki,r.traceState.serialize())}},e.prototype.extract=function(e,t,n){var r=n.get(t,Xi);if(!r)return e;var o=Array.isArray(r)?r[0]:r;if("string"!=typeof o)return e;var i=function(e){var t=qi.exec(e);return t?"00"===t[1]&&t[5]?null:{traceId:t[2],spanId:t[3],traceFlags:parseInt(t[4],16)}:null}(o);if(!i)return e;i.isRemote=!0;var s=n.get(t,Ki);if(s){var a=Array.isArray(s)?s.join(","):s;i.traceState=new Gi("string"==typeof a?a:void 0)}return Gn.setSpanContext(e,i)},e.prototype.fields=function(){return[Xi,Ki]},e}(),Hi="=",Wi=";",Yi="baggage",Qi=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s};function Ji(e){var t=e.split(Wi);if(!(t.length<=0)){var n=t.shift();if(n){var r=n.split(Hi);if(2===r.length){var o,i=decodeURIComponent(r[0].trim()),s=decodeURIComponent(r[1].trim());return t.length>0&&(o=Gt(t.join(Wi))),{key:i,value:s,metadata:o}}}}}var Zi,$i=function(){function e(){}return e.prototype.inject=function(e,t,n){var r=Xn.getBaggage(e);if(r&&!pi(e)){var o=function(e){return e.getAllEntries().map((function(e){var t=Qi(e,2),n=t[0],r=t[1],o=encodeURIComponent(n)+"="+encodeURIComponent(r.value);return void 0!==r.metadata&&(o+=Wi+r.metadata.toString()),o}))}(r).filter((function(e){return e.length<=4096})).slice(0,180),i=function(e){return e.reduce((function(e,t){var n=e+(""!==e?",":"")+t;return n.length>8192?e:n}),"")}(o);i.length>0&&n.set(t,Yi,i)}},e.prototype.extract=function(e,t,n){var r=n.get(t,Yi),o=Array.isArray(r)?r.join(","):r;if(!o)return e;var i={};return 0===o.length?e:(o.split(",").forEach((function(e){var t=Ji(e);if(t){var n={value:t.value};t.metadata&&(n.metadata=t.metadata),i[t.key]=n}})),0===Object.entries(i).length?e:Xn.setBaggage(e,Xn.createBaggage(i)))},e.prototype.fields=function(){return[Yi]},e}(),es=((Zi={})[Bo]="opentelemetry",Zi[ko]="browser",Zi[jo]="webjs",Zi[Vo]="1.15.1",Zi);var ts=function(){return ts=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},ts.apply(this,arguments)},ns=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))},rs=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},os=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s},is=function(){function e(e,t){var n,r=this;this._attributes=e,this.asyncAttributesPending=null!=t,this._syncAttributes=null!==(n=this._attributes)&&void 0!==n?n:{},this._asyncAttributesPromise=null==t?void 0:t.then((function(e){return r._attributes=Object.assign({},r._attributes,e),r.asyncAttributesPending=!1,e}),(function(e){return Kn.debug("a resource's async attributes promise rejected: %s",e),r.asyncAttributesPending=!1,{}}))}return e.empty=function(){return e.EMPTY},e.default=function(){var t;return new e(((t={})[Uo]="unknown_service",t[jo]=es[jo],t[Bo]=es[Bo],t[Vo]=es[Vo],t))},Object.defineProperty(e.prototype,"attributes",{get:function(){var e;return this.asyncAttributesPending&&Kn.error("Accessing resource attributes before async attributes settled"),null!==(e=this._attributes)&&void 0!==e?e:{}},enumerable:!1,configurable:!0}),e.prototype.waitForAsyncAttributes=function(){return ns(this,void 0,void 0,(function(){return rs(this,(function(e){switch(e.label){case 0:return this.asyncAttributesPending?[4,this._asyncAttributesPromise]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},e.prototype.merge=function(t){var n,r=this;if(!t)return this;var o=ts(ts({},this._syncAttributes),null!==(n=t._syncAttributes)&&void 0!==n?n:t.attributes);if(!this._asyncAttributesPromise&&!t._asyncAttributesPromise)return new e(o);var i=Promise.all([this._asyncAttributesPromise,t._asyncAttributesPromise]).then((function(e){var n,o=os(e,2),i=o[0],s=o[1];return ts(ts(ts(ts({},r._syncAttributes),i),null!==(n=t._syncAttributes)&&void 0!==n?n:t.attributes),s)}));return new e(o,i)},e.EMPTY=new e({}),e}(),ss=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},as=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s};function cs(e){var t,n,r={};if("object"!=typeof e||null==e)return r;try{for(var o=ss(Object.entries(e)),i=o.next();!i.done;i=o.next()){var s=as(i.value,2),a=s[0],c=s[1];us(a)?ls(c)?Array.isArray(c)?r[a]=c.slice():r[a]=c:Kn.warn("Invalid attribute value set for key: "+a):Kn.warn("Invalid attribute key: "+a)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return r}function us(e){return"string"==typeof e&&e.length>0}function ls(e){return null==e||(Array.isArray(e)?function(e){var t,n,r;try{for(var o=ss(e),i=o.next();!i.done;i=o.next()){var s=i.value;if(null!=s){if(!r){if(ps(s)){r=typeof s;continue}return!1}if(typeof s!==r)return!1}}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return!0}(e):ps(e))}function ps(e){switch(typeof e){case"number":case"boolean":case"string":return!0}return!1}var hs=performance,ds=Math.pow(10,6),fs=Math.pow(10,9);function vs(e){var t=e/1e3;return[Math.trunc(t),Math.round(e%1e3*ds)]}function _s(){var e=hs.timeOrigin;if("number"!=typeof e){var t=hs;e=t.timing&&t.timing.fetchStart}return e}function ys(e){return bs(vs(_s()),vs("number"==typeof e?e:hs.now()))}function gs(e){return Array.isArray(e)&&2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]}function ms(e){return gs(e)||"number"==typeof e||e instanceof Date}function bs(e,t){var n=[e[0]+t[0],e[1]+t[1]];return n[1]>=fs&&(n[1]-=fs,n[0]+=1),n}var Es,Ts="exception.type",Ss="exception.message",Os="exception.stacktrace",ws=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Rs=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s},Cs=function(){function e(e,t,n,r,o,i,s,a,c){void 0===s&&(s=[]),this.attributes={},this.links=[],this.events=[],this._droppedAttributesCount=0,this._droppedEventsCount=0,this._droppedLinksCount=0,this.status={code:Tn.UNSET},this.endTime=[0,0],this._ended=!1,this._duration=[-1,-1],this.name=n,this._spanContext=r,this.parentSpanId=i,this.kind=o,this.links=s;var u=Date.now();this._performanceStartTime=hs.now(),this._performanceOffset=u-(this._performanceStartTime+_s()),this._startTimeProvided=null!=a,this.startTime=this._getTime(null!=a?a:u),this.resource=e.resource,this.instrumentationLibrary=e.instrumentationLibrary,this._spanLimits=e.getSpanLimits(),this._spanProcessor=e.getActiveSpanProcessor(),this._spanProcessor.onStart(this,t),this._attributeValueLengthLimit=this._spanLimits.attributeValueLengthLimit||0}return e.prototype.spanContext=function(){return this._spanContext},e.prototype.setAttribute=function(e,t){return null==t||this._isSpanEnded()?this:0===e.length?(Kn.warn("Invalid attribute key: "+e),this):ls(t)?Object.keys(this.attributes).length>=this._spanLimits.attributeCountLimit&&!Object.prototype.hasOwnProperty.call(this.attributes,e)?(this._droppedAttributesCount++,this):(this.attributes[e]=this._truncateToSize(t),this):(Kn.warn("Invalid attribute value set for key: "+e),this)},e.prototype.setAttributes=function(e){var t,n;try{for(var r=ws(Object.entries(e)),o=r.next();!o.done;o=r.next()){var i=Rs(o.value,2),s=i[0],a=i[1];this.setAttribute(s,a)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}return this},e.prototype.addEvent=function(e,t,n){if(this._isSpanEnded())return this;if(0===this._spanLimits.eventCountLimit)return Kn.warn("No events allowed."),this._droppedEventsCount++,this;this.events.length>=this._spanLimits.eventCountLimit&&(Kn.warn("Dropping extra events."),this.events.shift(),this._droppedEventsCount++),ms(t)&&(ms(n)||(n=t),t=void 0);var r=cs(t);return this.events.push({name:e,attributes:r,time:this._getTime(n),droppedAttributesCount:0}),this},e.prototype.setStatus=function(e){return this._isSpanEnded()||(this.status=e),this},e.prototype.updateName=function(e){return this._isSpanEnded()||(this.name=e),this},e.prototype.end=function(e){this._isSpanEnded()?Kn.error(this.name+" "+this._spanContext.traceId+"-"+this._spanContext.spanId+" - You can only call end() on a span once."):(this._ended=!0,this.endTime=this._getTime(e),this._duration=function(e,t){var n=t[0]-e[0],r=t[1]-e[1];return r<0&&(n-=1,r+=fs),[n,r]}(this.startTime,this.endTime),this._duration[0]<0&&(Kn.warn("Inconsistent start and end time, startTime > endTime. Setting span duration to 0ms.",this.startTime,this.endTime),this.endTime=this.startTime.slice(),this._duration=[0,0]),this._spanProcessor.onEnd(this))},e.prototype._getTime=function(e){if("number"==typeof e&&e<hs.now())return ys(e+this._performanceOffset);if("number"==typeof e)return vs(e);if(e instanceof Date)return vs(e.getTime());if(gs(e))return e;if(this._startTimeProvided)return vs(Date.now());var t=hs.now()-this._performanceStartTime;return bs(this.startTime,vs(t))},e.prototype.isRecording=function(){return!1===this._ended},e.prototype.recordException=function(e,t){var n={};"string"==typeof e?n[Ss]=e:e&&(e.code?n[Ts]=e.code.toString():e.name&&(n[Ts]=e.name),e.message&&(n[Ss]=e.message),e.stack&&(n[Os]=e.stack)),n[Ts]||n[Ss]?this.addEvent("exception",n,t):Kn.warn("Failed to record an exception "+e)},Object.defineProperty(e.prototype,"duration",{get:function(){return this._duration},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ended",{get:function(){return this._ended},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"droppedAttributesCount",{get:function(){return this._droppedAttributesCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"droppedEventsCount",{get:function(){return this._droppedEventsCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"droppedLinksCount",{get:function(){return this._droppedLinksCount},enumerable:!1,configurable:!0}),e.prototype._isSpanEnded=function(){return this._ended&&Kn.warn("Can not execute the operation on ended Span {traceId: "+this._spanContext.traceId+", spanId: "+this._spanContext.spanId+"}"),this._ended},e.prototype._truncateToLimitUtil=function(e,t){return e.length<=t?e:e.substr(0,t)},e.prototype._truncateToSize=function(e){var t=this,n=this._attributeValueLengthLimit;return n<=0?(Kn.warn("Attribute value limit must be positive, got "+n),e):"string"==typeof e?this._truncateToLimitUtil(e,n):Array.isArray(e)?e.map((function(e){return"string"==typeof e?t._truncateToLimitUtil(e,n):e})):e},e}();!function(e){e[e.NOT_RECORD=0]="NOT_RECORD",e[e.RECORD=1]="RECORD",e[e.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"}(Es||(Es={}));var As=function(){function e(){}return e.prototype.shouldSample=function(){return{decision:Es.NOT_RECORD}},e.prototype.toString=function(){return"AlwaysOffSampler"},e}(),Ps=function(){function e(){}return e.prototype.shouldSample=function(){return{decision:Es.RECORD_AND_SAMPLED}},e.prototype.toString=function(){return"AlwaysOnSampler"},e}(),Ls=function(){function e(e){var t,n,r,o;this._root=e.root,this._root||(di(new Error("ParentBasedSampler must have a root sampler configured")),this._root=new Ps),this._remoteParentSampled=null!==(t=e.remoteParentSampled)&&void 0!==t?t:new Ps,this._remoteParentNotSampled=null!==(n=e.remoteParentNotSampled)&&void 0!==n?n:new As,this._localParentSampled=null!==(r=e.localParentSampled)&&void 0!==r?r:new Ps,this._localParentNotSampled=null!==(o=e.localParentNotSampled)&&void 0!==o?o:new As}return e.prototype.shouldSample=function(e,t,n,r,o,i){var s=Gn.getSpanContext(e);return s&&_n(s)?s.isRemote?s.traceFlags&zt.SAMPLED?this._remoteParentSampled.shouldSample(e,t,n,r,o,i):this._remoteParentNotSampled.shouldSample(e,t,n,r,o,i):s.traceFlags&zt.SAMPLED?this._localParentSampled.shouldSample(e,t,n,r,o,i):this._localParentNotSampled.shouldSample(e,t,n,r,o,i):this._root.shouldSample(e,t,n,r,o,i)},e.prototype.toString=function(){return"ParentBased{root="+this._root.toString()+", remoteParentSampled="+this._remoteParentSampled.toString()+", remoteParentNotSampled="+this._remoteParentNotSampled.toString()+", localParentSampled="+this._localParentSampled.toString()+", localParentNotSampled="+this._localParentNotSampled.toString()+"}"},e}(),Ms=function(){function e(e){void 0===e&&(e=0),this._ratio=e,this._ratio=this._normalize(e),this._upperBound=Math.floor(4294967295*this._ratio)}return e.prototype.shouldSample=function(e,t){return{decision:vn(t)&&this._accumulate(t)<this._upperBound?Es.RECORD_AND_SAMPLED:Es.NOT_RECORD}},e.prototype.toString=function(){return"TraceIdRatioBased{"+this._ratio+"}"},e.prototype._normalize=function(e){return"number"!=typeof e||isNaN(e)?0:e>=1?1:e<=0?0:e},e.prototype._accumulate=function(e){for(var t=0,n=0;n<e.length/8;n++){var r=8*n;t=(t^parseInt(e.slice(r,r+8),16))>>>0}return t},e}(),Is=oi(),xs=go.AlwaysOn,Ns=1;function ks(){return{sampler:Us(Is),forceFlushTimeoutMillis:3e4,generalLimits:{attributeValueLengthLimit:oi().OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT,attributeCountLimit:oi().OTEL_ATTRIBUTE_COUNT_LIMIT},spanLimits:{attributeValueLengthLimit:oi().OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT,attributeCountLimit:oi().OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT,linkCountLimit:oi().OTEL_SPAN_LINK_COUNT_LIMIT,eventCountLimit:oi().OTEL_SPAN_EVENT_COUNT_LIMIT,attributePerEventCountLimit:oi().OTEL_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT,attributePerLinkCountLimit:oi().OTEL_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT}}}function Us(e){switch(void 0===e&&(e=oi()),e.OTEL_TRACES_SAMPLER){case go.AlwaysOn:return new Ps;case go.AlwaysOff:return new As;case go.ParentBasedAlwaysOn:return new Ls({root:new Ps});case go.ParentBasedAlwaysOff:return new Ls({root:new As});case go.TraceIdRatio:return new Ms(Ds(e));case go.ParentBasedTraceIdRatio:return new Ls({root:new Ms(Ds(e))});default:return Kn.error('OTEL_TRACES_SAMPLER value "'+e.OTEL_TRACES_SAMPLER+" invalid, defaulting to "+xs+'".'),new Ps}}function Ds(e){if(void 0===e.OTEL_TRACES_SAMPLER_ARG||""===e.OTEL_TRACES_SAMPLER_ARG)return Kn.error("OTEL_TRACES_SAMPLER_ARG is blank, defaulting to "+Ns+"."),Ns;var t=Number(e.OTEL_TRACES_SAMPLER_ARG);return isNaN(t)?(Kn.error("OTEL_TRACES_SAMPLER_ARG="+e.OTEL_TRACES_SAMPLER_ARG+" was given, but it is invalid, defaulting to "+Ns+"."),Ns):t<0||t>1?(Kn.error("OTEL_TRACES_SAMPLER_ARG="+e.OTEL_TRACES_SAMPLER_ARG+" was given, but it is out of range ([0..1]), defaulting to "+Ns+"."),Ns):t}function Bs(e){var t,n,r,o,i,s,a,c,u,l,p,h,d=Object.assign({},e.spanLimits),f="undefined"!=typeof process&&process?ri("MISSING_ENV_VAR"):ri(Fo);return d.attributeCountLimit=null!==(s=null!==(i=null!==(o=null!==(n=null===(t=e.spanLimits)||void 0===t?void 0:t.attributeCountLimit)&&void 0!==n?n:null===(r=e.generalLimits)||void 0===r?void 0:r.attributeCountLimit)&&void 0!==o?o:f.OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT)&&void 0!==i?i:f.OTEL_ATTRIBUTE_COUNT_LIMIT)&&void 0!==s?s:Qo,d.attributeValueLengthLimit=null!==(h=null!==(p=null!==(l=null!==(c=null===(a=e.spanLimits)||void 0===a?void 0:a.attributeValueLengthLimit)&&void 0!==c?c:null===(u=e.generalLimits)||void 0===u?void 0:u.attributeValueLengthLimit)&&void 0!==l?l:f.OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT)&&void 0!==p?p:f.OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT)&&void 0!==h?h:Yo,Object.assign({},e,{spanLimits:d})}var js=function(){this.generateTraceId=Fs(16),this.generateSpanId=Fs(8)},Vs=Array(32);function Fs(e){return function(){for(var t=0;t<2*e;t++)Vs[t]=Math.floor(16*Math.random())+48,Vs[t]>=58&&(Vs[t]+=39);return String.fromCharCode.apply(null,Vs.slice(0,2*e))}}var Gs,Xs=function(){function e(e,t,n){this._tracerProvider=n;var r,o,i,s,a=(r=t,o={sampler:Us()},i=ks(),(s=Object.assign({},i,o,r)).generalLimits=Object.assign({},i.generalLimits,r.generalLimits||{}),s.spanLimits=Object.assign({},i.spanLimits,r.spanLimits||{}),s);this._sampler=a.sampler,this._generalLimits=a.generalLimits,this._spanLimits=a.spanLimits,this._idGenerator=t.idGenerator||new js,this.resource=n.resource,this.instrumentationLibrary=e}return e.prototype.startSpan=function(e,t,n){var r,o,i;void 0===t&&(t={}),void 0===n&&(n=Fn.active()),t.root&&(n=Gn.deleteSpan(n));var s=Gn.getSpan(n);if(pi(n))return Kn.debug("Instrumentation suppressed, returning Noop Span"),Gn.wrapSpanContext(rn);var a,c,u,l=null==s?void 0:s.spanContext(),p=this._idGenerator.generateSpanId();l&&Gn.isSpanContextValid(l)?(a=l.traceId,c=l.traceState,u=l.spanId):a=this._idGenerator.generateTraceId();var h=null!==(r=t.kind)&&void 0!==r?r:En.INTERNAL,d=(null!==(o=t.links)&&void 0!==o?o:[]).map((function(e){return{context:e.context,attributes:cs(e.attributes)}})),f=cs(t.attributes),v=this._sampler.shouldSample(n,a,e,h,f,d);c=null!==(i=v.traceState)&&void 0!==i?i:c;var _={traceId:a,spanId:p,traceFlags:v.decision===bn.RECORD_AND_SAMPLED?zt.SAMPLED:zt.NONE,traceState:c};if(v.decision===bn.NOT_RECORD)return Kn.debug("Recording is off, propagating context in a non-recording span"),Gn.wrapSpanContext(_);var y=new Cs(this,n,e,_,h,u,d,t.startTime),g=cs(Object.assign(f,v.attributes));return y.setAttributes(g),y},e.prototype.startActiveSpan=function(e,t,n,r){var o,i,s;if(!(arguments.length<2)){2===arguments.length?s=t:3===arguments.length?(o=t,s=n):(o=t,i=n,s=r);var a=null!=i?i:Fn.active(),c=this.startSpan(e,o,a),u=Gn.setSpan(a,c);return Fn.with(u,s,void 0,c)}},e.prototype.getGeneralLimits=function(){return this._generalLimits},e.prototype.getSpanLimits=function(){return this._spanLimits},e.prototype.getActiveSpanProcessor=function(){return this._tracerProvider.getActiveSpanProcessor()},e}(),Ks=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},qs=function(){function e(e){this._spanProcessors=e}return e.prototype.forceFlush=function(){var e,t,n=[];try{for(var r=Ks(this._spanProcessors),o=r.next();!o.done;o=r.next()){var i=o.value;n.push(i.forceFlush())}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return new Promise((function(e){Promise.all(n).then((function(){e()})).catch((function(t){di(t||new Error("MultiSpanProcessor: forceFlush failed")),e()}))}))},e.prototype.onStart=function(e,t){var n,r;try{for(var o=Ks(this._spanProcessors),i=o.next();!i.done;i=o.next()){i.value.onStart(e,t)}}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}},e.prototype.onEnd=function(e){var t,n;try{for(var r=Ks(this._spanProcessors),o=r.next();!o.done;o=r.next()){o.value.onEnd(e)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}},e.prototype.shutdown=function(){var e,t,n=[];try{for(var r=Ks(this._spanProcessors),o=r.next();!o.done;o=r.next()){var i=o.value;n.push(i.shutdown())}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return new Promise((function(e,t){Promise.all(n).then((function(){e()}),t)}))},e}(),zs=function(){function e(){}return e.prototype.onStart=function(e,t){},e.prototype.onEnd=function(e){},e.prototype.shutdown=function(){return Promise.resolve()},e.prototype.forceFlush=function(){return Promise.resolve()},e}();!function(e){e[e.resolved=0]="resolved",e[e.timeout=1]="timeout",e[e.error=2]="error",e[e.unresolved=3]="unresolved"}(Gs||(Gs={}));var Hs=function(){function e(e){var t;void 0===e&&(e={}),this._registeredSpanProcessors=[],this._tracers=new Map;var n=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=e.shift(),r=new WeakMap;e.length>0;)n=Li(n,e.shift(),0,r);return n}({},ks(),Bs(e));this.resource=null!==(t=n.resource)&&void 0!==t?t:is.empty(),this.resource=is.default().merge(this.resource),this._config=Object.assign({},n,{resource:this.resource});var r=this._buildExporterFromEnv();if(void 0!==r){var o=new _i(r);this.activeSpanProcessor=o}else this.activeSpanProcessor=new zs}return e.prototype.getTracer=function(e,t,n){var r=e+"@"+(t||"")+":"+((null==n?void 0:n.schemaUrl)||"");return this._tracers.has(r)||this._tracers.set(r,new Xs({name:e,version:t,schemaUrl:null==n?void 0:n.schemaUrl},this._config,this)),this._tracers.get(r)},e.prototype.addSpanProcessor=function(e){0===this._registeredSpanProcessors.length&&this.activeSpanProcessor.shutdown().catch((function(e){return Kn.error("Error while trying to shutdown current span processor",e)})),this._registeredSpanProcessors.push(e),this.activeSpanProcessor=new qs(this._registeredSpanProcessors)},e.prototype.getActiveSpanProcessor=function(){return this.activeSpanProcessor},e.prototype.register=function(e){void 0===e&&(e={}),Gn.setGlobalTracerProvider(this),void 0===e.propagator&&(e.propagator=this._buildPropagatorFromEnv()),e.contextManager&&Fn.setGlobalContextManager(e.contextManager),e.propagator&&Xn.setGlobalPropagator(e.propagator)},e.prototype.forceFlush=function(){var e=this._config.forceFlushTimeoutMillis,t=this._registeredSpanProcessors.map((function(t){return new Promise((function(n){var r,o=setTimeout((function(){n(new Error("Span processor did not completed within timeout period of "+e+" ms")),r=Gs.timeout}),e);t.forceFlush().then((function(){clearTimeout(o),r!==Gs.timeout&&(r=Gs.resolved,n(r))})).catch((function(e){clearTimeout(o),r=Gs.error,n(e)}))}))}));return new Promise((function(e,n){Promise.all(t).then((function(t){var r=t.filter((function(e){return e!==Gs.resolved}));r.length>0?n(r):e()})).catch((function(e){return n([e])}))}))},e.prototype.shutdown=function(){return this.activeSpanProcessor.shutdown()},e.prototype._getPropagator=function(e){var t;return null===(t=this.constructor._registeredPropagators.get(e))||void 0===t?void 0:t()},e.prototype._getSpanExporter=function(e){var t;return null===(t=this.constructor._registeredExporters.get(e))||void 0===t?void 0:t()},e.prototype._buildPropagatorFromEnv=function(){var e=this,t=Array.from(new Set(oi().OTEL_PROPAGATORS)),n=t.map((function(t){var n=e._getPropagator(t);return n||Kn.warn('Propagator "'+t+'" requested through environment variable is unavailable.'),n})).reduce((function(e,t){return t&&e.push(t),e}),[]);return 0===n.length?void 0:1===t.length?n[0]:new Di({propagators:n})},e.prototype._buildExporterFromEnv=function(){var e=oi().OTEL_TRACES_EXPORTER;if("none"!==e&&""!==e){var t=this._getSpanExporter(e);return t||Kn.error('Exporter "'+e+'" requested through environment variable is unavailable.'),t}},e._registeredPropagators=new Map([["tracecontext",function(){return new zi}],["baggage",function(){return new $i}]]),e._registeredExporters=new Map,e}(),Ws=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s},Ys=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},Qs=function(){function e(){this._enabled=!1,this._currentContext=Wt}return e.prototype._bindFunction=function(e,t){void 0===e&&(e=Wt);var n=this,r=function(){for(var r=this,o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];return n.with(e,(function(){return t.apply(r,o)}))};return Object.defineProperty(r,"length",{enumerable:!1,configurable:!0,writable:!1,value:t.length}),r},e.prototype.active=function(){return this._currentContext},e.prototype.bind=function(e,t){return void 0===e&&(e=this.active()),"function"==typeof t?this._bindFunction(e,t):t},e.prototype.disable=function(){return this._currentContext=Wt,this._enabled=!1,this},e.prototype.enable=function(){return this._enabled||(this._enabled=!0,this._currentContext=Wt),this},e.prototype.with=function(e,t,n){for(var r=[],o=3;o<arguments.length;o++)r[o-3]=arguments[o];var i=this._currentContext;this._currentContext=e||Wt;try{return t.call.apply(t,Ys([n],Ws(r),!1))}finally{this._currentContext=i}},e}(),Js=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Zs=function(e){function t(t){void 0===t&&(t={});var n=e.call(this,t)||this;if(t.contextManager)throw"contextManager should be defined in register method not in constructor";if(t.propagator)throw"propagator should be defined in register method not in constructor";return n}return Js(t,e),t.prototype.register=function(t){void 0===t&&(t={}),void 0===t.contextManager&&(t.contextManager=new Qs),t.contextManager&&t.contextManager.enable(),e.prototype.register.call(this,t)},t}(Hs),$s=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s},ea=1e4;function ta(e){return"number"==typeof e?e<=0?na(e,ea):e:function(){var e,t=Number(null!==(e=Dr().OTEL_EXPORTER_OTLP_TRACES_TIMEOUT)&&void 0!==e?e:Dr().OTEL_EXPORTER_OTLP_TIMEOUT);return t<=0?na(t,ea):t}()}function na(e,t){return Kn.warn("Timeout must be greater than 0",e),t}var ra=function(){function e(e){void 0===e&&(e={}),this._sendingPromises=[],this.url=this.getDefaultUrl(e),"string"==typeof e.hostname&&(this.hostname=e.hostname),this.shutdown=this.shutdown.bind(this),this._shutdownOnce=new yo(this._shutdown,this),this._concurrencyLimit="number"==typeof e.concurrencyLimit?e.concurrencyLimit:1/0,this.timeoutMillis=ta(e.timeoutMillis),this.onInit(e)}return e.prototype.export=function(e,t){this._shutdownOnce.isCalled?t({code:qr.FAILED,error:new Error("Exporter has been shutdown")}):this._sendingPromises.length>=this._concurrencyLimit?t({code:qr.FAILED,error:new Error("Concurrent export limit reached")}):this._export(e).then((function(){t({code:qr.SUCCESS})})).catch((function(e){t({code:qr.FAILED,error:e})}))},e.prototype._export=function(e){var t=this;return new Promise((function(n,r){try{Kn.debug("items to be sent",e),t.send(e,n,r)}catch(e){r(e)}}))},e.prototype.shutdown=function(){return this._shutdownOnce.call()},e.prototype._shutdown=function(){return Kn.debug("shutdown started"),this.onShutdown(),Promise.all(this._sendingPromises).then((function(){}))},e}(),oa=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ia=function(e){function t(t,n,r){var o=e.call(this,t)||this;return o.name="OTLPExporterError",o.data=r,o.code=n,o}return oa(t,e),t}(Error),sa=function(){return sa=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},sa.apply(this,arguments)},aa=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s};var ca,ua=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),la=function(e){function t(t){void 0===t&&(t={});var n=e.call(this,t)||this;return n._useXHR=!1,n._useXHR=!!t.headers||"function"!=typeof navigator.sendBeacon,n._useXHR?n._headers=Object.assign({},function(e){void 0===e&&(e={});var t={};return Object.entries(e).forEach((function(e){var n=$s(e,2),r=n[0],o=n[1];void 0!==o?t[r]=String(o):Kn.warn('Header "'+r+'" has wrong value and will be ignored')})),t}(t.headers),br(Dr().OTEL_EXPORTER_OTLP_HEADERS)):n._headers={},n}return ua(t,e),t.prototype.onInit=function(){window.addEventListener("unload",this.shutdown)},t.prototype.onShutdown=function(){window.removeEventListener("unload",this.shutdown)},t.prototype.send=function(e,t,n){var r=this;if(this._shutdownOnce.isCalled)Kn.debug("Shutdown already started. Cannot send objects");else{var o=this.convert(e),i=JSON.stringify(o),s=new Promise((function(e,t){r._useXHR?function(e,t,n,r,o,i){var s,a=setTimeout((function(){s=!0,c.abort()}),r),c=new XMLHttpRequest;c.open("POST",t),Object.entries(sa(sa({},{Accept:"application/json","Content-Type":"application/json"}),n)).forEach((function(e){var t=aa(e,2),n=t[0],r=t[1];c.setRequestHeader(n,r)})),c.send(e),c.onreadystatechange=function(){if(c.readyState===XMLHttpRequest.DONE)if(c.status>=200&&c.status<=299)clearTimeout(a),Kn.debug("xhr success",e),o();else if(s){var t=new ia("Request Timeout",c.status);i(t)}else t=new ia("Failed to export with XHR (status: "+c.status+")",c.status),clearTimeout(a),i(t)}}(i,r.url,r._headers,r.timeoutMillis,e,t):function(e,t,n,r,o){navigator.sendBeacon(t,new Blob([e],n))?(Kn.debug("sendBeacon - can send",e),r()):o(new ia("sendBeacon - cannot send "+e))}(i,r.url,{type:"application/json"},e,t)})).then(t,n);this._sendingPromises.push(s);var a=function(){var e=r._sendingPromises.indexOf(s);r._sendingPromises.splice(e,1)};s.then(a,a)}},t}(ra);!function(e){e[e.SPAN_KIND_UNSPECIFIED=0]="SPAN_KIND_UNSPECIFIED",e[e.SPAN_KIND_INTERNAL=1]="SPAN_KIND_INTERNAL",e[e.SPAN_KIND_SERVER=2]="SPAN_KIND_SERVER",e[e.SPAN_KIND_CLIENT=3]="SPAN_KIND_CLIENT",e[e.SPAN_KIND_PRODUCER=4]="SPAN_KIND_PRODUCER",e[e.SPAN_KIND_CONSUMER=5]="SPAN_KIND_CONSUMER"}(ca||(ca={}));var pa=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s};function ha(e){return Object.keys(e).map((function(t){return da(t,e[t])}))}function da(e,t){return{key:e,value:fa(t)}}function fa(e){var t=typeof e;return"string"===t?{stringValue:e}:"number"===t?Number.isInteger(e)?{intValue:e}:{doubleValue:e}:"boolean"===t?{boolValue:e}:e instanceof Uint8Array?{bytesValue:e}:Array.isArray(e)?{arrayValue:{values:e.map(fa)}}:"object"===t&&null!=e?{kvlistValue:{values:Object.entries(e).map((function(e){var t=pa(e,2);return da(t[0],t[1])}))}}:{}}function va(e,t){var n=e.spanContext(),r=e.status,o=t?e.parentSpanId:null!=e.parentSpanId?Br(e.parentSpanId):void 0;return{traceId:t?n.traceId:Br(n.traceId),spanId:t?n.spanId:Br(n.spanId),parentSpanId:o,name:e.name,kind:null==e.kind?0:e.kind+1,startTimeUnixNano:Jr(e.startTime),endTimeUnixNano:Jr(e.endTime),attributes:ha(e.attributes),droppedAttributesCount:0,events:e.events.map(_a),droppedEventsCount:0,status:{code:r.code,message:r.message},links:e.links.map((function(e){return function(e,t){return{attributes:e.attributes?ha(e.attributes):[],spanId:t?e.context.spanId:Br(e.context.spanId),traceId:t?e.context.traceId:Br(e.context.traceId),droppedAttributesCount:0}}(e,t)})),droppedLinksCount:0}}function _a(e){return{attributes:e.attributes?ha(e.attributes):[],name:e.name,timeUnixNano:Jr(e.time),droppedAttributesCount:0}}var ya=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},ga=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s};function ma(e,t){for(var n=function(e){var t,n,r=new Map;try{for(var o=ya(e),i=o.next();!i.done;i=o.next()){var s=i.value,a=r.get(s.resource);a||(a=new Map,r.set(s.resource,a));var c=s.instrumentationLibrary.name+"@"+(s.instrumentationLibrary.version||"")+":"+(s.instrumentationLibrary.schemaUrl||""),u=a.get(c);u||(u=[],a.set(c,u)),u.push(s)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return r}(e),r=[],o=n.entries(),i=o.next();!i.done;){for(var s=ga(i.value,2),a=s[0],c=[],u=s[1].values(),l=u.next();!l.done;){var p=l.value;if(p.length>0){var h=p[0].instrumentationLibrary,d=h.name,f=h.version,v=h.schemaUrl,_=p.map((function(e){return va(e,t)}));c.push({scope:{name:d,version:f},spans:_,schemaUrl:v})}l=u.next()}var y={resource:{attributes:ha(a.attributes),droppedAttributesCount:0},scopeSpans:c,schemaUrl:void 0};r.push(y),i=o.next()}return r}var ba,Ea=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ta=function(){function e(){}return e.prototype.createHistogram=function(e,t){return xa},e.prototype.createCounter=function(e,t){return Ia},e.prototype.createUpDownCounter=function(e,t){return Na},e.prototype.createObservableGauge=function(e,t){return Ua},e.prototype.createObservableCounter=function(e,t){return ka},e.prototype.createObservableUpDownCounter=function(e,t){return Da},e.prototype.addBatchObservableCallback=function(e,t){},e.prototype.removeBatchObservableCallback=function(e){},e}(),Sa=function(){},Oa=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ea(t,e),t.prototype.add=function(e,t){},t}(Sa),wa=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ea(t,e),t.prototype.add=function(e,t){},t}(Sa),Ra=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ea(t,e),t.prototype.record=function(e,t){},t}(Sa),Ca=function(){function e(){}return e.prototype.addCallback=function(e){},e.prototype.removeCallback=function(e){},e}(),Aa=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ea(t,e),t}(Ca),Pa=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ea(t,e),t}(Ca),La=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ea(t,e),t}(Ca),Ma=new Ta,Ia=new Oa,xa=new Ra,Na=new wa,ka=new Aa,Ua=new Pa,Da=new La;!function(e){e[e.INT=0]="INT",e[e.DOUBLE=1]="DOUBLE"}(ba||(ba={}));var Ba=new(function(){function e(){}return e.prototype.getMeter=function(e,t,n){return Ma},e}()),ja="object"==typeof globalThis?globalThis:"object"==typeof self?self:"object"==typeof window?window:"object"==typeof e.g?e.g:{},Va=Symbol.for("io.opentelemetry.js.api.metrics"),Fa=ja;var Ga,Xa,Ka=function(){function e(){}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalMeterProvider=function(e){return Fa[Va]?this.getMeterProvider():(Fa[Va]=(t=4,n=e,r=Ba,function(e){return e===t?n:r}),e);var t,n,r},e.prototype.getMeterProvider=function(){var e,t;return null!==(t=null===(e=Fa[Va])||void 0===e?void 0:e.call(Fa,4))&&void 0!==t?t:Ba},e.prototype.getMeter=function(e,t,n){return this.getMeterProvider().getMeter(e,t,n)},e.prototype.disable=function(){delete Fa[Va]},e}();Ka.getInstance();!function(e){e[e.DELTA=0]="DELTA",e[e.CUMULATIVE=1]="CUMULATIVE"}(Ga||(Ga={})),function(e){e[e.HISTOGRAM=0]="HISTOGRAM",e[e.EXPONENTIAL_HISTOGRAM=1]="EXPONENTIAL_HISTOGRAM",e[e.GAUGE=2]="GAUGE",e[e.SUM=3]="SUM"}(Xa||(Xa={}));var qa=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),za=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))},Ha=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},Wa=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s},Ya=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},Qa=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};function Ja(e){return null!=e}function Za(e){var t=Object.keys(e);return 0===t.length?"":(t=t.sort(),JSON.stringify(t.map((function(t){return[t,e[t]]}))))}var $a,ec=function(e){function t(n){var r=e.call(this,n)||this;return Object.setPrototypeOf(r,t.prototype),r}return qa(t,e),t}(Error);function tc(e,t){var n,r=new Promise((function(e,r){n=setTimeout((function(){r(new ec("Operation timed out."))}),t)}));return Promise.race([e,r]).then((function(e){return clearTimeout(n),e}),(function(e){throw clearTimeout(n),e}))}function nc(e){return za(this,void 0,void 0,(function(){var t=this;return Ha(this,(function(n){return[2,Promise.all(e.map((function(e){return za(t,void 0,void 0,(function(){return Ha(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,e];case 1:return[2,{status:"fulfilled",value:t.sent()}];case 2:return[2,{status:"rejected",reason:t.sent()}];case 3:return[2]}}))}))})))]}))}))}function rc(e){return"rejected"===e.status}function oc(e,t){var n=[];return e.forEach((function(e){n.push.apply(n,Ya([],Wa(t(e)),!1))})),n}!function(e){e[e.DROP=0]="DROP",e[e.SUM=1]="SUM",e[e.LAST_VALUE=2]="LAST_VALUE",e[e.HISTOGRAM=3]="HISTOGRAM"}($a||($a={}));var ic,sc=function(){function e(){this.kind=$a.DROP}return e.prototype.createAccumulation=function(){},e.prototype.merge=function(e,t){},e.prototype.diff=function(e,t){},e.prototype.toMetricData=function(e,t,n,r){},e}();function ac(e,t,n){var r,o,i;return{name:e,type:t,description:null!==(r=null==n?void 0:n.description)&&void 0!==r?r:"",unit:null!==(o=null==n?void 0:n.unit)&&void 0!==o?o:"",valueType:null!==(i=null==n?void 0:n.valueType)&&void 0!==i?i:ba.DOUBLE}}!function(e){e.COUNTER="COUNTER",e.HISTOGRAM="HISTOGRAM",e.UP_DOWN_COUNTER="UP_DOWN_COUNTER",e.OBSERVABLE_COUNTER="OBSERVABLE_COUNTER",e.OBSERVABLE_GAUGE="OBSERVABLE_GAUGE",e.OBSERVABLE_UP_DOWN_COUNTER="OBSERVABLE_UP_DOWN_COUNTER"}(ic||(ic={}));var cc=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s};var uc=function(){function e(e,t,n,r){var o,i;void 0===n&&(n=!0),void 0===r&&((i=(o=t).map((function(){return 0}))).push(0),r={buckets:{boundaries:o,counts:i},sum:0,count:0,hasMinMax:!1,min:1/0,max:-1/0}),this.startTime=e,this._boundaries=t,this._recordMinMax=n,this._current=r}return e.prototype.record=function(e){this._current.count+=1,this._current.sum+=e,this._recordMinMax&&(this._current.min=Math.min(e,this._current.min),this._current.max=Math.max(e,this._current.max),this._current.hasMinMax=!0);for(var t=0;t<this._boundaries.length;t++)if(e<this._boundaries[t])return void(this._current.buckets.counts[t]+=1);this._current.buckets.counts[this._boundaries.length]+=1},e.prototype.setStartTime=function(e){this.startTime=e},e.prototype.toPointValue=function(){return this._current},e}(),lc=function(){function e(e,t){this._boundaries=e,this._recordMinMax=t,this.kind=$a.HISTOGRAM}return e.prototype.createAccumulation=function(e){return new uc(e,this._boundaries,this._recordMinMax)},e.prototype.merge=function(e,t){for(var n=e.toPointValue(),r=t.toPointValue(),o=n.buckets.counts,i=r.buckets.counts,s=new Array(o.length),a=0;a<o.length;a++)s[a]=o[a]+i[a];var c=1/0,u=-1/0;return this._recordMinMax&&(n.hasMinMax&&r.hasMinMax?(c=Math.min(n.min,r.min),u=Math.max(n.max,r.max)):n.hasMinMax?(c=n.min,u=n.max):r.hasMinMax&&(c=r.min,u=r.max)),new uc(e.startTime,n.buckets.boundaries,this._recordMinMax,{buckets:{boundaries:n.buckets.boundaries,counts:s},count:n.count+r.count,sum:n.sum+r.sum,hasMinMax:this._recordMinMax&&(n.hasMinMax||r.hasMinMax),min:c,max:u})},e.prototype.diff=function(e,t){for(var n=e.toPointValue(),r=t.toPointValue(),o=n.buckets.counts,i=r.buckets.counts,s=new Array(o.length),a=0;a<o.length;a++)s[a]=i[a]-o[a];return new uc(t.startTime,n.buckets.boundaries,this._recordMinMax,{buckets:{boundaries:n.buckets.boundaries,counts:s},count:r.count-n.count,sum:r.sum-n.sum,hasMinMax:!1,min:1/0,max:-1/0})},e.prototype.toMetricData=function(e,t,n,r){return{descriptor:e,aggregationTemporality:t,dataPointType:Xa.HISTOGRAM,dataPoints:n.map((function(t){var n=cc(t,2),o=n[0],i=n[1],s=i.toPointValue(),a=e.type===ic.UP_DOWN_COUNTER||e.type===ic.OBSERVABLE_GAUGE||e.type===ic.OBSERVABLE_UP_DOWN_COUNTER;return{attributes:o,startTime:i.startTime,endTime:r,value:{min:s.hasMinMax?s.min:void 0,max:s.hasMinMax?s.max:void 0,sum:a?void 0:s.sum,buckets:s.buckets,count:s.count}}}))}},e}(),pc=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s},hc=function(){function e(e,t,n){void 0===t&&(t=0),void 0===n&&(n=[0,0]),this.startTime=e,this._current=t,this.sampleTime=n}return e.prototype.record=function(e){this._current=e,this.sampleTime=Qr()},e.prototype.setStartTime=function(e){this.startTime=e},e.prototype.toPointValue=function(){return this._current},e}(),dc=function(){function e(){this.kind=$a.LAST_VALUE}return e.prototype.createAccumulation=function(e){return new hc(e)},e.prototype.merge=function(e,t){var n=Zr(t.sampleTime)>=Zr(e.sampleTime)?t:e;return new hc(e.startTime,n.toPointValue(),n.sampleTime)},e.prototype.diff=function(e,t){var n=Zr(t.sampleTime)>=Zr(e.sampleTime)?t:e;return new hc(t.startTime,n.toPointValue(),n.sampleTime)},e.prototype.toMetricData=function(e,t,n,r){return{descriptor:e,aggregationTemporality:t,dataPointType:Xa.GAUGE,dataPoints:n.map((function(e){var t=pc(e,2),n=t[0],o=t[1];return{attributes:n,startTime:o.startTime,endTime:r,value:o.toPointValue()}}))}},e}(),fc=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s},vc=function(){function e(e,t,n,r){void 0===n&&(n=0),void 0===r&&(r=!1),this.startTime=e,this.monotonic=t,this._current=n,this.reset=r}return e.prototype.record=function(e){this.monotonic&&e<0||(this._current+=e)},e.prototype.setStartTime=function(e){this.startTime=e},e.prototype.toPointValue=function(){return this._current},e}(),_c=function(){function e(e){this.monotonic=e,this.kind=$a.SUM}return e.prototype.createAccumulation=function(e){return new vc(e,this.monotonic)},e.prototype.merge=function(e,t){var n=e.toPointValue(),r=t.toPointValue();return t.reset?new vc(t.startTime,this.monotonic,r,t.reset):new vc(e.startTime,this.monotonic,n+r)},e.prototype.diff=function(e,t){var n=e.toPointValue(),r=t.toPointValue();return this.monotonic&&n>r?new vc(t.startTime,this.monotonic,r,!0):new vc(t.startTime,this.monotonic,r-n)},e.prototype.toMetricData=function(e,t,n,r){return{descriptor:e,aggregationTemporality:t,dataPointType:Xa.SUM,dataPoints:n.map((function(e){var t=fc(e,2),n=t[0],o=t[1];return{attributes:n,startTime:o.startTime,endTime:r,value:o.toPointValue()}})),isMonotonic:this.monotonic}},e}(),yc=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),gc=function(){function e(){}return e.Drop=function(){return Oc},e.Sum=function(){return wc},e.LastValue=function(){return Rc},e.Histogram=function(){return Cc},e.Default=function(){return Ac},e}(),mc=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return yc(t,e),t.prototype.createAggregator=function(e){return t.DEFAULT_INSTANCE},t.DEFAULT_INSTANCE=new sc,t}(gc),bc=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return yc(t,e),t.prototype.createAggregator=function(e){switch(e.type){case ic.COUNTER:case ic.OBSERVABLE_COUNTER:case ic.HISTOGRAM:return t.MONOTONIC_INSTANCE;default:return t.NON_MONOTONIC_INSTANCE}},t.MONOTONIC_INSTANCE=new _c(!0),t.NON_MONOTONIC_INSTANCE=new _c(!1),t}(gc),Ec=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return yc(t,e),t.prototype.createAggregator=function(e){return t.DEFAULT_INSTANCE},t.DEFAULT_INSTANCE=new dc,t}(gc),Tc=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return yc(t,e),t.prototype.createAggregator=function(e){return t.DEFAULT_INSTANCE},t.DEFAULT_INSTANCE=new lc([0,5,10,25,50,75,100,250,500,1e3],!0),t}(gc),Sc=(function(e){function t(t,n){void 0===n&&(n=!0);var r=e.call(this)||this;if(r._recordMinMax=n,void 0===t||0===t.length)throw new Error("HistogramAggregator should be created with boundaries.");var o=(t=(t=t.concat()).sort((function(e,t){return e-t}))).lastIndexOf(-1/0),i=t.indexOf(1/0);return-1===i&&(i=void 0),r._boundaries=t.slice(o+1,i),r}yc(t,e),t.prototype.createAggregator=function(e){return new lc(this._boundaries,this._recordMinMax)}}(gc),function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return yc(t,e),t.prototype._resolve=function(e){switch(e.type){case ic.COUNTER:case ic.UP_DOWN_COUNTER:case ic.OBSERVABLE_COUNTER:case ic.OBSERVABLE_UP_DOWN_COUNTER:return wc;case ic.OBSERVABLE_GAUGE:return Rc;case ic.HISTOGRAM:return Cc}return Kn.warn("Unable to recognize instrument type: "+e.type),Oc},t.prototype.createAggregator=function(e){return this._resolve(e).createAggregator(e)},t}(gc)),Oc=new mc,wc=new bc,Rc=new Ec,Cc=new Tc,Ac=new Sc,Pc=function(e){return gc.Default()},Lc=function(e){return Ga.CUMULATIVE},Mc=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))},Ic=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},xc=function(){function e(e){var t,n;this._shutdown=!1,this._aggregationSelector=null!==(t=null==e?void 0:e.aggregationSelector)&&void 0!==t?t:Pc,this._aggregationTemporalitySelector=null!==(n=null==e?void 0:e.aggregationTemporalitySelector)&&void 0!==n?n:Lc}return e.prototype.setMetricProducer=function(e){if(this._metricProducer)throw new Error("MetricReader can not be bound to a MeterProvider again.");this._metricProducer=e,this.onInitialized()},e.prototype.selectAggregation=function(e){return this._aggregationSelector(e)},e.prototype.selectAggregationTemporality=function(e){return this._aggregationTemporalitySelector(e)},e.prototype.onInitialized=function(){},e.prototype.collect=function(e){return Mc(this,void 0,void 0,(function(){return Ic(this,(function(t){if(void 0===this._metricProducer)throw new Error("MetricReader is not bound to a MetricProducer");if(this._shutdown)throw new Error("MetricReader is shutdown");return[2,this._metricProducer.collect({timeoutMillis:null==e?void 0:e.timeoutMillis})]}))}))},e.prototype.shutdown=function(e){return Mc(this,void 0,void 0,(function(){return Ic(this,(function(t){switch(t.label){case 0:return this._shutdown?(Kn.error("Cannot call shutdown twice."),[2]):null!=(null==e?void 0:e.timeoutMillis)?[3,2]:[4,this.onShutdown()];case 1:return t.sent(),[3,4];case 2:return[4,tc(this.onShutdown(),e.timeoutMillis)];case 3:t.sent(),t.label=4;case 4:return this._shutdown=!0,[2]}}))}))},e.prototype.forceFlush=function(e){return Mc(this,void 0,void 0,(function(){return Ic(this,(function(t){switch(t.label){case 0:return this._shutdown?(Kn.warn("Cannot forceFlush on already shutdown MetricReader."),[2]):null!=(null==e?void 0:e.timeoutMillis)?[3,2]:[4,this.onForceFlush()];case 1:case 3:return t.sent(),[2];case 2:return[4,tc(this.onForceFlush(),e.timeoutMillis)]}}))}))},e}(),Nc=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),kc=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))},Uc=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},Dc=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s},Bc=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},jc=(function(e){function t(t){var n,r,o,i,s=e.call(this,{aggregationSelector:null===(n=t.exporter.selectAggregation)||void 0===n?void 0:n.bind(t.exporter),aggregationTemporalitySelector:null===(r=t.exporter.selectAggregationTemporality)||void 0===r?void 0:r.bind(t.exporter)})||this;if(void 0!==t.exportIntervalMillis&&t.exportIntervalMillis<=0)throw Error("exportIntervalMillis must be greater than 0");if(void 0!==t.exportTimeoutMillis&&t.exportTimeoutMillis<=0)throw Error("exportTimeoutMillis must be greater than 0");if(void 0!==t.exportTimeoutMillis&&void 0!==t.exportIntervalMillis&&t.exportIntervalMillis<t.exportTimeoutMillis)throw Error("exportIntervalMillis must be greater than or equal to exportTimeoutMillis");return s._exportInterval=null!==(o=t.exportIntervalMillis)&&void 0!==o?o:6e4,s._exportTimeout=null!==(i=t.exportTimeoutMillis)&&void 0!==i?i:3e4,s._exporter=t.exporter,s}Nc(t,e),t.prototype._runOnce=function(){return kc(this,void 0,void 0,(function(){var e,t,n,r,o=this;return Uc(this,(function(i){switch(i.label){case 0:return[4,this.collect({})];case 1:return e=i.sent(),t=e.resourceMetrics,(n=e.errors).length>0&&(r=Kn).error.apply(r,Bc(["PeriodicExportingMetricReader: metrics collection errors"],Dc(n),!1)),[2,new Promise((function(e,n){o._exporter.export(t,(function(t){var r;t.code!==qr.SUCCESS?n(null!==(r=t.error)&&void 0!==r?r:new Error("PeriodicExportingMetricReader: metrics export failed (error "+t.error+")")):e()}))}))]}}))}))},t.prototype.onInitialized=function(){var e=this;this._interval=setInterval((function(){return kc(e,void 0,void 0,(function(){var e;return Uc(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,tc(this._runOnce(),this._exportTimeout)];case 1:return t.sent(),[3,3];case 2:return(e=t.sent())instanceof ec?(Kn.error("Export took longer than %s milliseconds and timed out.",this._exportTimeout),[2]):(Sr(e),[3,3]);case 3:return[2]}}))}))}),this._exportInterval),this._interval},t.prototype.onForceFlush=function(){return kc(this,void 0,void 0,(function(){return Uc(this,(function(e){switch(e.label){case 0:return[4,this._exporter.forceFlush()];case 1:return e.sent(),[2]}}))}))},t.prototype.onShutdown=function(){return kc(this,void 0,void 0,(function(){return Uc(this,(function(e){switch(e.label){case 0:return this._interval&&clearInterval(this._interval),[4,this._exporter.shutdown()];case 1:return e.sent(),[2]}}))}))}}(xc),function(){function e(e){this._shutdown=!1,this._metrics=[],this._aggregationTemporality=e}e.prototype.export=function(e,t){this._shutdown?setTimeout((function(){return t({code:qr.FAILED})}),0):(this._metrics.push(e),setTimeout((function(){return t({code:qr.SUCCESS})}),0))},e.prototype.getMetrics=function(){return this._metrics},e.prototype.forceFlush=function(){return Promise.resolve()},e.prototype.reset=function(){this._metrics=[]},e.prototype.selectAggregationTemporality=function(e){return this._aggregationTemporality},e.prototype.shutdown=function(){return this._shutdown=!0,Promise.resolve()}}(),function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}),Vc=(function(){function e(){this._shutdown=!1}e.prototype.export=function(t,n){if(!this._shutdown)return e._sendMetrics(t,n);setImmediate(n,{code:qr.FAILED})},e.prototype.forceFlush=function(){return Promise.resolve()},e.prototype.selectAggregationTemporality=function(e){return Ga.CUMULATIVE},e.prototype.shutdown=function(){return this._shutdown=!0,Promise.resolve()},e._sendMetrics=function(e,t){var n,r,o,i;try{for(var s=jc(e.scopeMetrics),a=s.next();!a.done;a=s.next()){var c=a.value;try{for(var u=(o=void 0,jc(c.metrics)),l=u.next();!l.done;l=u.next()){var p=l.value;console.dir({descriptor:p.descriptor,dataPointType:p.dataPointType,dataPoints:p.dataPoints})}}catch(e){o={error:e}}finally{try{l&&!l.done&&(i=u.return)&&i.call(u)}finally{if(o)throw o.error}}}}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}t({code:qr.SUCCESS})}}(),function(){function e(){this._registeredViews=[]}return e.prototype.addView=function(e){this._registeredViews.push(e)},e.prototype.findViews=function(e,t){var n=this;return this._registeredViews.filter((function(r){return n._matchInstrument(r.instrumentSelector,e)&&n._matchMeter(r.meterSelector,t)}))},e.prototype._matchInstrument=function(e,t){return(void 0===e.getType()||t.type===e.getType())&&e.getNameFilter().match(t.name)},e.prototype._matchMeter=function(e,t){return e.getNameFilter().match(t.name)&&(void 0===t.version||e.getVersionFilter().match(t.version))&&(void 0===t.schemaUrl||e.getSchemaUrlFilter().match(t.schemaUrl))},e}()),Fc=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Gc=function(){function e(e,t){this._writableMetricStorage=e,this._descriptor=t}return e.prototype._record=function(e,t,n){void 0===t&&(t={}),void 0===n&&(n=Fn.active()),this._descriptor.valueType!==ba.INT||Number.isInteger(e)||(Kn.warn("INT value type cannot accept a floating-point value for "+this._descriptor.name+", ignoring the fractional digits."),e=Math.trunc(e)),this._writableMetricStorage.record(e,t,n,Qr())},e}(),Xc=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Fc(t,e),t.prototype.add=function(e,t,n){this._record(e,t,n)},t}(Gc),Kc=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Fc(t,e),t.prototype.add=function(e,t,n){e<0?Kn.warn("negative value provided to counter "+this._descriptor.name+": "+e):this._record(e,t,n)},t}(Gc),qc=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Fc(t,e),t.prototype.record=function(e,t,n){e<0?Kn.warn("negative value provided to histogram "+this._descriptor.name+": "+e):this._record(e,t,n)},t}(Gc),zc=function(){function e(e,t,n){this._observableRegistry=n,this._descriptor=e,this._metricStorages=t}return e.prototype.addCallback=function(e){this._observableRegistry.addCallback(e,this)},e.prototype.removeCallback=function(e){this._observableRegistry.removeCallback(e,this)},e}(),Hc=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Fc(t,e),t}(zc),Wc=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Fc(t,e),t}(zc),Yc=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Fc(t,e),t}(zc);function Qc(e){return e instanceof zc}var Jc=function(){function e(e){this._meterSharedState=e}return e.prototype.createHistogram=function(e,t){var n=ac(e,ic.HISTOGRAM,t),r=this._meterSharedState.registerMetricStorage(n);return new qc(r,n)},e.prototype.createCounter=function(e,t){var n=ac(e,ic.COUNTER,t),r=this._meterSharedState.registerMetricStorage(n);return new Kc(r,n)},e.prototype.createUpDownCounter=function(e,t){var n=ac(e,ic.UP_DOWN_COUNTER,t),r=this._meterSharedState.registerMetricStorage(n);return new Xc(r,n)},e.prototype.createObservableGauge=function(e,t){var n=ac(e,ic.OBSERVABLE_GAUGE,t),r=this._meterSharedState.registerAsyncMetricStorage(n);return new Wc(n,r,this._meterSharedState.observableRegistry)},e.prototype.createObservableCounter=function(e,t){var n=ac(e,ic.OBSERVABLE_COUNTER,t),r=this._meterSharedState.registerAsyncMetricStorage(n);return new Hc(n,r,this._meterSharedState.observableRegistry)},e.prototype.createObservableUpDownCounter=function(e,t){var n=ac(e,ic.OBSERVABLE_UP_DOWN_COUNTER,t),r=this._meterSharedState.registerAsyncMetricStorage(n);return new Yc(n,r,this._meterSharedState.observableRegistry)},e.prototype.addBatchObservableCallback=function(e,t){this._meterSharedState.observableRegistry.addBatchCallback(e,t)},e.prototype.removeBatchObservableCallback=function(e,t){this._meterSharedState.observableRegistry.removeBatchCallback(e,t)},e}(),Zc=function(){function e(e){this._instrumentDescriptor=e}return e.prototype.getInstrumentDescriptor=function(){return this._instrumentDescriptor},e.prototype.updateDescription=function(e){this._instrumentDescriptor=ac(this._instrumentDescriptor.name,this._instrumentDescriptor.type,{description:e,valueType:this._instrumentDescriptor.valueType,unit:this._instrumentDescriptor.unit})},e}(),$c=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),eu=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},tu=function(){function e(e){this._hash=e,this._valueMap=new Map,this._keyMap=new Map}return e.prototype.get=function(e,t){return null!=t||(t=this._hash(e)),this._valueMap.get(t)},e.prototype.getOrDefault=function(e,t){var n=this._hash(e);if(this._valueMap.has(n))return this._valueMap.get(n);var r=t();return this._keyMap.has(n)||this._keyMap.set(n,e),this._valueMap.set(n,r),r},e.prototype.set=function(e,t,n){null!=n||(n=this._hash(e)),this._keyMap.has(n)||this._keyMap.set(n,e),this._valueMap.set(n,t)},e.prototype.has=function(e,t){return null!=t||(t=this._hash(e)),this._valueMap.has(t)},e.prototype.keys=function(){var e,t;return eu(this,(function(n){switch(n.label){case 0:e=this._keyMap.entries(),t=e.next(),n.label=1;case 1:return!0===t.done?[3,3]:[4,[t.value[1],t.value[0]]];case 2:return n.sent(),t=e.next(),[3,1];case 3:return[2]}}))},e.prototype.entries=function(){var e,t;return eu(this,(function(n){switch(n.label){case 0:e=this._valueMap.entries(),t=e.next(),n.label=1;case 1:return!0===t.done?[3,3]:[4,[this._keyMap.get(t.value[0]),t.value[1],t.value[0]]];case 2:return n.sent(),t=e.next(),[3,1];case 3:return[2]}}))},Object.defineProperty(e.prototype,"size",{get:function(){return this._valueMap.size},enumerable:!1,configurable:!0}),e}(),nu=function(e){function t(){return e.call(this,Za)||this}return $c(t,e),t}(tu),ru=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s},ou=function(){function e(e){this._aggregator=e,this._activeCollectionStorage=new nu,this._cumulativeMemoStorage=new nu}return e.prototype.record=function(e,t,n,r){var o=this,i=this._activeCollectionStorage.getOrDefault(t,(function(){return o._aggregator.createAccumulation(r)}));null==i||i.record(e)},e.prototype.batchCumulate=function(e,t){var n=this;Array.from(e.entries()).forEach((function(e){var r=ru(e,3),o=r[0],i=r[1],s=r[2],a=n._aggregator.createAccumulation(t);null==a||a.record(i);var c=a;if(n._cumulativeMemoStorage.has(o,s)){var u=n._cumulativeMemoStorage.get(o,s);c=n._aggregator.diff(u,a)}n._cumulativeMemoStorage.set(o,a,s),n._activeCollectionStorage.set(o,c,s)}))},e.prototype.collect=function(){var e=this._activeCollectionStorage;return this._activeCollectionStorage=new nu,e},e}(),iu=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},su=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s},au=function(){function e(e){this._aggregator=e,this._unreportedAccumulations=new Map,this._reportHistory=new Map}return e.prototype.buildMetrics=function(t,n,r,o,i){this._stashAccumulations(n,o);var s,a,c=this._getMergedUnreportedAccumulations(t),u=c;if(this._reportHistory.has(t)){var l=this._reportHistory.get(t),p=l.collectionTime;u=(s=l.aggregationTemporality)===Ga.CUMULATIVE?e.merge(l.accumulations,c,this._aggregator):e.calibrateStartTime(l.accumulations,c,p)}else s=t.selectAggregationTemporality(r.type);return this._reportHistory.set(t,{accumulations:u,collectionTime:i,aggregationTemporality:s}),this._aggregator.toMetricData(r,s,(a=u,Array.from(a.entries())),i)},e.prototype._stashAccumulations=function(e,t){var n=this;e.forEach((function(e){var r=n._unreportedAccumulations.get(e);void 0===r&&(r=[],n._unreportedAccumulations.set(e,r)),r.push(t)}))},e.prototype._getMergedUnreportedAccumulations=function(t){var n,r,o=new nu,i=this._unreportedAccumulations.get(t);if(this._unreportedAccumulations.set(t,[]),void 0===i)return o;try{for(var s=iu(i),a=s.next();!a.done;a=s.next()){var c=a.value;o=e.merge(o,c,this._aggregator)}}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}return o},e.merge=function(e,t,n){for(var r=e,o=t.entries(),i=o.next();!0!==i.done;){var s=su(i.value,3),a=s[0],c=s[1],u=s[2];if(e.has(a,u)){var l=e.get(a,u),p=n.merge(l,c);r.set(a,p,u)}else r.set(a,c,u);i=o.next()}return r},e.calibrateStartTime=function(e,t,n){var r,o;try{for(var i=iu(e.keys()),s=i.next();!s.done;s=i.next()){var a=su(s.value,2),c=a[0],u=a[1],l=t.get(c,u);null==l||l.setStartTime(n)}}catch(e){r={error:e}}finally{try{s&&!s.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return t},e}();var cu=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),uu=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s},lu=function(e){function t(t,n,r){var o=e.call(this,t)||this;return o._attributesProcessor=r,o._deltaMetricStorage=new ou(n),o._temporalMetricStorage=new au(n),o}return cu(t,e),t.prototype.record=function(e,t){var n=this,r=new nu;Array.from(e.entries()).forEach((function(e){var t=uu(e,2),o=t[0],i=t[1];r.set(n._attributesProcessor.process(o),i)})),this._deltaMetricStorage.batchCumulate(r,t)},t.prototype.collect=function(e,t,n){var r=this._deltaMetricStorage.collect();return this._temporalMetricStorage.buildMetrics(e,t,this._instrumentDescriptor,r,n)},t}(Zc);function pu(e,t){var n="";return e.unit!==t.unit&&(n+="\t- Unit '"+e.unit+"' does not match '"+t.unit+"'\n"),e.type!==t.type&&(n+="\t- Type '"+e.type+"' does not match '"+t.type+"'\n"),e.valueType!==t.valueType&&(n+="\t- Value Type '"+e.valueType+"' does not match '"+t.valueType+"'\n"),e.description!==t.description&&(n+="\t- Description '"+e.description+"' does not match '"+t.description+"'\n"),n}function hu(e,t){return e.valueType!==t.valueType?function(e,t){return"\t- use valueType '"+e.valueType+"' on instrument creation or use an instrument name other than '"+t.name+"'"}(e,t):e.unit!==t.unit?function(e,t){return"\t- use unit '"+e.unit+"' on instrument creation or use an instrument name other than '"+t.name+"'"}(e,t):e.type!==t.type?function(e,t){var n={name:t.name,type:t.type},r=JSON.stringify(n);return"\t- create a new view with a name other than '"+e.name+"' and InstrumentSelector '"+r+"'"}(e,t):e.description!==t.description?function(e,t){var n={name:t.name,type:t.type},r=JSON.stringify(n);return"\t- create a new view with a name other than '"+e.name+"' and InstrumentSelector '"+r+"'\n    \t- OR - create a new view with the name "+e.name+" and description '"+e.description+"' and InstrumentSelector "+r+"\n    \t- OR - create a new view with the name "+t.name+" and description '"+e.description+"' and InstrumentSelector "+r}(e,t):""}var du=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},fu=function(){function e(){this._sharedRegistry=new Map,this._perCollectorRegistry=new Map}return e.create=function(){return new e},e.prototype.getStorages=function(e){var t,n,r,o,i=[];try{for(var s=du(this._sharedRegistry.values()),a=s.next();!a.done;a=s.next()){var c=a.value;i=i.concat(c)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}var u=this._perCollectorRegistry.get(e);if(null!=u)try{for(var l=du(u.values()),p=l.next();!p.done;p=l.next()){c=p.value;i=i.concat(c)}}catch(e){r={error:e}}finally{try{p&&!p.done&&(o=l.return)&&o.call(l)}finally{if(r)throw r.error}}return i},e.prototype.register=function(e){this._registerStorage(e,this._sharedRegistry)},e.prototype.registerForCollector=function(e,t){var n=this._perCollectorRegistry.get(e);null==n&&(n=new Map,this._perCollectorRegistry.set(e,n)),this._registerStorage(t,n)},e.prototype.findOrUpdateCompatibleStorage=function(e){var t=this._sharedRegistry.get(e.name);return void 0===t?null:this._findOrUpdateCompatibleStorage(e,t)},e.prototype.findOrUpdateCompatibleCollectorStorage=function(e,t){if(void 0===this._perCollectorRegistry.get(e))return null;var n=this._sharedRegistry.get(t.name);return void 0===n?null:this._findOrUpdateCompatibleStorage(t,n)},e.prototype._registerStorage=function(e,t){var n=e.getInstrumentDescriptor(),r=t.get(n.name);void 0!==r?r.push(e):t.set(n.name,[e])},e.prototype._findOrUpdateCompatibleStorage=function(e,t){var n,r,o,i,s=null;try{for(var a=du(t),c=a.next();!c.done;c=a.next()){var u=c.value,l=u.getInstrumentDescriptor();i=e,(o=l).name===i.name&&o.unit===i.unit&&o.type===i.type&&o.valueType===i.valueType?(l.description!==e.description&&(e.description.length>l.description.length&&u.updateDescription(e.description),Kn.warn("A view or instrument with the name ",e.name," has already been registered, but has a different description and is incompatible with another registered view.\n","Details:\n",pu(l,e),"The longer description will be used.\nTo resolve the conflict:",hu(l,e))),s=u):Kn.warn("A view or instrument with the name ",e.name," has already been registered and is incompatible with another registered view.\n","Details:\n",pu(l,e),"To resolve the conflict:\n",hu(l,e))}}catch(e){n={error:e}}finally{try{c&&!c.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return s},e}(),vu=function(){function e(e){this._backingStorages=e}return e.prototype.record=function(e,t,n,r){this._backingStorages.forEach((function(o){o.record(e,t,n,r)}))},e}(),_u=function(){function e(e){this._descriptor=e,this._buffer=new nu}return e.prototype.observe=function(e,t){void 0===t&&(t={}),this._descriptor.valueType!==ba.INT||Number.isInteger(e)||(Kn.warn("INT value type cannot accept a floating-point value for "+this._descriptor.name+", ignoring the fractional digits."),e=Math.trunc(e)),this._buffer.set(t,e)},e}(),yu=function(){function e(){this._buffer=new Map}return e.prototype.observe=function(e,t,n){if(void 0===n&&(n={}),Qc(e)){var r=this._buffer.get(e);null==r&&(r=new nu,this._buffer.set(e,r)),e._descriptor.valueType!==ba.INT||Number.isInteger(t)||(Kn.warn("INT value type cannot accept a floating-point value for "+e._descriptor.name+", ignoring the fractional digits."),t=Math.trunc(t)),r.set(n,t)}},e}(),gu=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))},mu=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},bu=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s},Eu=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},Tu=function(){function e(){this._callbacks=[],this._batchCallbacks=[]}return e.prototype.addCallback=function(e,t){this._findCallback(e,t)>=0||this._callbacks.push({callback:e,instrument:t})},e.prototype.removeCallback=function(e,t){var n=this._findCallback(e,t);n<0||this._callbacks.splice(n,1)},e.prototype.addBatchCallback=function(e,t){var n=new Set(t.filter(Qc));0!==n.size?this._findBatchCallback(e,n)>=0||this._batchCallbacks.push({callback:e,instruments:n}):Kn.error("BatchObservableCallback is not associated with valid instruments",t)},e.prototype.removeBatchCallback=function(e,t){var n=new Set(t.filter(Qc)),r=this._findBatchCallback(e,n);r<0||this._batchCallbacks.splice(r,1)},e.prototype.observe=function(e,t){return gu(this,void 0,void 0,(function(){var n,r,o;return mu(this,(function(i){switch(i.label){case 0:return n=this._observeCallbacks(e,t),r=this._observeBatchCallbacks(e,t),[4,nc(Eu(Eu([],bu(n),!1),bu(r),!1))];case 1:return o=i.sent(),[2,o.filter(rc).map((function(e){return e.reason}))]}}))}))},e.prototype._observeCallbacks=function(e,t){var n=this;return this._callbacks.map((function(r){var o=r.callback,i=r.instrument;return gu(n,void 0,void 0,(function(){var n,r;return mu(this,(function(s){switch(s.label){case 0:return n=new _u(i._descriptor),r=Promise.resolve(o(n)),null!=t&&(r=tc(r,t)),[4,r];case 1:return s.sent(),i._metricStorages.forEach((function(t){t.record(n._buffer,e)})),[2]}}))}))}))},e.prototype._observeBatchCallbacks=function(e,t){var n=this;return this._batchCallbacks.map((function(r){var o=r.callback,i=r.instruments;return gu(n,void 0,void 0,(function(){var n,r;return mu(this,(function(s){switch(s.label){case 0:return n=new yu,r=Promise.resolve(o(n)),null!=t&&(r=tc(r,t)),[4,r];case 1:return s.sent(),i.forEach((function(t){var r=n._buffer.get(t);null!=r&&t._metricStorages.forEach((function(t){t.record(r,e)}))})),[2]}}))}))}))},e.prototype._findCallback=function(e,t){return this._callbacks.findIndex((function(n){return n.callback===e&&n.instrument===t}))},e.prototype._findBatchCallback=function(e,t){return this._batchCallbacks.findIndex((function(n){return n.callback===e&&function(e,t){var n,r;if(e.size!==t.size)return!1;try{for(var o=Qa(e),i=o.next();!i.done;i=o.next()){var s=i.value;if(!t.has(s))return!1}}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return!0}(n.instruments,t)}))},e}(),Su=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ou=function(e){function t(t,n,r){var o=e.call(this,t)||this;return o._attributesProcessor=r,o._deltaMetricStorage=new ou(n),o._temporalMetricStorage=new au(n),o}return Su(t,e),t.prototype.record=function(e,t,n,r){t=this._attributesProcessor.process(t,n),this._deltaMetricStorage.record(e,t,n,r)},t.prototype.collect=function(e,t,n){var r=this._deltaMetricStorage.collect();return this._temporalMetricStorage.buildMetrics(e,t,this._instrumentDescriptor,r,n)},t}(Zc),wu=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ru=function(){function e(){}return e.Noop=function(){return Au},e}(),Cu=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return wu(t,e),t.prototype.process=function(e,t){return e},t}(Ru),Au=(function(e){function t(t){var n=e.call(this)||this;return n._allowedAttributeNames=t,n}wu(t,e),t.prototype.process=function(e,t){var n=this,r={};return Object.keys(e).filter((function(e){return n._allowedAttributeNames.includes(e)})).forEach((function(t){return r[t]=e[t]})),r}}(Ru),new Cu),Pu=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))},Lu=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},Mu=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s},Iu=function(){function e(e,t){this._meterProviderSharedState=e,this._instrumentationScope=t,this.metricStorageRegistry=new fu,this.observableRegistry=new Tu,this.meter=new Jc(this)}return e.prototype.registerMetricStorage=function(e){var t=this._registerMetricStorage(e,Ou);return 1===t.length?t[0]:new vu(t)},e.prototype.registerAsyncMetricStorage=function(e){return this._registerMetricStorage(e,lu)},e.prototype.collect=function(e,t,n){return Pu(this,void 0,void 0,(function(){var r,o,i=this;return Lu(this,(function(s){switch(s.label){case 0:return[4,this.observableRegistry.observe(t,null==n?void 0:n.timeoutMillis)];case 1:return r=s.sent(),o=Array.from(this.metricStorageRegistry.getStorages(e)).map((function(n){return n.collect(e,i._meterProviderSharedState.metricCollectors,t)})).filter(Ja),[2,{scopeMetrics:{scope:this._instrumentationScope,metrics:o.filter(Ja)},errors:r}]}}))}))},e.prototype._registerMetricStorage=function(e,t){var n=this,r=this._meterProviderSharedState.viewRegistry.findViews(e,this._instrumentationScope).map((function(r){var o=function(e,t){var n,r;return{name:null!==(n=e.name)&&void 0!==n?n:t.name,description:null!==(r=e.description)&&void 0!==r?r:t.description,type:t.type,unit:t.unit,valueType:t.valueType}}(r,e),i=n.metricStorageRegistry.findOrUpdateCompatibleStorage(o);if(null!=i)return i;var s=r.aggregation.createAggregator(o),a=new t(o,s,r.attributesProcessor);return n.metricStorageRegistry.register(a),a}));if(0===r.length){var o=this._meterProviderSharedState.selectAggregations(e.type).map((function(r){var o=Mu(r,2),i=o[0],s=o[1],a=n.metricStorageRegistry.findOrUpdateCompatibleCollectorStorage(i,e);if(null!=a)return a;var c=s.createAggregator(e),u=new t(e,c,Ru.Noop());return n.metricStorageRegistry.registerForCollector(i,u),u}));r=r.concat(o)}return r},e}(),xu=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Nu=function(){function e(e){this.resource=e,this.viewRegistry=new Vc,this.metricCollectors=[],this.meterSharedStates=new Map}return e.prototype.getMeterSharedState=function(e){var t=function(e){var t,n;return e.name+":"+(null!==(t=e.version)&&void 0!==t?t:"")+":"+(null!==(n=e.schemaUrl)&&void 0!==n?n:"")}(e),n=this.meterSharedStates.get(t);return null==n&&(n=new Iu(this,e),this.meterSharedStates.set(t,n)),n},e.prototype.selectAggregations=function(e){var t,n,r=[];try{for(var o=xu(this.metricCollectors),i=o.next();!i.done;i=o.next()){var s=i.value;r.push([s,s.selectAggregation(e)])}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return r},e}(),ku=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))},Uu=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},Du=function(){function e(e,t){this._sharedState=e,this._metricReader=t}return e.prototype.collect=function(e){return ku(this,void 0,void 0,(function(){var t,n,r,o=this;return Uu(this,(function(i){switch(i.label){case 0:return t=Qr(),n=Array.from(this._sharedState.meterSharedStates.values()).map((function(n){return n.collect(o,t,e)})),[4,Promise.all(n)];case 1:return r=i.sent(),[2,{resourceMetrics:{resource:this._sharedState.resource,scopeMetrics:r.map((function(e){return e.scopeMetrics}))},errors:oc(r,(function(e){return e.errors}))}]}}))}))},e.prototype.forceFlush=function(e){return ku(this,void 0,void 0,(function(){return Uu(this,(function(t){switch(t.label){case 0:return[4,this._metricReader.forceFlush(e)];case 1:return t.sent(),[2]}}))}))},e.prototype.shutdown=function(e){return ku(this,void 0,void 0,(function(){return Uu(this,(function(t){switch(t.label){case 0:return[4,this._metricReader.shutdown(e)];case 1:return t.sent(),[2]}}))}))},e.prototype.selectAggregationTemporality=function(e){return this._metricReader.selectAggregationTemporality(e)},e.prototype.selectAggregation=function(e){return this._metricReader.selectAggregation(e)},e}(),Bu=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))},ju=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},Vu=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Fu=(function(){function e(e){var t,n,r;if(this._shutdown=!1,this._sharedState=new Nu(null!==(r=null==e?void 0:e.resource)&&void 0!==r?r:Eo.empty()),null!=(null==e?void 0:e.views)&&e.views.length>0)try{for(var o=Vu(e.views),i=o.next();!i.done;i=o.next()){var s=i.value;this._sharedState.viewRegistry.addView(s)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}}e.prototype.getMeter=function(e,t,n){return void 0===t&&(t=""),void 0===n&&(n={}),this._shutdown?(Kn.warn("A shutdown MeterProvider cannot provide a Meter"),Ma):this._sharedState.getMeterSharedState({name:e,version:t,schemaUrl:n.schemaUrl}).meter},e.prototype.addMetricReader=function(e){var t=new Du(this._sharedState,e);e.setMetricProducer(t),this._sharedState.metricCollectors.push(t)},e.prototype.shutdown=function(e){return Bu(this,void 0,void 0,(function(){return ju(this,(function(t){switch(t.label){case 0:return this._shutdown?(Kn.warn("shutdown may only be called once per MeterProvider"),[2]):(this._shutdown=!0,[4,Promise.all(this._sharedState.metricCollectors.map((function(t){return t.shutdown(e)})))]);case 1:return t.sent(),[2]}}))}))},e.prototype.forceFlush=function(e){return Bu(this,void 0,void 0,(function(){return ju(this,(function(t){switch(t.label){case 0:return this._shutdown?(Kn.warn("invalid attempt to force flush after MeterProvider shutdown"),[2]):[4,Promise.all(this._sharedState.metricCollectors.map((function(t){return t.forceFlush(e)})))];case 1:return t.sent(),[2]}}))}))}}(),/[\^$\\.+?()[\]{}|]/g),Gu=function(){function e(t){"*"===t?(this._matchAll=!0,this._regexp=/.*/):(this._matchAll=!1,this._regexp=new RegExp(e.escapePattern(t)))}return e.prototype.match=function(e){return!!this._matchAll||this._regexp.test(e)},e.escapePattern=function(e){return"^"+e.replace(Fu,"\\$&").replace("*",".*")+"$"},e.hasWildcard=function(e){return e.includes("*")},e}(),Xu=function(){function e(e){this._matchAll=void 0===e,this._pattern=e}return e.prototype.match=function(e){return!!this._matchAll||e===this._pattern},e}();(function(){function e(e){var t;this._nameFilter=new Gu(null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"*"),this._type=null==e?void 0:e.type}e.prototype.getType=function(){return this._type},e.prototype.getNameFilter=function(){return this._nameFilter}})(),function(){function e(e){this._nameFilter=new Xu(null==e?void 0:e.name),this._versionFilter=new Xu(null==e?void 0:e.version),this._schemaUrlFilter=new Xu(null==e?void 0:e.schemaUrl)}e.prototype.getNameFilter=function(){return this._nameFilter},e.prototype.getVersionFilter=function(){return this._versionFilter},e.prototype.getSchemaUrlFilter=function(){return this._schemaUrlFilter}}();var Ku,qu,zu=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Hu="v1/traces",Wu="http://localhost:4318/"+Hu,Yu=function(e){function t(t){void 0===t&&(t={});var n=e.call(this,t)||this;return n._headers=Object.assign(n._headers,br(Dr().OTEL_EXPORTER_OTLP_TRACES_HEADERS)),n}return zu(t,e),t.prototype.convert=function(e){return function(e,t){return{resourceSpans:ma(e,t)}}(e,!0)},t.prototype.getDefaultUrl=function(e){return"string"==typeof e.url?e.url:Dr().OTEL_EXPORTER_OTLP_TRACES_ENDPOINT.length>0?(t=Dr().OTEL_EXPORTER_OTLP_TRACES_ENDPOINT,n=Hu,t.includes(n)||t.endsWith("/")||(t+="/"),t):Dr().OTEL_EXPORTER_OTLP_ENDPOINT.length>0?function(e,t){return e.endsWith("/")||(e+="/"),e+t}(Dr().OTEL_EXPORTER_OTLP_ENDPOINT,Hu):Wu;var t,n},t}(la),Qu="http://localhost:4318/v1/traces",Ju={init:function(e){var t;qu||(e.url=e.url||Qu,e.webSDKVersion=e.webSDKVersion||"unknown",(Ku=new Zs({resource:new Eo((t={},t[Uo]="smwebsdk",t[Do]=e.webSDKVersion,t))})).addSpanProcessor(new _i(new Yu({url:e.url,headers:{Authorization:"Bearer "+e.jwt}}))),Ku.register(),qu=Ku.getTracer("smwebsdk"))},isInitialized:function(){return!!qu},getTracer:function(){return qu},defaultUrl:Qu};Object.freeze(Ju);var Zu="undefined"!=typeof process&&"MISSING_ENV_VAR".SM_WEBSDK_VERSION||"unknown";function $u(e,t,n){return void 0===t&&(t={}),x(this,void 0,void 0,(function(){var r,o,i,s,a,c;return N(this,(function(u){switch(u.label){case 0:r=[],o=t.maxRetries||50,i=t.delayMs||200,a=0,u.label=1;case 1:if(!(a<o))return[3,8];u.label=2;case 2:return u.trys.push([2,4,,6]),[4,e()];case 3:return s=u.sent(),n.connectionResult={message:"success",value:s,retries:r},[3,6];case 4:if(c=u.sent(),r.push(c),n.connectionResult={message:"failed",retries:r},c instanceof Error&&"noSessionToResume"===c.name&&tl(),!(c instanceof Error)||"noScene"!==c.name)throw c;if(r.length===o)throw console.warn("Retry gave up after ".concat(o," retries:\n").concat(r.map((function(e){return e instanceof Error?e.message:e.toString()})).join("\n"))),c;return[4,(l=i,new Promise((function(e){return setTimeout((function(){return e()}),l)})))];case 5:return u.sent(),[3,7];case 6:return[3,8];case 7:return a++,[3,1];case 8:return[2,s]}var l}))}))}function el(){return{server:sessionStorage.getItem("sm-server"),resumeSessionId:sessionStorage.getItem("sm-session-id"),savedApiKey:sessionStorage.getItem("sm-api-key")}}function tl(){sessionStorage.removeItem("sm-server"),sessionStorage.removeItem("sm-session-id"),sessionStorage.removeItem("sm-api-key")}var nl,rl=function(){function e(e,t,n,r,o,i,s,a){void 0===t&&(t=!1),void 0===n&&(n=z.MicrophoneAndCamera),void 0===r&&(r=z.Microphone);var c=this;if(this._onConversationResultEvents={},this._onSpeechMarkerEvents={},this._session=void 0,this._isWebSocketOnly=!1,this._transactionId=0,this._pendingResponses={},this._microphoneUnmuteTimer=void 0,this._echoCancellationEnabled=!0,this._serverControlledCameras=!1,this._stopSpeakingWhenNotVisible=!0,this._loggingConfig={session:{},contentAwareness:{}},this._logger=new F,this._tracerOptions={disableTracing:!1,parentCtx:Wt,url:Ju.defaultUrl},this._chromaKeyOptions=void 0,this._sessionResumeEnabled=!1,this._isResumedSession=!1,this._sendMetadata={pageUrl:!1},this._onMicrophoneActive=new C,this._onCameraActive=new C,this.currentPersonaId=1,this.version={webSdk:Zu,platformSdk:"unknown"},this.iosVisibilityChange=function(){var e="visible"===document.visibilityState;setTimeout((function(){c._session&&c._session.sendRtcEvent("ui",{visible:e})}),500)},this.stopSpeakingWhenNotVisible=function(){"visible"!==document.visibilityState&&c.sendRequest("stopSpeaking",{personaId:c.currentPersonaId})},this.stopSpeakingWhenUnloaded=function(){c.sendRequest("stopSpeaking",{personaId:c.currentPersonaId})},this.isSceneOptions(e)){var u=e;this._videoElement=u.videoElement,this._apiKey=u.apiKey,this._audioOnly=u.audioOnly||t,!1===u.stopSpeakingWhenNotVisible&&(this._stopSpeakingWhenNotVisible=!1),this._requestedUserMedia=qn(u.requestedMediaDevices,n),this._requiredUserMedia=qn(u.requiredMediaDevices,r),this.contentAwarenessDebounceTime=u.contentAwarenessDebounceTime,this._loggingConfig=M(M({},this._loggingConfig),u.loggingConfig||{}),u.sendMetadata&&(this._sendMetadata=u.sendMetadata),u.tracerOptions&&(this._tracerOptions=u.tracerOptions),this._chromaKeyOptions=u.chromaKeyOptions}else this._videoElement=e,this._audioOnly=t,this._requestedUserMedia=n,this._requiredUserMedia=r,this.contentAwarenessDebounceTime=o,this._loggingConfig=M(M({},this._loggingConfig),i),s&&(this._tracerOptions=s),this._chromaKeyOptions=a;this._logger=new F(this._loggingConfig.session.minLogLevel,this._loggingConfig.session.enabled),this._onStateEvent=new C,this._onStateEvent.addListener((function(e,t){c._onState&&c._onState(e,t)})),this._onRecognizeResultsEvent=new C,this._onRecognizeResultsEvent.addListener((function(e,t,n,r){c._onRecognizeResults&&c._onRecognizeResults(e,t,n,r)})),this._onDisconnectedEvent=new C,this._onDisconnectedEvent.addListener((function(e,t,n){tl(),c.cleanupEventListeners(),c._onDisconnected&&c._onDisconnected(e,t,n)})),this._onUserTextEvent=new C,this._onUserTextEvent.addListener((function(e,t){c._onUserText&&c._onUserText(e,t)})),this._onDemoModeEvent=new C,this._underRuntimeHost=Boolean(window.SmIsUnderRuntimeHost);var l=new Uint32Array(3);window.crypto.getRandomValues(l),this._sceneId=l.toString().replace(/,/g,"-"),this.conversation=new Qn,this.connectionState=new $n,this._metadataSender=new Jn(this),this._logger.log("debug","websdk version:",this.version.webSdk)}return e.prototype.isSceneOptions=function(e){var t=!!e,n=!!(null==e?void 0:e.tagName);return t&&!n},e.prototype.connectionValid=function(){return!!this._underRuntimeHost||!(!this._session||!this._session.serverConnection)},e.prototype.isConnected=function(){return!!(this.connectionValid()&&this._session&&this._session.serverConnection&&this._session.serverConnection.readyState===this._session.serverConnection.OPEN)},e.prototype.keepAlive=function(){this._session&&null!==this._session.peerConnection&&this._session.sendRtcEvent("keepAlive",{})},e.prototype.disconnect=function(){var e,t;tl(),this.cleanupEventListeners(),this.connectionState.reset(),this.conversation.reset(),null===(e=this.contentAwareness)||void 0===e||e.disconnect(),this._metadataSender.disconnect(),null===(t=this._session)||void 0===t||t.close(!0),this._session=void 0},e.prototype.connect=function(e,t,n,r){var o,i,s;return x(this,void 0,void 0,(function(){var a,c,u,l,p,h,d,f,v,_,y,g=this;return N(this,(function(m){switch(m.label){case 0:return a=Date.now(),c=this.connectArgsToConfig(e,t,n,r),l=function(e){null==u||u.addEvent(e.name)},this.connectionState.onConnectionStateUpdated.addListener(l),this._underRuntimeHost?(this._session=new q(this._videoElement,this._logger),[3,8]):[3,1];case 1:if(p=c.tokenServerUri||c.tokenServerAccessToken,this._apiKey&&p&&this._logger.log("warn","You are trying to connect via an API key and a token server. Please use one or the other"),!this._apiKey||p)return[3,6];m.label=2;case 2:return m.trys.push([2,5,,6]),[4,this.fetchAuthConfig(this._apiKey)];case 3:return[4,m.sent().json()];case 4:return h=m.sent(),d=el().server,c.tokenServerUri=h.url,c.tokenServerAccessToken=h.jwt,d&&(c.tokenServerUri=zn(h.url)+"server/"+d),[3,6];case 5:throw(f=m.sent())instanceof Error&&"Broken API key"===f.message?this._logger.log("error","Broken API key. Please check your key or re copy the key from DDNA Studio."):this._logger.log("error","Invalid API key: Please check your key configuration in DDNA Studio. For more information click here https://soulmachines-support.atlassian.net/wiki/spaces/SSAS/pages/1320058919/Connecting+Using+API+Keys#Troubleshooting"),G("Invalid API key","serverConnectionFailed");case 6:if(!c.tokenServerUri||!c.tokenServerAccessToken)throw G("Please authenticate via an API key or with a serverUri and accessToken","serverConnectionFailed");return[4,this.initializeTracer(c.tokenServerUri,c.tokenServerAccessToken)];case 7:v=m.sent(),_=v.initTracerStartTime,y=v.initTracerEndTime,u=null===(s=null===(i=null===(o=Ju.getTracer())||void 0===o?void 0:o.startSpan("createSessionAndConnect"))||void 0===i?void 0:i.setAttribute("sm.websdk.connection.pretraceinitduration.milliseconds",_-a))||void 0===s?void 0:s.setAttribute("sm.websdk.connection.traceinitduration.milliseconds",y-_),this._isWebSocketOnly?this._session=new ke(c.tokenServerUri,c.tokenServerAccessToken,this._logger):this._session=new Ne(this._videoElement,c.tokenServerUri,c.userText,c.tokenServerAccessToken,this._audioOnly,this._requestedUserMedia,this._requiredUserMedia,this._echoCancellationEnabled,this._logger,this.connectionState,this._chromaKeyOptions),m.label=8;case 8:if(!this._session)throw G("Failed to create session","unknown");return this._session.onConnected=this.sessionConnected.bind(this),this._session.onMessage=this.onMessage.bind(this),this._session.onClose=this.sessionClosed.bind(this),this._session.onUserText=this.rtcUserText.bind(this),"microphoneActiveCallbacks"in this._session&&(this._session.microphoneActiveCallbacks=this._onMicrophoneActive),"cameraActiveCallbacks"in this._session&&(this._session.cameraActiveCallbacks=this._onCameraActive),this._session.features.isIos&&document.addEventListener("visibilitychange",this.iosVisibilityChange),[4,$u((function(){return x(g,void 0,void 0,(function(){return N(this,(function(e){switch(e.label){case 0:return[4,this._session.connect()];case 1:return[2,e.sent()]}}))}))}),c.retryOptions,this).finally((function(){g.connectionState.onConnectionStateUpdated.removeListener(l),null==u||u.end()}))];case 9:return[2,m.sent()]}}))}))},e.prototype.initializeTracer=function(e,t){return x(this,void 0,Promise,(function(){var n,r,o;return N(this,(function(i){switch(i.label){case 0:if(n=Date.now(),this._tracerOptions.disableTracing||Ju.isInitialized())return[3,4];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.initTelemetryToken({tokenServerUri:e,authToken:t})];case 2:return i.sent(),[3,4];case 3:return r=i.sent(),o="Could not initialize tracer telemetry token: ",r instanceof ReferenceError&&"fetch is not defined"===r.message?this._logger.log("debug",o+r.name+": "+r.message):r instanceof Error?this._logger.log("warn",o+r.name+": "+r.message):this._logger.log("warn",o+"unknown error type"),[3,4];case 4:return[2,{initTracerStartTime:n,initTracerEndTime:Date.now()}]}}))}))},e.prototype.initTelemetryToken=function(e){var t=e.tokenServerUri,n=e.authToken;return x(this,void 0,Promise,(function(){var e,r,o,i;return N(this,(function(s){switch(s.label){case 0:return"api/telemetry/jwt",e="api/telemetry/v1/traces",(r=zn(t.replace(/^wss:\/\//,"https://")))?[4,fetch(r+"api/telemetry/jwt",{headers:{Authorization:"Bearer "+n}})]:(this._logger.log("debug","Could not initialize tracer telemetry token: invalid token server URI"),[2]);case 1:return(o=s.sent())?o.ok?[4,o.json()]:(this._logger.log("warn","Failed to fetch otel token: "+o.status+": "+o.statusText),[2]):(this._logger.log("warn","Failed to receive response from otel token endpoint"),[2]);case 2:if(!(i=s.sent()).success)return this._logger.log("warn","Failed: otel response not successful"),[2];try{Ju.init({jwt:i.telemetryJwt,url:r+e,webSDKVersion:this.version.webSdk}),this._logger.log("log","Telemetry initialized")}catch(e){e instanceof Error?this._logger.log("warn","Failed to initialize tracer: "+e.message):this._logger.log("warn","Failed to initialize tracer: unknown error")}return[2]}}))}))},e.prototype.onMessage=function(e){if("scene"!==e.category);else{var t=e;this.onSceneMessage(t)}},e.prototype.sendOnewaySceneRequest=function(e,t){if(this._session){var n={name:e,body:t,category:Me.Scene,kind:Ie.Request};this._session.sendMessage(n)}},e.prototype.sendRequest=function(e,t){var n=this;return void 0===t&&(t={}),new Promise((function(r,o){if(n._session){var i=n._sceneId+"_"+ ++n._transactionId,s={transaction:i,name:e,body:t,category:Me.Scene,kind:Ie.Request},a={resolve:r,reject:o};n._pendingResponses[i]=a,n._session&&n._session.sendMessage(s)}else o(G("No session available","noSession"))}))},e.prototype.onSceneMessage=function(e){var t,n,r,o=e.name,i=e.body,s=e.kind,a=e.status,c=e.transaction;if(i&&"state"===o){var u=i;this._onStateEvent.call(this,u),(null===(t=u.scene)||void 0===t?void 0:t.featureFlags)&&this.enableFlaggedFeatures(u.scene.featureFlags),(null===(n=u.scene)||void 0===n?void 0:n.sdkVersion)&&(this.version.platformSdk=null===(r=u.scene)||void 0===r?void 0:r.sdkVersion,this._logger.log("debug","platformSdk version:",this.version.platformSdk)),this.conversation.processStateMessage(u),this.controlMicrophoneMute(i)}else if(i&&"recognizeResults"===o){var l=i,p=l.status,h=l.errorMessage,d=l.results;this.conversation.processRecognizeResultsMessage(i),this._onRecognizeResultsEvent.call(this,p,h,d)}else if(i&&"conversationResult"===o){if(this.conversation.onConversationResult(i),v=i.personaId){var f=new A(this,v);this._onConversationResultEvents[v].call(f,i),this.currentPersonaId=v}}else if(i&&"speechMarker"===o){var v;if(this.conversation.onSpeechMarker(i),v=i.personaId){f=new A(this,v);this._onSpeechMarkerEvents[v].call(f,i),this.currentPersonaId=v}}else i&&"demoMode"===o&&this._onDemoModeEvent.call(this,i);s===Ie.Response&&c&&this.processResponse(i,o,a,c)},e.prototype.processResponse=function(e,t,n,r){var o=this._pendingResponses[r];if(o){if(0===n)o.resolve(e);else{var i=new Y;i.requestName=t,i.status=n,i.responseBody=e,o.reject(i)}delete this._pendingResponses[r]}},e.prototype.controlMicrophoneMute=function(e){var t=this;if(e.persona&&this._session&&-1!==this._session.microphoneMuteDelay)for(var n in e.persona){var r=e.persona[n];r.speechState&&(r.speechState===xe.Speaking?(this._session.microphoneMuted||(this._logger.log("warn","Persona is speaking - mute microphone"),this._session.microphoneMuted=!0),this._microphoneUnmuteTimer&&(clearTimeout(this._microphoneUnmuteTimer),this._microphoneUnmuteTimer=void 0)):this._session.microphoneMuted&&!this._microphoneUnmuteTimer&&(this._microphoneUnmuteTimer=setTimeout((function(){t._session&&t._microphoneUnmuteTimer&&(t._logger.log("warn","Persona is no longer speaking - unmute microphone"),t._session.microphoneMuted=!1,t._microphoneUnmuteTimer=void 0)}),this._session.microphoneMuteDelay)))}},e.prototype.close=function(){this._session&&this._session.close(!0)},e.prototype.sessionConnected=function(e,t,n,r){this.contentAwareness=new St(this,this.contentAwarenessDebounceTime,new F(this._loggingConfig.contentAwareness.minLogLevel,this._loggingConfig.contentAwareness.enabled)),this._stopSpeakingWhenNotVisible&&document.addEventListener("visibilitychange",this.stopSpeakingWhenNotVisible),window.addEventListener("beforeunload",this.stopSpeakingWhenUnloaded),this._sendMetadata.pageUrl&&this._metadataSender.observeUrlChanges(),this._isResumedSession=t,e&&(this._sessionResumeEnabled=!0,function(e,t,n){sessionStorage.setItem("sm-server",e),sessionStorage.setItem("sm-session-id",t),sessionStorage.setItem("sm-api-key",n)}(n,r,this._apiKey||"")),t&&this._sendMetadata.pageUrl&&this._metadataSender.send()},e.prototype.cleanupEventListeners=function(){var e;(null===(e=this._session)||void 0===e?void 0:e.features.isIos)&&document.removeEventListener("visibilitychange",this.iosVisibilityChange),this._stopSpeakingWhenNotVisible&&document.removeEventListener("visibilitychange",this.stopSpeakingWhenNotVisible),window.removeEventListener("beforeunload",this.stopSpeakingWhenUnloaded)},e.prototype.sessionClosed=function(e){tl(),this.cleanupEventListeners(),this._session&&(this.connectionState.reset(),this.conversation.reset(),this._onDisconnectedEvent.call(this,this._session.sessionId,e))},e.prototype.rtcUserText=function(e){this._onUserTextEvent.call(this,e)},e.prototype.enableFlaggedFeatures=function(e){this._serverControlledCameras=e.includes(K.UI_SDK_CAMERA_CONTROL)},e.prototype.sendContent=function(){var e;this.contentAwareness||console.warn("ContentAwareness is not enabled for this project"),null===(e=this.contentAwareness)||void 0===e||e.measure()},e.prototype.sendVideoBounds=function(e,t){this._session&&this._session.sendVideoBounds(e,t)},e.prototype.configure=function(e){return this.sendRequest("configure",e)},e.prototype.sendUserText=function(e){this._session&&this._session.sendUserText(e)},e.prototype.startRecognize=function(e){var t={};return void 0!==e&&(t.audioSource=e),this.sendRequest("startRecognize",t)},e.prototype.stopRecognize=function(){return this.sendRequest("stopRecognize")},e.prototype.isMicrophoneConnected=function(){return!!this._session&&this._session.isMicrophoneConnected},e.prototype.isCameraConnected=function(){return!!this._session&&this._session.isCameraConnected},e.prototype.session=function(){return this._session},e.prototype.hasContentAwareness=function(){return!!this.contentAwareness},e.prototype.hasServerControlledCameras=function(){return this._serverControlledCameras},e.prototype.supportsSessionPersistence=function(){return this._sessionResumeEnabled},e.prototype.isResumedSession=function(){return this._isResumedSession},Object.defineProperty(e.prototype,"onConversationResultEvents",{get:function(){return this._onConversationResultEvents},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onSpeechMarkerEvents",{get:function(){return this._onSpeechMarkerEvents},enumerable:!1,configurable:!0}),e.prototype.getState=function(){return x(this,void 0,Promise,(function(){return N(this,(function(e){return[2,this.sendRequest("getState")]}))}))},Object.defineProperty(e.prototype,"onStateEvent",{get:function(){return this._onStateEvent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onState",{set:function(e){this._onState=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onDisconnectedEvent",{get:function(){return this._onDisconnectedEvent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onDisconnected",{set:function(e){this._onDisconnected=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onRecognizeResultsEvent",{get:function(){return this._onRecognizeResultsEvent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onRecognizeResults",{set:function(e){this._onRecognizeResults=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onUserTextEvent",{get:function(){return this._onUserTextEvent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onUserText",{set:function(e){this._onUserText=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"echoCancellationEnabled",{get:function(){return this._echoCancellationEnabled},set:function(e){this._echoCancellationEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onDemoModeEvent",{get:function(){return this._onDemoModeEvent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"videoElement",{get:function(){return this._videoElement},set:function(e){var t;this._videoElement=e,null===(t=this._session)||void 0===t||t.setVideoElement(this._videoElement)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"viewerOffsetX",{get:function(){return this._session?this._session.offsetX:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"viewerOffsetY",{get:function(){return this._session?this._session.offsetY:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isWebSocketOnly",{get:function(){return this._isWebSocketOnly},set:function(e){this._isWebSocketOnly=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onMicrophoneActive",{get:function(){return this._onMicrophoneActive},enumerable:!1,configurable:!0}),e.prototype.isMicrophoneActive=function(){var e;return Boolean(null===(e=this._session)||void 0===e?void 0:e.isMicrophoneActive())},Object.defineProperty(e.prototype,"onCameraActive",{get:function(){return this._onCameraActive},enumerable:!1,configurable:!0}),e.prototype.isCameraActive=function(){var e;return Boolean(null===(e=this._session)||void 0===e?void 0:e.isCameraActive())},e.prototype.setMediaDeviceActive=function(e){var t;return x(this,void 0,Promise,(function(){return N(this,(function(n){switch(n.label){case 0:return this.isConnected()?[4,null===(t=this._session)||void 0===t?void 0:t.setMediaDeviceActive({microphone:e.microphone,camera:e.camera})]:[3,2];case 1:return n.sent(),[3,3];case 2:throw G("Connection has not been established","noConnection");case 3:return[2]}}))}))},e.prototype.startVideo=function(e){return x(this,void 0,Promise,(function(){var t;return N(this,(function(n){switch(n.label){case 0:if(!(t=e||this._videoElement))throw G("Cannot find HTMLVideoElement","noVideoElement");return[4,this.playVideo(t)];case 1:return n.sent()?[2,{video:!0,audio:!0}]:(t.muted=!0,[4,this.playVideo(t)]);case 2:if(n.sent())return[2,{video:!0,audio:!1}];throw G("Cannot start media playback","userInteractionRequired")}}))}))},e.prototype.playVideo=function(e){return x(this,void 0,Promise,(function(){return N(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,e.play()];case 1:return t.sent(),[2,!0];case 2:return t.sent(),[2,!1];case 3:return[2]}}))}))},e.prototype.fetchAuthConfig=function(e){var t;try{t=JSON.parse(atob(e)).authServer}catch(e){throw G("Broken API key","Failed to decode api key")}var n=el(),r=n.server,o=n.resumeSessionId,i=n.savedApiKey;return r&&o&&i===e&&(t=t+"?sessionId="+o),fetch(t,{headers:{key:e}})},e.prototype.connectArgsToConfig=function(e,t,n,r){var o,i;return"string"==typeof e?{tokenServerUri:e,tokenServerAccessToken:n,userText:t,retryOptions:r}:{tokenServerUri:(null===(o=null==e?void 0:e.tokenServer)||void 0===o?void 0:o.uri)||"",tokenServerAccessToken:null===(i=null==e?void 0:e.tokenServer)||void 0===i?void 0:i.token,userText:null==e?void 0:e.userText,retryOptions:null==e?void 0:e.retryOptions}},e.prototype.isLoggingEnabled=function(){return this._logger.isEnabled},e.prototype.getMinLogLevel=function(){return this._logger.getMinLogLevel()},e.prototype.setLogging=function(e){this._logger.enableLogging(e)},e.prototype.setMinLogLevel=function(e){this._logger.setMinLogLevel(e)},e}();!function(e){e[e.none=z.None]="none",e[e.microphone=z.Microphone]="microphone",e[e.microphoneAndCamera=z.MicrophoneAndCamera]="microphoneAndCamera",e[e.camera=z.Camera]="camera"}(nl||(nl={}));var ol=new function(){this.Scene=rl,this.Persona=A,this.userMedia={none:z.None,microphone:z.Microphone,microphoneAndCamera:z.MicrophoneAndCamera,camera:z.Camera},this.DetectCapabilities=function(){return(new j).detectWebRTCFeatures()},this.setLogging=function(e){}};return t})()));
//# sourceMappingURL=smwebsdk.min.js.map